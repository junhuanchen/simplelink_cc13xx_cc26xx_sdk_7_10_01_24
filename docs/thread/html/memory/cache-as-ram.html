<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the Cache as RAM &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
Thread User&#39;s Guide
 1.10.00.00 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Migration Guide" href="../thread-guide/migration-index.html" />
    <link rel="prev" title="Using the AUX RAM as RAM" href="aux-as-ram.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug memory cache-as-ram";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../thread-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
Thread User's Guide

          </a>
              <div class="version">
                1.10.00.00
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/ti-openthread-intro.html">TI-OpenThread Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/tirtos-index.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/software-development-index.html">Developing Thread Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/thread-protocol.html">Thread Networking Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/packet-sniffer-index.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/border-router-index.html">Linux Border Router Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/oad-index.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../thread-guide/memory-index.html">Memory overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="memory_map.html">Memory Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management.html">Flash Vector Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management.html#customer-configuration-ccfg-table">Customer Configuration (CCFG) Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="aux-as-ram.html">Using the AUX RAM as RAM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using the Cache as RAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-cache-as-gpram">Configure the Cache as GPRAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-gpram">Dynamic GPRAM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../thread-guide/migration-index.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/glossary.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../thread-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
Thread User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../thread-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../thread-guide/memory-index.html">Memory overview</a> &raquo;</li>
      <li>Using the Cache as RAM</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="using-the-cache-as-ram">
<span id="section-cache-as-ram"></span><h1>Using the Cache as RAM<a class="headerlink" href="#using-the-cache-as-ram" title="Permalink to this headline">¶</a></h1>
<p>The cache can be disabled temporarily or permanently and used as RAM in stead.
When the cache is disabled, the device runs at reduced speed. This increases the
device power consumption. If you want to use the cache as cache and temporarily
disable it for extra RAM at runtime, jump ahead to the
<a class="reference internal" href="#section-cache-as-ram-dynamic-gpram"><span class="std std-ref">Dynamic GPRAM</span></a> section. If you want to configure the
cache to be used as RAM from the outset, see the
<a class="reference internal" href="#section-cache-as-ram-configure-cache"><span class="std std-ref">Configure the Cache as GPRAM</span></a> section.</p>
<div class="section" id="configure-the-cache-as-gpram">
<span id="section-cache-as-ram-configure-cache"></span><h2>Configure the Cache as GPRAM<a class="headerlink" href="#configure-the-cache-as-gpram" title="Permalink to this headline">¶</a></h2>
<p>If your application needs more memory, or if you need more space in SRAM, the
cache can be re-purposed as RAM. This will allow the linker to store parts of
the compiled application in this section of the RAM. This section will be
referred to as the general purpose RAM (<a class="reference internal" href="../thread/glossary.html#term-GPRAM"><span class="xref std std-term">GPRAM</span></a>). This will cause the program to
run at a slightly reduced speed, and it will increase the device
power consumption in sleep. This is because the <a class="reference internal" href="../thread/glossary.html#term-GPRAM"><span class="xref std std-term">GPRAM</span></a>, contrary to a cache,
will have to be powered even when the device is sleeping. The current consumption
in standby mode with and without cache retained is listed in the CC13xx or CC26xx
datasheet.</p>
<p>With the cache re-purposed as RAM, the program will run at a slightly decreased
speed. This will cause the device to spend more time when active,
which again will give a higher power consumption. How this will affect the
device power consumption will depend on application. For some applications the
added power consumption will be very small, but for processing intensive
application it will be slightly higher. Please verify your application current
consumption by using the method described in the <a class="reference external" href="http://www.ti.com/lit/pdf/swra478">Measuring CC13xx and CC26xx
current consumption (SWRA478)</a>.</p>
<p>In order to enable using the cache as RAM, two things need to be done. Firstly, the
program must be told to retain the cache/GPRAM when it’s being used. Secondly,
the linker must be told to allocate the memory region used as cache to GPRAM,
and what parts of code to store in the GPRAM. This is done in the linker
command/configuration file. The syntax for the linker command/configuration
file is slightly different in CCS and IAR. To read more about the CCS linker
command file, see the article <a class="reference external" href="http://software-dl.ti.com/ccs/esd/documents/sdto_cgt_Linker-Command-File-Primer.html">Linker Command File Primer</a>.
To read more about the IAR linker, see <a class="reference external" href="http://ftp.iar.se/WWWfiles/arm/webic/doc/EWARM_DevelopmentGuide.ENU.pdf">IAR C/C++ Development Guide</a>.</p>
<p><strong>If you want to use the cache as RAM in a project, follow these steps:</strong></p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The steps will be different for CCS users and IAR users. The steps will
also differ depending on what example project your project is based on. For
the example projects found in the TI-OpenThread folder, only step 1-5 will be
required.</p>
</div>
<p>1. In the syscfg file, go to <em>TI Devices</em> → <em>Device Configuration</em> and
select <em>Disable Flash Cache</em></p>
<ol class="arabic simple" start="2">
<li><p>In <code class="docutils literal notranslate"><span class="pre">main()</span></code>, add the following code:</p></li>
</ol>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">Listing 35. </span><span class="caption-text">Retain cache in sleep.</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef CACHE_AS_RAM</span>
<span class="c1">// retain cache during standby</span>
<span class="n">Power_setConstraint</span><span class="p">(</span><span class="n">PowerCC26XX_SB_VIMS_CACHE_RETAIN</span><span class="p">);</span><span class="w"></span>
<span class="n">Power_setConstraint</span><span class="p">(</span><span class="n">PowerCC26XX_NEED_FLASH_IN_IDLE</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="c1">// Enable iCache pre-fetching</span>
<span class="n">VIMSConfigure</span><span class="p">(</span><span class="n">VIMS_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span><span class="w"></span>
<span class="c1">// Enable cache</span>
<span class="n">VIMSModeSet</span><span class="p">(</span><span class="n">VIMS_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">VIMS_MODE_ENABLED</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">//CACHE_AS_RAM</span>
</pre></div>
</div>
</div>
</div></blockquote>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please make sure your program is not using <a class="reference internal" href="../thread/glossary.html#term-VIMS"><span class="xref std std-term">VIMS</span></a> while using cache as RAM.</p>
</div>
<p>In the same file, include the following files:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Power Driver */</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/drivers/Power.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/drivers/power/PowerCC26XX.h&gt;</span><span class="cp"></span>
<span class="cm">/* Header files required to enable instruction fetch cache */</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/devices/cc26x0r2/inc/hw_memmap.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/devices/cc26x0r2/driverlib/vims.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Go to the <strong>compiler</strong> predefines and add <code class="docutils literal notranslate"><span class="pre">CACHE_AS_RAM</span></code>.</p></li>
</ol>
<p>4. The GPRAM memory area must be defined in the linker command file. This
syntax is different for the CCS and IAR linker. IAR specific instructions
will follow the CCS specific instructions.</p>
<p>In CCS, the linker command file ends with <code class="docutils literal notranslate"><span class="pre">.cmd</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">cc13x2_cc26x2_app.cmd</span></code>).</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-number">Listing 36. </span><span class="caption-text">Under <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Sizes</span></code>, add defines for GPRAM start and length.</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  /*******************************************************************************
   * Memory Sizes
   */
  #define FLASH_BASE   0x00000000
  #define GPRAM_BASE   0x11000000
  #define RAM_BASE     0x20000000
  #define ROM_BASE     0x10000000

  #define FLASH_SIZE   0x00058000
  #define GPRAM_SIZE   0x00002000
  #define RAM_SIZE     0x00014000
  #define ROM_SIZE     0x00040000
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-number">Listing 37. </span><span class="caption-text">Add GPRAM under <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Definitions</span></code>.</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cm">/*******************************************************************************</span>
<span class="cm">   * GPRAM</span>
<span class="cm">   */</span><span class="w"></span>

<span class="w">  </span><span class="cp">#ifdef CACHE_AS_RAM</span>
<span class="w">    </span><span class="cp">#define GPRAM_START GPRAM_BASE</span>
<span class="w">    </span><span class="cp">#define GPRAM_END   (GPRAM_START + GPRAM_SIZE - 1)</span>
<span class="w">  </span><span class="cp">#endif </span><span class="cm">/* CACHE_AS_RAM */</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-number">Listing 38. </span><span class="caption-text">In <code class="docutils literal notranslate"><span class="pre">MEMORY{}</span></code>, allocate room for GPRAM.</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    #ifdef CACHE_AS_RAM
      GPRAM(RWX) : origin = GPRAM_START, length = GPRAM_SIZE
    #endif /* CACHE_AS_RAM */
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<span id="mm-cacheasram-ccs-code"></span><div class="code-block-caption"><span class="caption-number">Listing 39. </span><span class="caption-text">In <code class="docutils literal notranslate"><span class="pre">SECTIONS{}</span></code>, move .bss from SRAM to GPRAM.</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  GROUP &gt; SRAM
  {
    .data
    #ifndef CACHE_AS_RAM
    .bss
    #endif /* CACHE_AS_RAM */
    .vtable
    .vtable_ram
    vtable_ram
    .sysmem
    .nonretenvar

  } LOAD_END(heapStart)

  .stack            :   &gt;  SRAM (HIGH) LOAD_START(heapEnd)

  #ifdef CACHE_AS_RAM
  .bss :
  {
    *(.bss)
  } &gt; GPRAM
  #endif /* CACHE_AS_RAM */
</pre></div>
</div>
</div>
<p>Rebuild your application. This will move <a class="reference internal" href="../thread/glossary.html#term-.bss"><span class="xref std std-term">.bss</span></a> from SRAM to GPRAM and
place the auto-heap size start after.  Other objects can also be moved. See
<a class="reference internal" href="aux-as-ram.html#using-the-aux-as-ram"><span class="std std-ref">Using the AUX RAM as RAM</span></a> for an example of this.</p>
</div></blockquote>
<p>. In IAR, the linker configuration file ends with <code class="docutils literal notranslate"><span class="pre">.icf</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">cc26xx_app.icf</span></code>).</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-number">Listing 40. </span><span class="caption-text">Add defines for GPRAM start and length under <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Definitions</span></code>.</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  //////////////////////////////////////////////////////////////////////////////
  // GPRAM
  //
  if ( isdefinedsymbol(CACHE_AS_RAM) )
  {
    define symbol GPRAM_START           = 0x11000000;
    define symbol GPRAM_SIZE            = 0x2000;
    define symbol GPRAM_END             = GPRAM_START + GPRAM_SIZE;
  }
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-number">Listing 41. </span><span class="caption-text">Under <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Regions</span></code>, allocate room for GPRAM.</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  if ( isdefinedsymbol(CACHE_AS_RAM) )
  {
    define region GPRAM               = mem:[from GPRAM_START to GPRAM_END];
  }
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<span id="mm-cacheasram-iar-code"></span><div class="code-block-caption"><span class="caption-number">Listing 42. </span><span class="caption-text">Under <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Placement</span></code>, move .bss from SRAM to GPRAM.</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  if ( isdefinedsymbol(CACHE_AS_RAM) )
  {
    // GPRAM
    define block GPDATA { section .bss };
    place in GPRAM { block GPDATA } except { object ll.o };
  }
</pre></div>
</div>
</div>
<p>Rebuild your application. This will move <a class="reference internal" href="../thread/glossary.html#term-.bss"><span class="xref std std-term">.bss</span></a> from SRAM to GPRAM. Other
objects can also be moved. See <a class="reference internal" href="aux-as-ram.html#using-the-aux-as-ram"><span class="std std-ref">Using the AUX RAM as RAM</span></a> for an example
of this.</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="dynamic-gpram">
<span id="section-cache-as-ram-dynamic-gpram"></span><h2>Dynamic GPRAM<a class="headerlink" href="#dynamic-gpram" title="Permalink to this headline">¶</a></h2>
<p>In this mode, the cache will be used as RAM only when we need it. At all other
times, the cache will operate as normal. When the cache is disabled and the
memory is used as RAM, the current consumption will increase as described in the
<a class="reference internal" href="#section-cache-as-ram-configure-cache"><span class="std std-ref">Configure the Cache as GPRAM</span></a> section. When the cache is not
configured as RAM but runs as usual, the power consumption is not increased.</p>
<p>An example use-case is a device that sometimes receives or sends a data stream
with a high throughput. When the device is not streaming, it can use the cache
as usual. When the device receives the signal to start streaming, the device
disables the cache and uses the GPRAM to store a buffer for the stream. When the
device receives the command to stop streaming, the memory is freed and the cache
is re-enabled.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="aux-as-ram.html" class="btn btn-neutral float-left" title="Using the AUX RAM as RAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../thread-guide/migration-index.html" class="btn btn-neutral float-right" title="Migration Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>