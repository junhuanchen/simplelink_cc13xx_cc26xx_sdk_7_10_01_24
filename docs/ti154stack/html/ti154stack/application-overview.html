<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Application Overview &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User&#39;s Guide
 6.10.01.00 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example Applications" href="example-applications.html" />
    <link rel="prev" title="Overview" href="ti154stack-overview-cc13xx_cc26xx.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ti154stack application-overview";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ti154stack-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User's Guide

          </a>
              <div class="version">
                6.10.01.00
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ti154stack-guide/ti154stack-index-cc13xx_cc26xx.html">TI 15.4-Stack</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html#architecture-choices">Architecture Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html#data-rate-and-phy">Data Rate and PHY</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Application Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#application-architecture">Application Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-file-structure">Application File Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-up-in-main">Start-Up in main()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osalport-framework">OSALPort Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#osalport-protocol-stack-service">OSALPort Protocol Stack Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-service">OSALPort Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-initialization-and-registration">OSALPort Initialization and Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-thread-synchronization">OSALPort Thread Synchronization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-osalport-usage">Example OSALPort Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-stack">System Stack</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#general-application-architecture">General Application Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-initialization-function">Application Initialization Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-processing-in-the-task-function">Event Processing in the Task Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callbacks">Callbacks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-volatile-memory">Non-Volatile Memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#modifying-non-volatile-memory-allocation">Modifying Non-Volatile Memory Allocation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ti-drivers">TI Drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-driver">Adding a Driver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="example-applications.html">Example Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-user-interface.html">Common User Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure-commissioning.html">Secure Commissioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="beacon-mode.html">Beacon Enabled Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="non-beacon-mode.html">Non-Beacon Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="frequency-hopping-mode.html">Frequency-Hopping Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="arib-regulation-type.html">ARIB Regulation Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-stack.html">Configuring Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet-sniffer.html">SmartRF Protocol Packet Sniffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-custom-applications.html">Creating Custom Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc13xx_cc26xx/fcc-certification.html">FCC Certification Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ti154stack-guide/oad-secure-index.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ti154stack-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence-ieee.html">Wi-Fi Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/memory-index.html">Memory overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/migration-guide-cc13xx_cc26xx.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#terms-and-acronyms">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ti154stack-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ti154stack-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ti154stack-guide/ti154stack-index-cc13xx_cc26xx.html">TI 15.4-Stack</a> &raquo;</li>
      <li>Application Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="application-overview">
<span id="sec-application-overview"></span><h1>Application Overview<a class="headerlink" href="#application-overview" title="Permalink to this headline">¶</a></h1>
<p>TI 15.4-Stack example applications are designed to enable faster end-product
development by providing implementation of various common-protocol
stack-specific tasks, and other essential features such as nonvolatile memory
storage, saving information over power cycles, in addition to protocol
functionality. This chapter explains the example application implementation to
help developers quickly modify the TI 15.4-Stack out-of-box example applications for
customized development. The following sections detail the example applications
of the TI 15.4-Stack projects.</p>
<ul class="simple">
<li><p>Pre-RTOS initialization</p></li>
<li><p>Application architecture: the Application task which is the lowest priority
task in the system. The code for this task resides in the <code class="docutils literal notranslate"><span class="pre">Application</span></code>
IDE folder.</p></li>
<li><p>OSALPort: an interface module between TI 15.4-Stack services (such as TI 15.4-Stack APIs) as well as
certain primitive services (such as thread synchronization) provided by the real-time
operating system (<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>)</p></li>
</ul>
<div class="section" id="application-architecture">
<span id="sec-inc-architecture-standard-project-task-hierarchy"></span><h2>Application Architecture<a class="headerlink" href="#application-architecture" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#fig-example-application-block-diagram"><span class="std std-numref">Figure 22.</span></a> shows the block diagram of the
Sensor and Collector example applications. Refer to the <a class="reference external" href="http://www.ti.com/tool/TI-15.4-STACK-GATEWAY-LINUX-SDK#TechnicalDocuments">TI 15.4-Stack Linux
User’s Guide</a> for details on the Linux example applications on an external host
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-MCU"><span class="xref std std-term">MCU</span></a>.</p>
<div class="figure align-center" id="id6">
<span id="fig-example-application-block-diagram"></span><img alt="../_images/fig-example-application-block-diagram.png" src="../_images/fig-example-application-block-diagram.png" />
<p class="caption"><span class="caption-number">Figure 22. </span><span class="caption-text">Example Application Block Diagram</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>High-level descriptions of various blocks in <a class="reference internal" href="#fig-example-application-block-diagram"><span class="std std-numref">Figure 22.</span></a> follow:</p>
<p><strong>Example Application:</strong> The platform-independent implementation of the example
use case. The TI 15.4-Stack out-of-box demonstrates two use cases – Collector and
Sensor. Developers can modify the code in this module in out-of-box example
applications for custom application requirements, to quickly develop end
products. This is platform-independent code, used as in the Linux example
application and also the SimpleLink MCU platform example applications.</p>
<p><strong>Logical Link Controller:</strong> Implements various essential IEEE 802.15.4 specific
or Wi-SUN (for frequency-hopping configuration) specific tasks, such as network
formation, network joining, and rejoining. This block intends to offload various
protocol-specific implementations from the developers, and enable faster custom
application development. This is platform-independent code used in the Linux
example application and SimpleLink MCU platform example applications.</p>
<p>TI-RTOS7 <strong>Start-up Code:</strong> Initializes the application (see
<a class="reference internal" href="#sec-start-up-in-main"><span class="std std-ref">Start-Up in main()</span></a> for more details).</p>
<p><strong>Utility Functions:</strong> Provides various platform utilities which the application
can use for example LCD, timers, keys, and so on.</p>
<p><strong>Application-Specific Functions:</strong> Implements platform-specific functions such
as data storage over power cycles (non-volatile memory), and provides user
interface functions such as handling button presses or displaying essential
information on the LCD, and so on.</p>
<p><strong>TI 15.4-Stack API Module (API MAC Module):</strong> This module provides an interface
to the management and data services of the 802.15.4 stack through the OSALPort
Framework module.  This is further described in <a class="reference internal" href="#sec-osalport-framework"><span class="std std-ref">OSALPort Framework</span></a>.</p>
</div>
<div class="section" id="application-file-structure">
<h2>Application File Structure<a class="headerlink" href="#application-file-structure" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#fig-example-application-tree-diagram"><span class="std std-numref">Figure 23.</span></a> shows the basic application source tree
of the Sensor and Collector example applications. Refer to the <a class="reference external" href="http://www.ti.com/tool/TI-15.4-STACK-GATEWAY-LINUX-SDK#TechnicalDocuments">TI 15.4-Stack Linux
User’s Guide</a> for details on the Linux example applications on an external host
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-MCU"><span class="xref std std-term">MCU</span></a>.</p>
<div class="figure align-center" id="id7">
<span id="fig-example-application-tree-diagram"></span><img alt="../_images/fig-example-application-tree-diagram.png" src="../_images/fig-example-application-tree-diagram.png" />
<p class="caption"><span class="caption-number">Figure 23. </span><span class="caption-text">Example Application Source Tree</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>High-level descriptions of various folders in <a class="reference internal" href="#fig-example-application-tree-diagram"><span class="std std-numref">Figure 23.</span></a> follow:</p>
<ul>
<li><p><strong>Application:</strong> Includes all files associated with the application layer of a TI 15.4-Stack based example;
in the image above we show the basic sensor/collector examples, on these examples the application layer
is composed of:</p>
<blockquote>
<div><ul>
<li><p><strong>Sensor/Collector:</strong></p>
<blockquote>
<div><ul>
<li><p><strong>collector/sensor.[c/h]:</strong> The TI 15.4-Stack out-of-box examples demonstrates two use cases – Collector and
Sensor. These source files contain the “main” loop of the application, some of the functions and values
that these source files handle and control are:</p>
<blockquote>
<div><ul class="simple">
<li><p>handling periodic events such as: reading sensors, sending poll messages, sending broadcast
messages, etc.</p></li>
<li><p>handling incoming messages</p></li>
<li><p>sending sensor data messages</p></li>
<li><p>store data structures such as: event states, timeout values, and statistics</p></li>
</ul>
</div></blockquote>
<p>Developers can modify the code in these files to match their custom application requirements and
quickly develop end products. For a more in depth description on these, please refer to the READMES
in the imported projects.</p>
</li>
<li><p><strong>csf/ssf.[c/h]:</strong> These files, which stand for collector/sensor specific functions, provides various
platform utilities that the application can use for example LCD, timers, keys, and so on.</p></li>
<li><p><strong>smsgs.h:</strong> Contains all data structures for messages sent over the air.</p></li>
<li><p><strong>link_controller:</strong> Implements various essential IEEE 802.15.4 specific
or Wi-SUN (for frequency-hopping configuration) specific tasks, such as network
formation, network joining, and rejoining. This block intends to offload various
protocol-specific implementations from the developers, and enable faster custom
application development. Some of the responsabilities of these sources are
to handle responses received from the MAC by using callback functions to trigger
different events and also populating key structures that can be used by the higher
level application layer.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>CUI:</strong> Has all the source code that controls the serial console user interface, for more information
on this module you can refer to <a class="reference internal" href="common-user-interface.html#chap-ti154stack-commonuserinterface"><span class="std std-ref">Common User Interface</span></a>.</p></li>
<li><p><strong>defines:</strong> Contains all the pre-defined symbols for the project. Here you can modify some
stack parameters such as AUTO_START, NV_RESTORE, Sensor Type, etc…</p></li>
<li><p><strong>Main.c:</strong> This file will handle any asserts, the main task functions to start
up the application, and functions that read memory addresses. Also responsible for setting up NV drivers,
initializing the collector application, initializing CUI, and kick starting the main task function called
appTaskFxn which will trigger the respective application to begin. Also includes user defined assert handler
functions for various asserts. (see <a class="reference internal" href="#sec-start-up-in-main"><span class="std std-ref">Start-Up in main()</span></a> for more details).</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Release:</strong> This folder will be empty by default, but will get filled by all of the compiler’s output files
once you trigger the first build of the project. Here you will also find the output binaries that you can
use to flash onto devices using <a class="reference external" href="http://www.ti.com/tool/flash-programmer">SmartRF Flash Programmer</a> or <a class="reference external" href="http://www.ti.com/tool/uniflash">Uniflash</a> .</p></li>
<li><p><strong>Software_stack:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><strong>MAC:</strong> Contains the user accessible APIs and task that runs all API requests done by the application.
Here you will find mac specific settings such lower and upper bounds for some parameters, and allocation
sizes for message queues.</p></li>
<li><p><strong>NV:</strong> The NV area of flash is used for storing persistent data for the application. TI 15.4-Stack
uses the NV On-Chip Multi-Page (NVOCMP) driver to maintain this memory area.</p></li>
<li><p><strong>OSAL:</strong> provides an interface to the management and data services of the 802.15.4 stack through
the OSALPort Framework module.  This is further described in <a class="reference internal" href="#sec-osalport-framework"><span class="std std-ref">OSALPort Framework</span></a>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>sensor/collector[.syscfg]:</strong> (Only CC13xx/CC26xx) These configuration files
take advantage of the System Configuration Tool (SysConfig) is a graphical
interface for configuring your <a class="reference external" href="http://www.ti.com/tool/simplelink-cc13xx-cc26xx-sdk">SimpleLink CC13xx/CC26xx SDK</a> project. Configuration files, C source
files and header files are generated based on the parameters configured in the
SysConfig dashboard. If you want to learn more about SysConfig you can go to
the SysConfig chapter.</p></li>
</ul>
</div>
<div class="section" id="start-up-in-main">
<span id="sec-start-up-in-main"></span><h2>Start-Up in main()<a class="headerlink" href="#start-up-in-main" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">main()</span></code> function inside of <code class="docutils literal notranslate"><span class="pre">main.c</span></code> is the application starting point
at runtime. This point is where the board is brought up with interrupts disabled
and board-related components are initialized. Tasks in this function are
configured by initializing the necessary parameters, setting its priority, and
initializing the stack size for the application. In the final step, interrupts
are enabled and the <code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code> kernel scheduler is started by calling
<code class="docutils literal notranslate"><span class="pre">BIOS_start()</span></code>, which does not return. See the <a class="reference external" href="http://www.ti.com/lit/pdf/swcu185">CC13x2 CC26x2 SimpleLink Wireless MCU Technical Reference Manual</a> for information on
the start-up sequence before <code class="docutils literal notranslate"><span class="pre">main()</span></code> is reached.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * @brief       &quot;main()&quot; function - starting point</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Task_Params</span><span class="w"> </span><span class="n">taskParams</span><span class="p">;</span><span class="w"></span>

<span class="cp">#ifndef USE_DEFAULT_USER_CFG</span>
<span class="w">    </span><span class="n">macUser0Cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pAssertFP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assertHandler</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     Initialization for board related stuff such as LEDs</span>
<span class="cm">     following TI-RTOS convention</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="n">Board_init</span><span class="p">();</span><span class="w"></span>

<span class="cp">#if defined(FEATURE_BLE_OAD) &amp;&amp; !defined(OAD_IMG_A)</span>
<span class="w">    </span><span class="cm">/* If FEATURE_BLE_OAD is enabled, look for a left button</span>
<span class="cm">     *  press on reset. This indicates to revert to some</span>
<span class="cm">     *  factory image</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">PIN_getInputValue</span><span class="p">(</span><span class="n">CONFIG_PIN_BTN1</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">OAD_markSwitch</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif </span><span class="cm">/* FEATURE_BLE_OAD */</span><span class="cp"></span>

<span class="cp">#if (defined(FEATURE_BLE_OAD) || defined(FEATURE_NATIVE_OAD)) &amp;&amp; !defined(OAD_ONCHIP)</span>
<span class="w">    </span><span class="n">SPI_init</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#if !defined(POWER_MEAS) &amp;&amp; !defined(CUI_DISABLE)</span>
<span class="w">    </span><span class="cm">/* Initialize CUI UART */</span><span class="w"></span>
<span class="w">    </span><span class="n">CUI_params_t</span><span class="w"> </span><span class="n">cuiParams</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">CUI_paramsInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cuiParams</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// One-time initialization of the CUI</span>

<span class="w">    </span><span class="c1">// All later CUI_* functions will be ignored if this isn&#39;t called</span>
<span class="w">    </span><span class="n">CUI_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cuiParams</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#ifdef OSAL_PORT2TIRTOS</span>
<span class="w">    </span><span class="n">_macTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macTaskInit</span><span class="p">(</span><span class="n">macUser0Cfg</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Configure task. */</span><span class="w"></span>
<span class="w">    </span><span class="n">Task_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appTaskStack</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">stackSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_TASK_STACK_SIZE</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_TASK_PRIORITY</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Task_construct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appTask</span><span class="p">,</span><span class="w"> </span><span class="n">appTaskFxn</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="cp">#ifdef USE_ITM_DBG</span>
<span class="w">    </span><span class="n">ITM_config</span><span class="w"> </span><span class="n">itm_config</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="mi">48000000</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">ITM_6000000</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">ITM_initModule</span><span class="p">(</span><span class="n">itm_config</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ITM_enableModule</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif </span><span class="cm">/* USE_ITM_DBG */</span><span class="cp"></span>

<span class="w">    </span><span class="n">BIOS_start</span><span class="p">();</span><span class="w"> </span><span class="cm">/* enable interrupts and start SYS/BIOS */</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="osalport-framework">
<span id="sec-osalport-framework"></span><h2>OSALPort Framework<a class="headerlink" href="#osalport-framework" title="Permalink to this headline">¶</a></h2>
<p>OSALPort is a module that provides a mechanism for the Application to
interface with TI 15.4-Stack services (such as TI 15.4-Stack APIs), as well as certain
primitive services (such as thread synchronization) provided by the real-time
operating system (<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>). OSALPort allows both the Application and
protocol stack tasks to efficiently operate, communicate, and share resources in
a unified <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> environment.</p>
<div class="figure align-center" id="id8">
<span id="fig-osalport-block-diagram"></span><a class="reference internal image-reference" href="../_images/fig-osalport-block-diagram.png"><img alt="../_images/fig-osalport-block-diagram.png" src="../_images/fig-osalport-block-diagram.png" style="width: 225.60000000000002px; height: 273.6px;" /></a>
<p class="caption"><span class="caption-number">Figure 24. </span><span class="caption-text">OSALPort Application – Protocol Stack Abstraction</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="osalport-protocol-stack-service">
<span id="sec-osalport-ti154stack-service"></span><h3>OSALPort Protocol Stack Service<a class="headerlink" href="#osalport-protocol-stack-service" title="Permalink to this headline">¶</a></h3>
<p>As depicted in <a class="reference internal" href="#fig-osalport-block-diagram"><span class="std std-numref">Figure 24.</span></a>, the OSALPort core use case
involves messages between a server entity (the TI 15.4-Stack task) and a client
entity (the Application task). The reasoning for this architecture is twofold:
to enable independent updating of the application and TI 15.4-Stack, and to
maintain API consistency as the software is ported from legacy platforms (for
example OSAL for the CC253x) to the CC13xx or CC26xx TI-RTOS7. The OSALPort TI 15.4-Stack
Service serves as the Application interface to all TI 15.4-Stack APIs.
Internally, when a TI 15.4-Stack protocol stack API is called by the
Application, the OSALPort module routes (dispatches) the command to the
TI 15.4-Stack, and where appropriate, routes messages from the TI 15.4-Stack to the Application.</p>
</div>
<div class="section" id="osalport-service">
<span id="sec-osalport-service"></span><h3>OSALPort Service<a class="headerlink" href="#osalport-service" title="Permalink to this headline">¶</a></h3>
<p>OSALPort includes a service that abstracts various operating
system-related functions. Due to shared resources, and to maintain interprocess
communication, the Application must use the following OSALPort
service functions.</p>
<ul class="simple">
<li><p>Messaging and Thread Synchronization</p></li>
<li><p>Heap Allocation and Management</p></li>
</ul>
<div class="section" id="messaging-and-thread-synchronization">
<span id="sec-messaging-and-thread-synchronization"></span><h4>Messaging and Thread Synchronization<a class="headerlink" href="#messaging-and-thread-synchronization" title="Permalink to this headline">¶</a></h4>
<p>The messaging and thread synchronization functions provided by the OSALPort
let users design an application to protocol stack interface in the multithreaded
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> environment. Within the OSALPort, messaging between two tasks is
achieved by sending a message block from one thread to the other using a message
queue. The sender allocates memory, writes the content of the message into the
memory block, and then sends (enqueues) the memory block to the recipient.
Notification of message delivery is accomplished using a signaling semaphore.
The receiver wakes up on the semaphore, copies the message memory block (or
blocks), processes the message, and returns (frees) the memory block to the heap.</p>
<p>The Stack uses the OSALPort for notifying and sending messages to the
Application. These service messages (such as state change notifications)
received by the Application task are delivered by the OSALPort and
processed in the task context of the Application.</p>
</div>
<div class="section" id="heap-allocation-and-management">
<span id="sec-heap-allocation-and-management"></span><h4>Heap Allocation and Management<a class="headerlink" href="#heap-allocation-and-management" title="Permalink to this headline">¶</a></h4>
<p>The OSALPort provides the Application with global heap APIs for dynamic
memory allocation. OSALPort uses
this heap for all protocol stack messaging as well as to obtain memory for other
OSALPort services. TI recommends that the Application uses these
OSALPort APIs for dynamic memory allocation within the Application.</p>
</div>
</div>
<div class="section" id="osalport-initialization-and-registration">
<span id="sec-osalport-init-and-registration"></span><h3>OSALPort Initialization and Registration<a class="headerlink" href="#osalport-initialization-and-registration" title="Permalink to this headline">¶</a></h3>
<p>To instantiate and initialize the OSALPort service, the following functions
must be called by the application in <code class="docutils literal notranslate"><span class="pre">main()</span></code> before starting the <code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code>
kernel scheduler.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">_macTaskId</span><span class="p">;</span><span class="w"></span>
<span class="n">_macTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macTaskInit</span><span class="p">(</span><span class="n">macUser0Cfg</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Calling <code class="docutils literal notranslate"><span class="pre">macTaskInit(macUser0Cfg)</span></code> initializes the OSALPort service
(for example, heap manager) and framework. Calling <code class="docutils literal notranslate"><span class="pre">Sensor_init(_macTaskId)</span></code>
in <code class="docutils literal notranslate"><span class="pre">appTaskFxn</span></code> creates, but does not start, the TI 15.4-Stack protocol stack task.</p>
<p>Semaphores must be created to send and receive messages
through the OSALPort. This registration is done for the application in
<code class="code docutils literal notranslate"><span class="pre">zclSampleLight_initialization()</span></code>, which is called by the application’s initialization
functions. The following is the call to the OSALPort in <code class="docutils literal notranslate"><span class="pre">ApiMac_init()</span></code>
in <code class="code docutils literal notranslate"><span class="pre">api_mac.c</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Semaphore_Params</span><span class="w"> </span><span class="n">semParam</span><span class="p">;</span><span class="w"></span>

<span class="n">macTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macTaskIdParam</span><span class="p">;</span><span class="w"></span>

<span class="n">Semaphore_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="n">semParam</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Semaphore_Mode_BINARY</span><span class="p">;</span><span class="w"></span>
<span class="n">Semaphore_construct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appSem</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="n">appSemHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Semaphore_handle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appSem</span><span class="p">);</span><span class="w"></span>

<span class="n">appTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OsalPort_registerTask</span><span class="p">(</span><span class="n">Task_self</span><span class="p">(),</span><span class="w"> </span><span class="n">appSemHandle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appEvents</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask</span></code> supplies the <code class="code docutils literal notranslate"><span class="pre">Task_self()</span></code>, <code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code>,
and <code class="code docutils literal notranslate"><span class="pre">appEvents</span></code>  inputs which then returns the <code class="code docutils literal notranslate"><span class="pre">appTaskId</span></code>
subsequently used by the OSALPort to facilitate messages between the Application and server
tasks. The <code class="code docutils literal notranslate"><span class="pre">Task_self()</span></code> argument points to the task destination message queue,
<code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> represents the semaphore used for signaling, and
<code class="code docutils literal notranslate"><span class="pre">appEvents</span></code> points to the event flag. Each task registering with the OSALPort
has unique <code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> and <code class="code docutils literal notranslate"><span class="pre">appEvents</span></code> identifiers.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>TI 15.4-Stack APIs defined in zstackapi.c, and other OSALPort services,
are not available for use before OSALPort registration.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="osalport-thread-synchronization">
<span id="sec-osalport-thread-synchronization"></span><h3>OSALPort Thread Synchronization<a class="headerlink" href="#osalport-thread-synchronization" title="Permalink to this headline">¶</a></h3>
<p>The OSALPort module switches between Application and Stack threads through
the use of semaphore synchronization services provided by the
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>.  To allow a client or a server thread to block until it receives a
message, OSALPort uses <code class="code docutils literal notranslate"><span class="pre">Semaphore_pend(appSemHandle,</span> <span class="pre">BIOS_WAIT_FOREVER</span> <span class="pre">)</span></code>.
This blocks until the semaphore associated with the caller <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread is posted.</p>
<p>Allowing an application or a server thread to block yields the
processor resource to other lower priority threads, or conserves energy by
shutting down power and clock domains whenever possible. The semaphore
associated with an <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread is signaled by either of the following
conditions.</p>
<ul class="simple">
<li><p>A new message is queued to the Application <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread queue.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> is called for the semaphore.</p></li>
</ul>
<p><code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> is provided so that an application or a server can add
its own event to unblock <code class="code docutils literal notranslate"><span class="pre">Semaphore_pend()</span></code> and synchronize the thread.
<code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> accepts a semaphore handle
<code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> as its sole argument. The semaphore handle
associated with the thread is registered through the <code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask()</span></code> call.</p>
</div>
<div class="section" id="example-osalport-usage">
<span id="sec-example-osalport-usage"></span><h3>Example OSALPort Usage<a class="headerlink" href="#example-osalport-usage" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#fig-osalport-messaging-example"><span class="std std-numref">Figure 25.</span></a> shows an example command being sent from
the application to the TI 15.4-Stack through the OSALPort, with a corresponding
return value passed back to the application. <code class="code docutils literal notranslate"><span class="pre">macTaskInit(macUser0Cfg)</span></code> initializes
the OSALPort module instance itself and <code class="code docutils literal notranslate"><span class="pre">Sensor_init(_macTaskId)</span></code>
creates a task per external image, with an entry function at a known address.
After initializing the OSALPort, the Application task registers with the
OSALPort using <code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask</span></code>. After the SYS/BIOS
scheduler starts and the Application task runs, the application sends a protocol
command defined in <code class="code docutils literal notranslate"><span class="pre">cllc.c</span></code> such as <code class="code docutils literal notranslate"><span class="pre">ApiMac_mlmeSetReqArray()</span></code>.
The protocol command is not executed in the application thread. Instead the
command is encapsulated in an OSALPort message and routed to the TI 15.4-Stack
task through the OSALPort. In other words, this command is sent to the
OSALPort where it is then executed on the TI 15.4-Stack. The Application thread meanwhile
blocks (waits for) the corresponding command status message (status). When the TI 15.4-Stack
protocol stack finishes executing the command, the command status message response is
sent through the OSALPort back to the application thread.</p>
<div class="figure align-center" id="id9">
<span id="fig-osalport-messaging-example"></span><p class="plantuml">
<img src="../_images/plantuml-4f2496df910b769e57c1ef08a6a6248c6ba01a28.png" alt="&#64;startuml
App-&gt;OSALPort: macTaskInit(macUser0Cfg)
App-&gt;OSALPort: Sensor_init(_macTaskId)
App-&gt;OSALPort: OsalPort_registerTask
App-&gt;OSALPort: ApiMac_mlmeSetReqArray()\nMAC_SET_REQ
OSALPort-&gt;&quot;TI 15.4-Stack&quot;: &quot;Semaphore_pend\n(TI 15.4 MAC Primitive Service)&quot;
note over App: App Task Blocks
note over &quot;TI 15.4-Stack&quot;: Stack Executes\nBDB_SET_REQ
&quot;TI 15.4-Stack&quot;-&gt;OSALPort: Semaphore_post(sendCmdStatus)
OSALPort-&gt;App: Semaphore_post(sendCmdStatus)
&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 25. </span><span class="caption-text">OSALPort Messaging Example</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="system-stack">
<span id="sec-memory-management-154-system-stack"></span><h3>System Stack<a class="headerlink" href="#system-stack" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following does not apply to CC13x4 or CC26x4. CC13x4 or CC26x4 system stack is
configured using <a class="reference internal" href="../sysconfig/getting-started.html#sysconfig-sysconfig"><span class="std std-ref">Get started with SysConfig</span></a> tool.</p>
</div>
<p>Besides the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> heap previously mentioned, there are other
sections of memory to consider. As described in <a class="reference internal" href="../ti154stack-guide/tirtos-index-cc13xx_cc26xx.html#sec-tirtos-overview"><span class="std std-ref">TI-RTOS7 (RTOS Kernel) Overview</span></a>, each
task has its own runtime stack for context switching. Furthermore, another
runtime stack is used by the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> for main(), HWIs, and SWIs. This
system stack is allocated in the Application linker file, to be placed at the
end of the RAM of the Application.</p>
<p>For CCS, the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> system stack size is defined in the linker file as shown below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* C stack is also used for ISR stack */</span><span class="w"></span>
<span class="o">--</span><span class="n">stack_size</span><span class="o">=</span><span class="mh">0x560</span><span class="w"></span>
</pre></div>
</div>
<p>Then the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> system stack is placed by the linker in the RAM space of
the Application. Defined in the linker file as below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Create global constant that points to top of stack */</span><span class="w"></span>
<span class="cm">/* CCS: Change stack size under Project Properties */</span><span class="w"></span>
<span class="n">__STACK_TOP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__stack</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">__STACK_SIZE</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="general-application-architecture">
<span id="sec-general-application-architecture"></span><h2>General Application Architecture<a class="headerlink" href="#general-application-architecture" title="Permalink to this headline">¶</a></h2>
<p>This section describes how an Application task is structured in more detail.
Having an understand of the out of box application architecture will allow
develop custom applications quickly and easily with most software reuse from out
of box example applications.</p>
<div class="section" id="application-initialization-function">
<span id="sec-application-init-function"></span><h3>Application Initialization Function<a class="headerlink" href="#application-initialization-function" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../tirtos/tasks.html#sec-rtos-overview-tasks"><span class="std std-ref">Tasks</span></a> describes how a task is constructed. After the
task is constructed and the <code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code> kernel scheduler is started, the
function that was passed during task construction is run when the task is ready.
Power-management functions are initialized here and the OSALPort module is
initialized through <code class="docutils literal notranslate"><span class="pre">Sensor_init(_macTaskId)</span></code>. The primary IEEE address (programmed by
TI) is obtained from the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-CCFG"><span class="xref std std-term">CCFG</span></a> area of the flash memory and NV drivers
are initialized. The application task (Sensor application in
<a class="reference internal" href="#fig-sensor-task-flow-chart"><span class="std std-numref">Figure 26.</span></a>) is initialized and started.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * @brief       Main task function</span>
<span class="cm"> *</span>
<span class="cm"> * @param       a0 -</span>
<span class="cm"> * @param       a1 -</span>
<span class="cm"> */</span><span class="w"></span>
<span class="n">Void</span><span class="w"> </span><span class="nf">appTaskFxn</span><span class="p">(</span><span class="n">UArg</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">UArg</span><span class="w"> </span><span class="n">a1</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* The following code encapsulated in TI_154STACK_FPGA flag is used for</span>
<span class="cm">     * internal FPGA evaluation of the 15.4 Stack and should not be used with</span>
<span class="cm">     * TI hardware platforms. */</span><span class="w"></span>
<span class="cp">#ifdef TI_154STACK_FPGA</span>
<span class="w">    </span><span class="cm">/* FPGA build disables POWER constraints */</span><span class="w"></span>
<span class="w">    </span><span class="n">Power_setConstraint</span><span class="p">(</span><span class="n">PowerCC26XX_IDLE_PD_DISALLOW</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Power_setConstraint</span><span class="p">(</span><span class="n">PowerCC26XX_SB_DISALLOW</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">IOCPortConfigureSet</span><span class="p">(</span><span class="n">IOID_4</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_PORT_RFC_GPO0</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_IOMODE_NORMAL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">IOCPortConfigureSet</span><span class="p">(</span><span class="n">IOID_5</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_PORT_RFC_GPI0</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_INPUT_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">IOCPortConfigureSet</span><span class="p">(</span><span class="n">IOID_15</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_PORT_RFC_TRC</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_IOMODE_NORMAL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// configure RF Core SMI Command Link</span>
<span class="c1">//    IOCPortConfigureSet(IOID_22, IOC_IOCFG0_PORT_ID_RFC_SMI_CL_OUT, IOC_STD_OUTPUT);</span>
<span class="c1">//    IOCPortConfigureSet(IOID_21, IOC_IOCFG0_PORT_ID_RFC_SMI_CL_IN, IOC_STD_INPUT);</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef OSAL_PORT2TIRTOS</span>
<span class="w">    </span><span class="cm">/* Initialize ICall module */</span><span class="w"></span>
<span class="w">    </span><span class="n">ICall_init</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="cm">/* Copy the extended address from the CCFG area */</span><span class="w"></span>
<span class="w">    </span><span class="n">CCFGRead_IEEE_MAC</span><span class="p">(</span><span class="n">ApiMac_extAddr</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Check to see if the CCFG IEEE is valid */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">ApiMac_extAddr</span><span class="p">,</span><span class="w"> </span><span class="n">dummyExtAddr</span><span class="p">,</span><span class="w"> </span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* No, it isn&#39;t valid.  Get the Primary IEEE Address */</span><span class="w"></span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">ApiMac_extAddr</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">FCFG1_BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">EXTADDR_OFFSET</span><span class="p">),</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="cp">#ifdef NV_RESTORE</span>
<span class="w">    </span><span class="cm">/* Setup the NV driver */</span><span class="w"></span>
<span class="w">    </span><span class="n">NVOCMP_loadApiPtrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">(</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Initialize the application */</span><span class="w"></span>
<span class="cp">#ifdef OSAL_PORT2TIRTOS</span>
<span class="w">    </span><span class="n">Sensor_init</span><span class="p">(</span><span class="n">_macTaskId</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">ICall_createRemoteTasks</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Initialize the application */</span><span class="w"></span>
<span class="w">    </span><span class="n">Sensor_init</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Kick off application - Forever loop */</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Sensor_process</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>For example, in the sensor example application file <code class="docutils literal notranslate"><span class="pre">main.c</span></code> function
<code class="docutils literal notranslate"><span class="pre">taskfxn()</span></code>, the initialization function</p>
<p><code class="docutils literal notranslate"><span class="pre">Sensor_init()</span></code> sets several software configuration settings as well as
parameters. Some examples are:</p>
<ul class="simple">
<li><p>Initializing structures for sensor data</p></li>
<li><p>Initializing TI 15.4-Stack</p></li>
<li><p>Setting up the security and logical link controller</p></li>
<li><p>Registering MAC callbacks</p></li>
</ul>
</div>
<div class="section" id="event-processing-in-the-task-function">
<span id="sec-event-processing-task-function"></span><h3>Event Processing in the Task Function<a class="headerlink" href="#event-processing-in-the-task-function" title="Permalink to this headline">¶</a></h3>
<p>In the initialization function in the previous code snippet, the task function
enters an infinite loop so to continuously process as an independent task and
does not run to completion, seen in <a class="reference internal" href="#fig-sensor-task-flow-chart"><span class="std std-numref">Figure 26.</span></a>.</p>
<div class="figure align-center" id="id10">
<span id="fig-sensor-task-flow-chart"></span><img alt="../_images/fig-sensor-task-flow-chart.jpeg" src="../_images/fig-sensor-task-flow-chart.jpeg" />
<p class="caption"><span class="caption-number">Figure 26. </span><span class="caption-text">Sensor Example Application Task Flow Chart</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<p><a class="reference internal" href="#fig-sensor-task-flow-chart"><span class="std std-numref">Figure 26.</span></a> shows various reasons for posting to the
semaphore, causing the task to become active.</p>
<div class="section" id="events-signaled-through-the-internal-event-variable">
<span id="sec-events-signaled-through-internal-event-variable"></span><h4>Events Signaled Through the Internal Event Variable<a class="headerlink" href="#events-signaled-through-the-internal-event-variable" title="Permalink to this headline">¶</a></h4>
<p>The Application task uses an event variable bit mask to identify what action
caused the process to wake up, and takes appropriate action. Each bit of the
event variable corresponds to a defined event such as:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*! Event ID - Start the device in the network */</span><span class="w"></span>
<span class="cp">#define SENSOR_START_EVT 0x0001</span>

<span class="cm">/*! Event ID - Reading Timeout Event */</span><span class="w"></span>
<span class="cp">#define SENSOR_READING_TIMEOUT_EVT 0x0002</span>
</pre></div>
</div>
</div></blockquote>
<p>Whichever function sets this bit in the event variable must also ensure to post
to the semaphore, to wake up the application for processing. An example of this
is the clock handler which handles clock timeouts.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="cm">/* Is it time to send the next sensor data message? */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Sensor_events</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SENSOR_READING_TIMEOUT_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="cp">#if !defined(OAD_IMG_A)</span>

<span class="w">        </span><span class="cm">/* In certification test mode, back to back data shall be sent */</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CERTIFICATION_TEST_MODE</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* Setup for the next message */</span><span class="w"></span>
<span class="w">            </span><span class="n">Ssf_setReadingClock</span><span class="p">(</span><span class="n">configSettings</span><span class="p">.</span><span class="n">reportingInterval</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="cp">#ifdef FEATURE_SECURE_COMMISSIONING</span>
<span class="w">        </span><span class="cm">/* if secure Commissioning feature is enabled, read</span>
<span class="cm">         * sensor data and send it only after the secure</span>
<span class="cm">         * commissioning process is done successfully.</span>
<span class="cm">         * else, do not read and send sensor data.</span>
<span class="cm">         */</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">SM_Last_State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">SM_CM_InProgress</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">//FEATURE_SECURE_COMMISSIONING</span>


<span class="cp">#if SENSOR_TEST_RAMP_DATA_SIZE</span>
<span class="w">        </span><span class="n">processSensorRampMsgEvt</span><span class="p">();</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">        </span><span class="cm">/* Read sensors */</span><span class="w"></span>
<span class="w">        </span><span class="n">readSensors</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* Process Sensor Reading Message Event */</span><span class="w"></span>
<span class="w">        </span><span class="n">processSensorMsgEvt</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">//SENSOR_TEST_RAMP_DATA_SIZE</span>
<span class="cp">#ifdef FEATURE_SECURE_COMMISSIONING</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">//FEATURE_SECURE_COMMISSIONING</span>

<span class="cp">#endif </span><span class="c1">//OAD_IMG_A</span>

<span class="w">        </span><span class="cm">/* Clear the event */</span><span class="w"></span>
<span class="w">        </span><span class="n">Util_clearEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Sensor_events</span><span class="p">,</span><span class="w"> </span><span class="n">SENSOR_READING_TIMEOUT_EVT</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>When adding an event, it must be unique for the given task and be a power of 2
(so that only 1 bit is set). Because the event variable is initialized as
<code class="docutils literal notranslate"><span class="pre">uint16_t</span></code>, this setup allows for a maximum of 16 internal events.</p>
</div>
</div>
<div class="section" id="callbacks">
<span id="sec-callbacks"></span><h3>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h3>
<p>The application code also likely includes various callbacks from the protocol
stack layer and RTOS modules. To ensure thread safety, processing should be
minimized in the actual callback, and the bulk of the processing should be done
in the application context. The following code snippet directs the callbacks
through <code class="docutils literal notranslate"><span class="pre">ApiMac_processIncoming()</span></code> to the correct MAC API using the
OSALPort after all the application events are processed.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Sensor_process</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Start the collector device in the network */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Sensor_events</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SENSOR_START_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">..</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Is it time to send the next sensor data message? */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Sensor_events</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SENSOR_READING_TIMEOUT_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">..</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Process LLC Events */</span><span class="w"></span>
<span class="w">    </span><span class="n">Jdllc_process</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Allow the Specific functions to process */</span><span class="w"></span>
<span class="w">    </span><span class="n">Ssf_processEvents</span><span class="p">();</span><span class="w"></span>

<span class="cp">#ifdef FEATURE_SECURE_COMMISSIONING</span>
<span class="w">    </span><span class="cm">/* Allow the security manager specific functions to process */</span><span class="w"></span>
<span class="w">    </span><span class="n">SM_process</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif </span><span class="cm">/* FEATURE_SECURE_COMMISSIONING */</span><span class="cp"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     Don&#39;t process ApiMac messages until all of the sensor events</span>
<span class="cm">     are processed.</span>
<span class="cm">     */</span><span class="w"></span>
<span class="cp">#ifdef FEATURE_SECURE_COMMISSIONING</span>
<span class="w">    </span><span class="cm">/*only if there are no sensor events and security manager events to handle*/</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">Sensor_events</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">SM_events</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Sensor_events</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* Wait for response message or events */</span><span class="w"></span>
<span class="w">        </span><span class="n">ApiMac_processIncoming</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>The previous code snippet directs the callbacks to the correct MAC API using
OSALPort. Two functions are defined per callback, one at the application
level, the other in the MAC API. For example, consider the handling of a scan
confirm in the following code snippet.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nl">MAC_MLME_SCAN_CNF</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pMacCallbacks</span><span class="o">-&gt;</span><span class="n">pScanCnfCb</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">processScanCnf</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">.</span><span class="n">scanType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ApiMac_scantype_energyDetect</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pEnergyDetect</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">OsalPort_free</span><span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pEnergyDetect</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pPanDescriptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">OsalPort_free</span><span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">scanCnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pPanDescriptor</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>The MAC API callback is overwritten by the following application callback.
<code class="docutils literal notranslate"><span class="pre">pMacCbs-&gt;pScanCnfCb</span> <span class="pre">=</span> <span class="pre">scanCnfCb;</span></code> At the application level.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * @brief       Process  Scan Confirm  callback.</span>
<span class="cm"> *</span>
<span class="cm"> * @param       pData - pointer to Scan Confirm</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">scanCnfCb</span><span class="p">(</span><span class="n">ApiMac_mlmeScanCnf_t</span><span class="w"> </span><span class="o">*</span><span class="n">pData</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pData</span><span class="o">-&gt;</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ApiMac_status_success</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">pData</span><span class="o">-&gt;</span><span class="n">scanType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ApiMac_scantype_active</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* Only send association requests for a matching PAN */</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">panIdMatch</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="cm">/* Set event to send Association Request */</span><span class="w"></span>
<span class="w">                </span><span class="n">Util_setEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Jdllc_events</span><span class="p">,</span><span class="w"> </span><span class="n">JDLLC_ASSOCIATE_REQ_EVT</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="cm">/* The current scan didn&#39;t return a matching beacon */</span><span class="w"></span>

<span class="w">                </span><span class="cm">/* Turn off receiver until next scan if RX on idle is false*/</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">!</span><span class="n">CONFIG_FH_ENABLE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">CONFIG_RX_ON_IDLE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">ApiMac_mlmeSetReqBool</span><span class="p">(</span><span class="n">ApiMac_attribute_RxOnWhenIdle</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_RX_ON_IDLE</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>

<span class="w">                </span><span class="cm">/* schedule next scan */</span><span class="w"></span>
<span class="w">                </span><span class="n">devInfoBlock</span><span class="p">.</span><span class="n">prevDevState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">devInfoBlock</span><span class="p">.</span><span class="n">currentDevState</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">Ssf_setScanBackoffClock</span><span class="p">(</span><span class="n">CONFIG_SCAN_BACKOFF_INTERVAL</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* ….. */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">macCallbacksCopy</span><span class="p">.</span><span class="n">pScanCnfCb</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">macCallbacksCopy</span><span class="p">.</span><span class="n">pScanCnfCb</span><span class="p">(</span><span class="n">pData</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>The following code is at the MAC API level.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * @brief       Process the incoming Scan Confirm callback.</span>
<span class="cm"> *</span>
<span class="cm"> * @param       pCnf - pointer MAC Scan Confirm info</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processScanCnf</span><span class="p">(</span><span class="n">macMlmeScanCnf_t</span><span class="w"> </span><span class="o">*</span><span class="n">pCnf</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Confirmation structure */</span><span class="w"></span>
<span class="w">    </span><span class="n">ApiMac_mlmeScanCnf_t</span><span class="w"> </span><span class="n">cnf</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Initialize the structure */</span><span class="w"></span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cnf</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ApiMac_mlmeScanCnf_t</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* copy the message to the confirmation structure */</span><span class="w"></span>
<span class="w">    </span><span class="n">cnf</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ApiMac_status_t</span><span class="p">)</span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">cnf</span><span class="p">.</span><span class="n">scanType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ApiMac_scantype_t</span><span class="p">)</span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">scanType</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">cnf</span><span class="p">.</span><span class="n">channelPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">channelPage</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">cnf</span><span class="p">.</span><span class="n">phyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">phyID</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">cnf</span><span class="p">.</span><span class="n">unscannedChannels</span><span class="p">,</span><span class="w"> </span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">unscannedChannels</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">APIMAC_154G_CHANNEL_BITMAP_SIZ</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">cnf</span><span class="p">.</span><span class="n">resultListSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">resultListSize</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cnf</span><span class="p">.</span><span class="n">resultListSize</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cnf</span><span class="p">.</span><span class="n">scanType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ApiMac_scantype_energyDetect</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">cnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pEnergyDetect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">.</span><span class="n">pEnergyDetect</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">cnf</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">pPanDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="n">ApiMac_panDesc_t</span><span class="o">*</span><span class="p">)</span><span class="n">pCnf</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">.</span><span class="n">pPanDescriptor</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * Initiate the callback, no need to check pMacCallbacks or the function</span>
<span class="cm">     * pointer for non-null, the calling function will check the function</span>
<span class="cm">     * pointer</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="n">pMacCallbacks</span><span class="o">-&gt;</span><span class="n">pScanCnfCb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cnf</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="non-volatile-memory">
<span id="sec-nv"></span><h2>Non-Volatile Memory<a class="headerlink" href="#non-volatile-memory" title="Permalink to this headline">¶</a></h2>
<p>The NV area of flash is used for storing persistent data for the application. TI
15.4-Stack uses the NV On-Chip Multi-Page (NVOCMP) driver to maintain this memory
area. Please refer to <code class="docutils literal notranslate"><span class="pre">nvocmp.c</span></code> which describes the implementation details of
the multi-page NV and lists the maximum values of custom NV IDs available to the
application.  The last page in flash is the CCA page, the pages before that are
reserved for the NV area as defined by <code class="docutils literal notranslate"><span class="pre">NVOCMP_NVPAGES</span></code>. The example projects
use the NV driver with the API defined in <code class="docutils literal notranslate"><span class="pre">nvintf.h</span></code>.</p>
<p>The NV driver is set up in main.c:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef NV_RESTORE</span>
<span class="w">    </span><span class="cm">/* Setup the NV driver */</span><span class="w"></span>
<span class="cp">#ifdef ONE_PAGE_NV</span>
<span class="w">    </span><span class="n">NVOCOP_loadApiPtrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">NVOCMP_loadApiPtrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Main_user1Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">(</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Then the applications use the function pointers in Main_user1Cfg to call the NV
functions defined in nvintf.h:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Structure of NV API function pointers</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span> <span class="nc">nvintf_nvfuncts_t</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Initialization function</span>
<span class="w">    </span><span class="n">NVINTF_initNV</span><span class="w"> </span><span class="n">initNV</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Compact NV function</span>
<span class="w">    </span><span class="n">NVINTF_compactNV</span><span class="w"> </span><span class="n">compactNV</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Create item function</span>
<span class="w">    </span><span class="n">NVINTF_createItem</span><span class="w"> </span><span class="n">createItem</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Delete NV item function</span>
<span class="w">    </span><span class="n">NVINTF_deleteItem</span><span class="w"> </span><span class="n">deleteItem</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Read item function</span>
<span class="w">    </span><span class="n">NVINTF_readItem</span><span class="w"> </span><span class="n">readItem</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Write item function</span>
<span class="w">    </span><span class="n">NVINTF_writeItem</span><span class="w"> </span><span class="n">writeItem</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Get item length function</span>
<span class="w">    </span><span class="n">NVINTF_getItemLen</span><span class="w"> </span><span class="n">getItemLen</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Iterator Like doNext function</span>
<span class="w">    </span><span class="n">NVINTF_doNext</span><span class="w"> </span><span class="n">doNext</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Lock item function</span>
<span class="w">    </span><span class="n">NVINTF_lockNV</span><span class="w"> </span><span class="n">lockNV</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Unlock item function</span>
<span class="w">    </span><span class="n">NVINTF_unlockNV</span><span class="w"> </span><span class="n">unlockNV</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">NVINTF_nvFuncts_t</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The following is an example of a write from csf.c:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDeviceListItem</span><span class="p">(</span><span class="n">Llc_deviceListItem_t</span><span class="w"> </span><span class="o">*</span><span class="n">pItem</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">pNV</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pItem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findDeviceListIndex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">devInfo</span><span class="p">.</span><span class="n">extAddress</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">DEVICE_INDEX_NOT_FOUND</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">NVINTF_itemID_t</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="cm">/* Setup NV ID for the device list record */</span><span class="w"></span>
<span class="w">            </span><span class="n">id</span><span class="p">.</span><span class="n">systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NVINTF_SYSID_APP</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">id</span><span class="p">.</span><span class="n">itemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CSF_NV_DEVICELIST_ID</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">id</span><span class="p">.</span><span class="n">subID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">idx</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="cm">/* write the device list record */</span><span class="w"></span>
<span class="w">            </span><span class="n">pNV</span><span class="o">-&gt;</span><span class="n">writeItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Llc_deviceListItem_t</span><span class="p">),</span><span class="w"> </span><span class="n">pItem</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The following is an example of a read from csf.c:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">Csf_getNetworkInformation</span><span class="p">(</span><span class="n">Llc_netInfo_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInfo</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">pNV</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pNV</span><span class="o">-&gt;</span><span class="n">readItem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pInfo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">NVINTF_itemID_t</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* Setup NV ID */</span><span class="w"></span>
<span class="w">        </span><span class="n">id</span><span class="p">.</span><span class="n">systemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NVINTF_SYSID_APP</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">id</span><span class="p">.</span><span class="n">itemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CSF_NV_NETWORK_INFO_ID</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">id</span><span class="p">.</span><span class="n">subID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* Read Network Information from NV */</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">pNV</span><span class="o">-&gt;</span><span class="n">readItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Llc_netInfo_t</span><span class="p">),</span><span class="w"> </span><span class="n">pInfo</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NVINTF_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The NV system is a collection of NV items. Each item is unique and have the
following pieces to it (defined in nvintf.h).:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * NV Item Identification structure</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span> <span class="nc">nvintf_itemid_t</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! NV System ID - identifies system (ZStack, BLE, App, OAD...)</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w">  </span><span class="n">systemID</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! NV Item ID</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">itemID</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! NV Item sub ID</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">subID</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">NVINTF_itemID_t</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="modifying-non-volatile-memory-allocation">
<span id="sec-non-volatile-memory-allocation"></span><h3>Modifying Non-Volatile Memory Allocation<a class="headerlink" href="#modifying-non-volatile-memory-allocation" title="Permalink to this headline">¶</a></h3>
<p>By default, TI 15.4-Stack <em>sensor</em> projects allocate two pages of non-volatile (NV)
memory with the pre-define <code class="code docutils literal notranslate"><span class="pre">NVOCMP_NVPAGES=2</span></code> inside the project’s
<em>application</em> → <em>defines</em> → <em>sensor.opts</em> file.  This is to allow one
dedicated page for compaction and other pages for storage.  This is different
from the collector project which sets <code class="code docutils literal notranslate"><span class="pre">NVOCMP_NVPAGES=4</span></code> inside
<em>collector.opts</em> to allocate three NV memory storage pages for security keys.
However, it may be necessary to increase the number of NV storage pages given
a user’s specific application.  The linker command (<code class="code docutils literal notranslate"><span class="pre">.cmd</span></code>) file alreadymodifies the defined Flash size to achieve this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FLASH_BASE              0x00000000</span>
<span class="cp">#define FLASH_SIZE              (0x56000 - (NVOCMP_NVPAGES * 0x2000))</span>
<span class="cp">#define FLASH_NV_BASE           (0x56000 - (NVOCMP_NVPAGES * 0x2000))</span>
<span class="cp">#define FLASH_NV_SIZE           (NVOCMP_NVPAGES * 0x2000)</span>
</pre></div>
</div>
<p>However a user must modify the <strong>Region Base</strong> and <strong>Region Size</strong> settings in
the project’s .syscfg file <em>TI Drivers</em> → <em>NVS</em> → <em>Internal Flash</em>.
For example, if <code class="code docutils literal notranslate"><span class="pre">NVOCMP_NVPAGES</span></code> was increased to three (two pages for
storage and one for compaction) then <em>Region Base</em> would decrease to 0x50000
and <em>Region Size</em> would increase to 0x6000 (since one page of flash is 0x2000
bytes).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The maximum value of <code class="code docutils literal notranslate"><span class="pre">NVOCMP_NVPAGES</span></code> allowed is five,
which equals one compaction page (0x2000 bytes) and four storage
pages (0x8000 bytes).</p>
</div>
</div>
</div>
<div class="section" id="ti-drivers">
<span id="tirtos-drivers"></span><h2>TI Drivers<a class="headerlink" href="#ti-drivers" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.ti.com/tool/simplelink-cc13xx-cc26xx-sdk">SimpleLink CC13xx/CC26xx SDK</a> provides a suite of CC13xx or CC26xx peripheral drivers that can be added to
an application. The drivers provide a mechanism for the application to interface
with the CC13xx or CC26xx onboard peripherals and communicate with external devices.
These drivers make use of DriverLib to abstract register access.</p>
<p>There is significant documentation relating to each TI Driver located in
the SDK. Refer to the SDK release notes for the specific location. This
section only provides an overview of how drivers fit into the software
ecosystem. For a description of available features and driver APIs, refer to <a class="reference external" href="../../../drivers/tidriversAPIs.html">TI Drivers API Reference</a>.</p>
<div class="section" id="adding-a-driver">
<span id="id5"></span><h3>Adding a Driver<a class="headerlink" href="#adding-a-driver" title="Permalink to this headline">¶</a></h3>
<p>Some of the drivers are added to the project as source files in their
respective folder under the Drivers folder in the project workspace.</p>
<p>The driver source files can be found in their respective folder at
<code class="docutils literal notranslate"><span class="pre">$DRIVER_LOC\ti\drivers</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$DRIVER_LOC</span></code> argument variable refers to the
installation location and can be viewed in the <em>Project Options -&gt;
Resource -&gt; Linked Resources</em>, Path Variables tab of CCS.</p>
<p>To add a driver to a project, include the C and include file of the
respective driver in the application file (or files) where the
driver APIs are referenced.</p>
<p>For example, to add the GPIO driver for reading or controlling an
output I/O pin, add the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ti/drivers/gpio/GPIOCC26XX.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>Also add the following TI Driver files to the project under the
Drivers\GPIO folder:</p>
<ul class="simple">
<li><p>GPIOCC26XX.c</p></li>
<li><p>GPIOCC26XX.h</p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ti154stack-overview-cc13xx_cc26xx.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example-applications.html" class="btn btn-neutral float-right" title="Example Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>