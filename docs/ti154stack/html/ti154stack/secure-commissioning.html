<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secure Commissioning &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User&#39;s Guide
 6.10.01.00 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Beacon Enabled Mode" href="beacon-mode.html" />
    <link rel="prev" title="Common User Interface" href="common-user-interface.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ti154stack secure-commissioning";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ti154stack-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User's Guide

          </a>
              <div class="version">
                6.10.01.00
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ti154stack-guide/ti154stack-index-cc13xx_cc26xx.html">TI 15.4-Stack</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html#architecture-choices">Architecture Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ti154stack-overview-cc13xx_cc26xx.html#data-rate-and-phy">Data Rate and PHY</a></li>
<li class="toctree-l2"><a class="reference internal" href="application-overview.html">Application Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-applications.html">Example Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="common-user-interface.html">Common User Interface</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Secure Commissioning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#secure-commissioning-example-applications">Secure Commissioning Example Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-commissioning-features">Secure Commissioning Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ti-15-4-secure-commissioning-architecture">TI 15.4 Secure Commissioning Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-commissioning-network-joining">Secure Commissioning Network Joining</a></li>
<li class="toctree-l3"><a class="reference internal" href="#device-commissioning">Device Commissioning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#crypto-functions">Crypto Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-generation">Key Generation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#device-key-refreshment">Device Key Refreshment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-manager-apis">Secure Manager APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apis">APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-format-and-commands">Data Format and Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#secure-manager-state-machine">Secure Manager State Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-usage-diagram">Key Usage Diagram</a></li>
<li class="toctree-l4"><a class="reference internal" href="#known-limitations-due-to-storing-keys-in-ram">Known Limitations due to Storing Keys in RAM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="beacon-mode.html">Beacon Enabled Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="non-beacon-mode.html">Non-Beacon Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="frequency-hopping-mode.html">Frequency-Hopping Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="arib-regulation-type.html">ARIB Regulation Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-stack.html">Configuring Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet-sniffer.html">SmartRF Protocol Packet Sniffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-custom-applications.html">Creating Custom Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc13xx_cc26xx/fcc-certification.html">FCC Certification Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ti154stack-guide/oad-secure-index.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ti154stack-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence-ieee.html">Wi-Fi Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/memory-index.html">Memory overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/migration-guide-cc13xx_cc26xx.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#terms-and-acronyms">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ti154stack-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
TI 15.4-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ti154stack-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ti154stack-guide/ti154stack-index-cc13xx_cc26xx.html">TI 15.4-Stack</a> &raquo;</li>
      <li>Secure Commissioning</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="secure-commissioning">
<span id="chap-ti154stack-seccommissioning"></span><h1>Secure Commissioning<a class="headerlink" href="#secure-commissioning" title="Permalink to this headline">¶</a></h1>
<p>The TI 15.4 secure commissioning provides the user with a security manager
example for both Collector and Sensor applications. These examples leverage the
crypto drivers in the CC13xx or CC26xx platform to demonstrate use cases such as secure
key exchange, device authentication, and key generation.</p>
<div class="section" id="secure-commissioning-example-applications">
<h2>Secure Commissioning Example Applications<a class="headerlink" href="#secure-commissioning-example-applications" title="Permalink to this headline">¶</a></h2>
<p>TI 15.4-Stack Provides two examples featuring secure commissioning. These examples are
Collector_sm, and Sensor_sm which can be found in the same directory as all
other TI 15.4-Stack out of the box examples. These example application provide the
same basic functionality as the Collector and Sensor applications described in
the section <a class="reference internal" href="example-applications.html#chap-example-applications"><span class="std std-ref">Example Applications</span></a> but with the added functionality of
securely commissioning devices to the network.</p>
<p>For more information on how to run the Collector_sm and Sensor_sm example
applications please see the README included with the applications source
code.</p>
</div>
<div class="section" id="secure-commissioning-features">
<h2>Secure Commissioning Features<a class="headerlink" href="#secure-commissioning-features" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 22%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Feature</strong></p></td>
<td><p><strong>Type</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Key Types</p></td>
<td><p>Device Key:</p></td>
<td><ul class="simple">
<li><p>Used for all unicast messaging</p></li>
<li><p>Each Sensor device has a unique key to
encrypt/decrypt the payload</p></li>
<li><p>Each Sensor device shall support up to two device
keys. One for current device key, the other for
future device key</p></li>
<li><p>Collector stores the device keys for all connected
devices</p></li>
<li><p>The unique device key is used only between the
Collector and the specific Sensor device</p></li>
<li><p>128-bit key</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Network Key:</p></td>
<td><ul class="simple">
<li><p>Used for Broadcasts</p></li>
<li><p>Pre-defined key, which is known to all devices in
the same network</p></li>
<li><p>Only Collector uses the key to encrypt</p></li>
<li><p>Sensor devices use this key only to decrypt packets
from the Collector</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Encryption and
Decryption Layer</p></td>
<td><p>MAC Layer:</p></td>
<td><ul class="simple">
<li><p>Only MAC layer encryption/decryption is supported</p></li>
<li><p>Payload Encryption and Authentication done in MAC
layer</p></li>
<li><p>Default security Algorithm: <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-AES-CCM"><span class="xref std std-term">AES-CCM</span></a>
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-MIC"><span class="xref std std-term">MIC</span></a> using 128-bit key</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Key Storage</p></td>
<td><p>MAC Layer:</p></td>
<td><ul class="simple">
<li><p>Keys are stored in the MAC layer only</p></li>
<li><p>Each key is associated with unique
key-look-up-data, which is associated with a device
and used by the application layer</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Encryption and
Decryption Target</p></td>
<td><p>Payload:</p></td>
<td><ul class="simple">
<li><p>Application Data Frame (Device Key)</p></li>
<li><p>MAC command Frame ( can be encrypted with either
Device Key or Network Key)</p></li>
<li><p>Beacon (Network Key)</p></li>
<li><p>No ACK frame payload is encrypted</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Key Exchange</p></td>
<td><p><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-ECDH"><span class="xref std std-term">ECDH</span></a> P-256:</p></td>
<td><ul class="simple">
<li><p>Anonymous key agreement protocol that allows two
parties, each having an elliptic-curve
public-private key pair, to establish a shared
secret over an insecure channel</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Key Derivation
Algorithm</p></td>
<td><p><a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-AES-CMAC"><span class="xref std std-term">AES-CMAC</span></a> and
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-TRNG"><span class="xref std std-term">TRNG</span></a> are
used for Device Key
derivation</p></td>
<td><ul class="simple">
<li><p>A shared secret is used to generate the device key</p></li>
<li><p>Both are stored</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>Device Authentication</p></td>
<td><p>Just Allows:</p></td>
<td><ul class="simple">
<li><p>No authentication</p></li>
<li><p>No MITM protection</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Default Code:</p></td>
<td><ul class="simple">
<li><p>MITM protection</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Passkey:</p></td>
<td><ul class="simple">
<li><p>Collector: Is the target device where the passkey
should be entered via a keyboard</p></li>
<li><p>Sensor: Displays the authentication passkey</p></li>
<li><p>MITM protection</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Key refreshment</p></td>
<td><p>Device Key
Refreshment:</p></td>
<td><ul class="simple">
<li><p>Auto Key refreshment for Device Key</p></li>
<li><p>TI provides API for key refreshment and shows how
it works</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ti-15-4-secure-commissioning-architecture">
<h2>TI 15.4 Secure Commissioning Architecture<a class="headerlink" href="#ti-15-4-secure-commissioning-architecture" title="Permalink to this headline">¶</a></h2>
<p>The device commissioning process is encapsulated within the Secure Manager
module. This process includes key exchange, device authentication, and key
generation. The overall architecture of the TI 15.4 Secure Commissioning feature
is shown in the diagram below.</p>
<div class="figure align-center" id="id5">
<img alt="../_images/fig-sc-arch.jpg" src="../_images/fig-sc-arch.jpg" />
<p class="caption"><span class="caption-number">Figure 43. </span><span class="caption-text">Secure Commissioning Architecture</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="secure-commissioning-network-joining">
<h2>Secure Commissioning Network Joining<a class="headerlink" href="#secure-commissioning-network-joining" title="Permalink to this headline">¶</a></h2>
<p>As shown below, the device commissioning process is started after a device has
performed MAC level association, and the process is initiated by the Collector
after checking if the device supports secure commissioning. If the device’s
security feature is not enabled or association ends with a failure, the
Collector will disassociate the device from the network. After completion of the
device commissioning, the Secure Manager sends the result back to the
application. If the commissioning is successful, the application updates the key
information associated with the corresponding device. If it fails, then the
application(Collector or Sensor, whichever one detects the failure) starts the
disassociation process. In the case that the commissioning fails, the device
information will be added to the Blacklist, which can be reviewed during the
association process to reject or limit the number of the association request
from device side. If a device fails to pair the maximum number of times,
then the device is rejected forever until the record is erased.</p>
<p>Association and Device Commissioning may be performed on a link which is either
encrypted or not encrypted. If it is required to be encrypted, the default
network key will be used.</p>
<div class="figure align-center" id="id6">
<span id="fig-ti154stack-sc-join"></span><p class="plantuml">
<img src="../_images/plantuml-1ee004a7e00e301815347accdfe4d6f2b27bb8c1.png" alt="&#64;startuml
hide footbox

participant Coordinator as coord
participant Sensor      as sensor

activate sensor

sensor -&gt; coord : Association request
activate coord
coord -&gt; sensor : Association response

group Secure Manager task

    coord -&gt; sensor : Commissioning request
    activate coord #00BFFF
    activate sensor #00BFFF

    sensor -&gt; coord : Commissioning response
    deactivate coord
    deactivate sensor

end

alt Commissioning successful

    sensor -&gt; sensor : Update key and device info to MAC
    coord -&gt; coord : Update key and device info to MAC

else Commissioning failure

    coord -&gt; sensor : Disassociation request
    deactivate coord

end

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 44. </span><span class="caption-text">Secure network join</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="device-commissioning">
<h2>Device Commissioning<a class="headerlink" href="#device-commissioning" title="Permalink to this headline">¶</a></h2>
<p>The Secure Manager in the Collector initiates the device commissioning process
by sending the request to the Sensor device. Then, the Sensor
device responds to the request by sending the authentication method it supports.
If the method is supported, the Collector sends a confirmation to the Sensor
device. The Sensor will then proceed to set the passkey based on the agreed upon
method, and send a passkey set confirmation message to the Collector which will
proceed to do the same. If the method is not supported, the Collector aborts
the process. The Collector sends a confirmation with accept or reject. If it
is rejected, then the Collector informs the application the result, so that the
application starts the disassociation process.</p>
<p>Once the authentication method has been accepted, each side generates its own
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-ECDH"><span class="xref std std-term">ECDH</span></a> Public Key (PK) and Private Key (SK). The Collector sends PKc
(Collector’s Public Key) to the Sensor device, then the Sensor device sends
PKs (Sensor’s Public Key) to the Collector. Then, each side generates the
shared secret (Diffie-Hellman Key) using their own Private Key along with the
other device’s Public Key.</p>
<p>Then, the authentication process is initiated followed by the key generation
process. The newly generated key will be used to encrypt/decrypt data
between the two devices.</p>
<div class="figure align-center" id="id7">
<span id="fig-ti154stack-sc-commissioning"></span><p class="plantuml">
<img src="../_images/plantuml-7a090866bcc509e3f7d6fc7d092b88d09315b5c0.png" alt="&#64;startuml
hide footbox

participant Coordinator as coord
participant Sensor      as sensor

activate coord
activate sensor

== Start ==

coord -&gt; sensor : Commissioning request

== Authentication method ==

sensor -&gt; coord : Commissioning response (authentication method)
coord -&gt; sensor : Confirmation

== Passkey ==

note over sensor : Set passkey

sensor -&gt; coord : Passkey process confirm

note over coord : Set passkey

coord -&gt; sensor : Passkey process confirm

== Public key exchange ==

note over sensor : Generate ECDH public key (PKs) &amp;\nprivate key (SKs)

sensor -&gt; coord : Send PKs

note over coord : Generate ECDH public key (PKc) &amp;\nprivate key (SKc)

coord -&gt; sensor : Send PKc

note over coord : Diffie-Hellman key:\nP256 (SKc, PKs)
note over sensor : Diffie-Hellman key:\nP256 (SKd, PKs)

== Wrap up ==

note over coord, sensor : Authentication and key generation

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 45. </span><span class="caption-text">Device commissioning overview</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="crypto-functions">
<h3>Crypto Functions<a class="headerlink" href="#crypto-functions" title="Permalink to this headline">¶</a></h3>
<p>There are 3 main crypto functions which are described below:</p>
<ul class="simple">
<li><p>F1 is used to generate the code values used during the authentication
process.</p></li>
<li><p>F2 is used to generate derived keying material for the device key and keys
for the commitment function F3.</p></li>
<li><p>F3 is used to generate check values for device key.</p></li>
</ul>
</div>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h3>
<p>The Authentication process is initiated by first agreeing between the Collector
and Sensor on which authentication will be used. This agreement is done during
the commissioning process when the Sensor responds to the Collector’s
commissioning request by specifying which authentication methods it supports. If
the Collector supports at least one of the methods, then it sends a confirmation
to the Sensor with the authentication method chosen. Then the authentication
process is started.</p>
<p>Authentication methods:</p>
<ol class="arabic simple">
<li><p><strong>Just Allowed</strong>: PSK = 0x0</p></li>
<li><p><strong>Default Code</strong>: PSK = 6 digits decimal pre-defined code (20-bit)</p></li>
<li><p><strong>Passkey</strong>: PSK = 6 digits decimal user input (20-bit). Max value: 999999
= 0xF423F</p></li>
</ol>
<p>The passkey value must be identical on both Collector and Sensor and will be
the basis of the mutual authentication of the two devices. The authentication
sequence is repeated 6 times. Each side commits to each 4-bit of the passkey,
using a long nonce (128-bit), and sending the hash of the nonce, the 4-bit of
the passkey, and both public keys to the other party. The parties then take
turns revealing their commitments until the entire passkey has been mutually
disclosed. The first party to reveal a commitment for a given 4-bit of the
passkey effectively reveals that 4-bit of the passkey in the process, but the
other party then has to reveal the corresponding commitment to show the same bit
value for that 4-bit of the passkey, or else the first party will then abort the
process, after which no more 4-bit of the passkey are revealed.</p>
<p>For each iteration <code class="docutils literal notranslate"><span class="pre">i</span></code> of the authentication sequence:</p>
<ul class="simple">
<li><p>PSKci = the <code class="docutils literal notranslate"><span class="pre">i</span></code>’th least significant 4 bits of PSKc</p></li>
<li><p>PSKsi = the <code class="docutils literal notranslate"><span class="pre">i</span></code>’th least significant 4 bits of PSKs</p></li>
<li><p>Nci and Nsi = 128-bit nonce regenerated each iteration</p></li>
</ul>
<p>For example, given that PSKc = 0x123456, then PSKc0 = 0x6, PSKc1 = 0x5, etc.</p>
<p>The “gradual disclosure” prevents leakage of more than 4-bit of in-guessed
passkey information in the case of an <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-MITM"><span class="xref std std-term">MITM</span></a> attack. A MITM attacker
with only partial knowledge of the passkey will only receive one
incorrectly-guessed 4-bit chunk of the passkey before the process fails.
Hence, a MITM attacker who engages first one side, then the other will only
gain an advantage of at most two 4-bit chunks over a simple brute-force
guesser. The process can be repeated at each bit of the passkey (total 24
times) but 4-bit is chosen to reduce the authentication process time. If
required, the user can easily modify the authentication process to use 1-bit
of the passkey instead of 4-bits.</p>
<p>The 128-bit nonce is included in the commitment hash to make it difficult to
brute force even after the process has failed. The public Diffie-Hellman
values are included to tie the passkey authentication to the original
<a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-ECDH"><span class="xref std std-term">ECDH</span></a> key exchange, to prevent a <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-MITM"><span class="xref std std-term">MITM</span></a> attacker from
substituting the public keys on both sides of the <a class="reference internal" href="../ti154stack-guide/references-cc13xx_cc26xx.html#term-ECDH"><span class="xref std std-term">ECDH</span></a> exchange with
its own key.</p>
<div class="figure align-center" id="id8">
<span id="fig-ti154stack-sc-authentication"></span><p class="plantuml">
<img src="../_images/plantuml-0dda490dcb7ce026ae2cc3970328869026ec45c3.png" alt="&#64;startuml
hide footbox

participant Coordinator as coord
participant Sensor      as sensor

activate coord
activate sensor

coord -&gt; coord   : Set/get passkey, PSKc
sensor -&gt; sensor : Set/get passkey, PSKs

coord -&gt; coord   : Select random number, Nci
sensor -&gt; sensor : Select random number, Nsi

loop i = 0 .. 5

    coord -&gt; coord   : CODEci = F1(PKc, PKs, Nci, PSKci)
    sensor -&gt; sensor : CODEsi = F1(PKs, PKc, Nsi, PSKsi)

    sensor -&gt; coord : CODEsi
    sensor -&gt; coord : Nsi

    alt if CODEsi != F1(PKs, PKc, Nsi, PSKci)

        coord -&gt;x sensor : Abort authentication

    end

    coord -&gt; sensor : CODEci
    coord -&gt; sensor : Nci

    alt if CODEci != F1(PKc, PKs, Nci, PSKsi)

        sensor -&gt;x coord : Abort authentication

    end

end

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 46. </span><span class="caption-text">Authentication process</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="key-generation">
<h3>Key Generation<a class="headerlink" href="#key-generation" title="Permalink to this headline">¶</a></h3>
<p>Once the authentication process has been completed, the next step is to confirm
that both devices have successfully completed the key exchange and to generate
the device key.</p>
<p>Each side computes the Confirmation Key and the Device Key using the previously
exchanged values (Collector’s IEEE address, Sensor’s IEEE address and
Authentication Method) and the shared secret. Each side then computes a new
confirmation value using the previously exchanged values and the newly derived
confirmation key. The Sensor device then transmits its confirmation value, which
is checked by the Collector. If this check fails, it indicates that the Sensor
device has not confirmed the pairing, and the protocol shall be aborted by the
Collector. The Collector then transmits its confirmation value, which is
checked by the Sensor device. A failure indicates that the Sensor device has not
confirmed the pairing and the process shall be aborted.</p>
<div class="math">
<p><img src="../_images/math/33b8181cfefd4cdabf1a115f23ba9ece82565e36.svg" alt="IAc &amp;= \text{Coordinator IEEE MAC address (56-bit MSB)}

IAs &amp;= \text{Sensor IEEE MAC address (56-bit MSB)}

AU &amp;= \text{Sensor Authentication Method (24-bit)}

Nc &amp;= Nc_0 \oplus Nc_1 \oplus ... \oplus Nc_5

Ns &amp;= Ns_0 \oplus Ns_1 \oplus ... \oplus Ns_5

Rc, Rs &amp;= \text{Passkey value (128-bit, 0-extended 24-bit)}"/></p>
</div><div class="figure align-center" id="id9">
<span id="fig-ti154stack-sc-key-gen"></span><p class="plantuml">
<img src="../_images/plantuml-bc79afd2024544c13ff9abfc394178db6fdf1c99.png" alt="&#64;startuml
hide footbox

participant Coordinator as coord
participant Sensor      as sensor

activate coord
activate sensor

coord -&gt; coord   : ConKey || Device Key = F2(DHKey, Nc, Ns, IAc, IAs)
sensor -&gt; sensor : ConKey || Device Key = F2(DHKey, Ns, Nc, IAs, IAc)

coord -&gt; coord   : Ec = F3(ConKey, Nc, Ns, Rs, AU, IAc, IAs)
sensor -&gt; sensor : Ec = F3(ConKey, Ns, Nc, Rc, AU, IAs, IAc)

sensor -&gt; coord : Es

alt if Es != F3(DHKey, Ns, Nc, Rc, AU, IAs, IAc)

    coord -&gt;x sensor : Abort generation

end

coord -&gt; sensor : Ec

alt if Ec != F3(DHKey, Nc, Ns, Rs, AU, IAc, IAs)

    coord -&gt;x sensor : Abort generation

end

sensor -&gt; coord : Confirm key generation

coord -&gt; sensor : Acknowledge confirmation

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 47. </span><span class="caption-text">Key generation</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="device-key-refreshment">
<h2>Device Key Refreshment<a class="headerlink" href="#device-key-refreshment" title="Permalink to this headline">¶</a></h2>
<p>For key refreshment, the Collector runs a timer for key refreshment. When the
timer is expired, “SM_KEYREFRESH_TIMEOUT” event is generated. Then the Collector
initiates a key refreshment for one of the Sensor devices in the network.  The
key refreshment uses the same state machine for commissioning but starts from
key generation by skipping the ECDH key exchange and Authentication, thus key
refreshment cannot be performed while a commissioning is in progress, and vice
versa. The timeout is define by “SM_KEYREFRESH_TIMEOUT”. The key refreshment
process, like the regular commissioning process, uses the network key. Note that
the way to trigger the key refreshment is an example. It can be triggered by
other ways such as the number of data transfer, local trigger by user, or remote
trigger. User can apply a different method based on the product needs.</p>
<p>The diagram below provides a high level overview of the process, key refreshment
uses the same state machine used for commissioning, but
starting from the key generation state.</p>
<div class="figure align-center" id="id10">
<span id="fig-ti154stack-sc-key-refreshment"></span><p class="plantuml">
<img src="../_images/plantuml-48bb5342513abebba84349213bac08682994cfdc.png" alt="&#64;startuml
hide footbox

participant Coordinator as coord
participant Sensor      as sensor

[-&gt; coord : Key refreshment timeout
activate coord

coord -&gt; sensor : Key refreshment request
activate sensor

sensor -&gt; coord : Exchange Sensor keys
coord -&gt; sensor : Exchange Collector keys

alt Refresh successful

    sensor -&gt; coord : Update key confirmation
    coord -&gt; sensor : Confirm update

else Refresh failure

    coord -&gt; sensor : Keep the same key
    deactivate sensor

end

deactivate coord

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 48. </span><span class="caption-text">Device key refreshment</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="secure-manager-apis">
<h2>Secure Manager APIs<a class="headerlink" href="#secure-manager-apis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="apis">
<h3>APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h3>
<p>Secure Manger (SM) runs based on states, so it shall be continuously called
from <code class="docutils literal notranslate"><span class="pre">Collector_process()</span></code> in <code class="docutils literal notranslate"><span class="pre">collector.c</span></code> for the Collector device, and
<code class="docutils literal notranslate"><span class="pre">Sensor_process()</span></code> in <code class="docutils literal notranslate"><span class="pre">sensor.c</span></code> for Sensor devices. SM is responsible for
managing its state to complete device commissioning and key generation. SM
does not pass the key and device information to the MAC layer directly. The
application is responsible to pass the key and device information to the MAC
which is already implemented as part of the Collector_sm and Sensor_sm
examples.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>API</strong></p></th>
<th class="head"><p><strong>Parameters</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SM_init()</p></td>
<td><p>sem</p></td>
<td><p>Initializes the SM module and updates the security manager callback structure.</p>
<p>Collector: Called in Collector_init() in collector.c</p>
<p>Sensor Device: Called in Sensor_init() in sensor.c</p>
</td>
</tr>
<tr class="row-odd"><td><p>SM_Process()</p></td>
<td></td>
<td><p>Start the security manager event handler
Collector: Called in Collector_process() in collector.c</p>
<p>Sensor Device: Called in Sensor_process() in sensor.c</p>
</td>
</tr>
<tr class="row-even"><td><p>SM_startCMProcess()</p></td>
<td><p>*devInfo, *sec, fhEnabled, rxOnIdle, devType,
authMethods</p></td>
<td><p>Collector: This API shall be called after a device association is done. Where: assocIndCb() in cllc.c</p>
<p>Sensor Device: This API shall be called when “Smgs_cmdIds_CommissionStart” is received. If device association is not completed (assocCnfCb() in jdllc.c), it shall be rejected.</p>
<p>This function shall set the SM state to SMSTATE_START</p>
<p>FHEnabled= true or false =&gt; Whether to use extended or short addressing when making mac data requests</p>
<p>RxOnIdle = true or false =&gt; Whether the receiver is on when idling, only for Sensor devices.</p>
<p>DeviceType = SM_type_coordinator or SM_type_device =&gt; Set based on application, the Collector shall choose the Collector device type, which the Sensor shall choose device.</p>
<p>Desired Authentication method by SM process initiator: Bitmask of values from SMMsgs_authMethod_t.</p>
</td>
</tr>
<tr class="row-odd"><td><p>SM_startKeyRefreshProcess()</p></td>
<td><p>*pDevInfo, *pSec, fhEnabled, rxOnIdle</p></td>
<td><p>Collector: This API shall be called after a key refresh timeout to start the key refreshment process. Where: allDevice_keyRefresh() in sm_ti154.c.</p>
<p>Sensor: This API shall be called to start the key refreshment process. Where: dataIndCb() in sensor.c.</p>
<p>This function shall set the SM state to SM_states_key_gen</p>
<p>FHEnabled= true or false =&gt; Whether to use extended or short addressing when making mac data requests</p>
<p>RxOnIdle = true or false =&gt; Whether the receiver is on when idling, only for Sensor devices.</p>
</td>
</tr>
<tr class="row-even"><td><p>SM_registerCallback()</p></td>
<td><p>*pSMCallbacks</p></td>
<td><p>Register callback functions which needs to be called before SM_startCMProcess() is called</p>
<p>Collector: Called in Collector_init() in collector.c</p>
<p>Sensor Device: Called in Sensor_init() in sensor.c</p>
</td>
</tr>
<tr class="row-odd"><td><p>(*SM_failCMProcessFp_t)</p></td>
<td></td>
<td><p>Callback Function pointer. This function shall be invoked when the commissioning process is failed. Input: pointer of ApiMac_deviceDescriptor_t. Output:  ApiMac_deviceDescriptor_t. Collector or Sensor needs to start disassociation process.</p></td>
</tr>
<tr class="row-even"><td><p>(*SM_successCMProcessFp_t)</p></td>
<td></td>
<td><p>Callback Function pointer. This function shall be invoked when the commissioning process is succeed. Input: pointer of ApiMac_deviceDescriptor_t and ApiMac_keyDescriptor_t. Output:  ApiMac_deviceDescriptor_t and ApiMac_keyDescriptor_t. Collector or Sensor needs to pass the information to MAC.</p></td>
</tr>
<tr class="row-odd"><td><p>SM_getSrcDeviceSecurityInfo()</p></td>
<td><p>extAddress, shortAddress, *pSec</p></td>
<td><blockquote>
<div><p>Gets a device key lookup data from the SeedKeyTable</p>
</div></blockquote>
<p>Collector: This API shall be called to populate the security field for message transmission. Where: sendMsg() in collector.c</p>
<p>Sensor: This API shall be called to populate the security field for message transmission. Where: Sensor_sendMsg() in sensor.c</p>
</td>
</tr>
<tr class="row-even"><td><p>SM_removeEntryFromSeedKeyTable()</p></td>
<td><p>*extAddress</p></td>
<td><p>Remove a SeedKey Entry from the SeedKeyTable</p>
<p>Collector: Called after disassociation in cllcDisassocIndCb() in collector.c</p>
<p>Sensor: Called after disassociation in jdllcDisassocIndCb() and jdllcDisassocCnfCb() in sensor.c</p>
</td>
</tr>
<tr class="row-odd"><td><p>SM_processCommData()</p></td>
<td><p>*pDataInd</p></td>
<td><p>Parse incoming data that has been sent to the application for the security manager.</p>
<p>Collector: Called after disassociation in dataIndCB() in collector.c</p>
<p>Sensor: Called after disassociation in jdllcDisassocIndCb() and dataIndCB() in sensor.c</p>
</td>
</tr>
<tr class="row-even"><td><p>updateSeedKeyFromNV()</p></td>
<td><p>*pDevInfo, *pDevKeyInfo</p></td>
<td><p>Add SeedKey Entry to the SeedKeyTable from NV (Sensor only)</p>
<p>Sensor Device: Called in Sensor_process() in sensor.c</p>
</td>
</tr>
<tr class="row-odd"><td><p>addDeviceKey()</p></td>
<td><p>*pSeedKeyEntry, *deviceKey, newkey</p></td>
<td><p>Add a new device key to key table</p>
<p>newKey = true if new key is being added, false if key update</p>
<p>Both: Called in SM_states_finish_success state of SM process</p>
<p>Sensor Device: Called in Sensor_process() in sensor.c</p>
</td>
</tr>
<tr class="row-even"><td><p>getEntryFromSeedKeyTable()</p></td>
<td><p>extAddress, shortAddress</p></td>
<td><p>Get a SeedKey Entry pointer from the SeedKeyTable</p>
<p>Both: Called in SM_states_finish_success state of SM process, SM_startKeyRefreshProcess(), and SM_getSrcDeviceSecurityInfo()</p>
<p>Sensor Device: Called in Sensor_process() in sensor.c</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-format-and-commands">
<h3>Data Format and Commands<a class="headerlink" href="#data-format-and-commands" title="Permalink to this headline">¶</a></h3>
<p>Data Format: MsgID (uint8_t) + CM_ID (uint16_t) + DataSize (uint8_t) + Data (N
bytes)</p>
<ul class="simple">
<li><p>DataSize does not include MsgID and CM_ID</p></li>
<li><p>Message ID:</p>
<ul>
<li><p>Smgs_cmdIds_CommissionStart = 14</p></li>
<li><p>Smgs_cmdIds_CommissionMsg = 15</p></li>
</ul>
</li>
<li><p>CM_ID + Data</p>
<ul>
<li><p>SMMsgs_cmdIds_processRequest (0xCF01) + Device Info</p></li>
<li><p>SMMsgs_cmdIds_processResponse (0xCF02) + authentication method</p></li>
<li><p>SMMsgs_cmdIds_processMethodConfirm (0xCF05) + Selected Method</p></li>
<li><p>SMMsgs_cmdIds_processPasskeyConfirm (0xCF06) + No Data</p></li>
<li><p>SMMsgs_cmdIds_processPublicKey (0xCF07) + Public Key</p></li>
<li><p>SMMsgs_cmdIds_processInfo128SecurityVal (0xCF08) + data (128bit)</p></li>
<li><p>SMMsgs_cmdIds_processInfo128Code (0xCF09) + data (128bit)</p></li>
<li><p>SMMsgs_cmdIds_processInfo128Nonce (0xCF10) + data (128bit)</p></li>
<li><p>SMMsgs_cmdIds_processSuccess (0xCF20) + No Data</p></li>
<li><p>SMMsgs_cmdIds_processFail (0xCF21) + Error Code (+ local supported
authentication methods if SMMsgs_errorCode_unsupportedAuthMethod error)</p></li>
<li><p>SMMsgs_cmdIds_KeyRefreshRequest (0xCF30) + No Data</p></li>
<li><p>SMMsgs_noMsg (0xFFFF) (dummy message used to check whether a message is
expected or not)</p></li>
</ul>
</li>
<li><p>Authentication Method (uint8_t)</p>
<ul>
<li><p>Just Allowed: 0x04</p></li>
<li><p>Passkey: 0x01</p></li>
<li><p>Default Code: 0x02</p></li>
</ul>
</li>
<li><p>Error Code (uint8_t)</p>
<ul>
<li><p>Authentication method is not supported by target device
SMMsgs_errorCode_unsupportedAuthMethod = 0x12,</p></li>
<li><p>Authentication input does not match
SMMsgs_errorCode_noMatchAuthVal = 0x13,</p></li>
<li><p>Key confirmation value does not match
SMMsgs_errorCode_noMatchKeyConfirm = 0x14,</p></li>
<li><p>Unexpected commissioning message received
SMMsgs_errorCode_unexpectedMsg = 0x1A,</p></li>
<li><p>Commissioning process timeout
SMMsgs_errorCode_timeout = 0x1B,</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="secure-manager-state-machine">
<h3>Secure Manager State Machine<a class="headerlink" href="#secure-manager-state-machine" title="Permalink to this headline">¶</a></h3>
<p>The diagram below shows the secure manager states change flow based on
the interactions between Collector and Sensor.</p>
<ol class="arabic simple">
<li><p>ENTRY</p></li>
</ol>
<ul class="simple">
<li><p>Collector: After a device association is complete, the Collector initiates
the device commissioning process by calling SM_startCMProcess(), where the
state is set to START.</p></li>
<li><p>Sensor: When receiving the device commissioning start message, calls
SM_startCMProcess() if the device association is finished.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>START (Collector only)</p></li>
</ol>
<ul class="simple">
<li><p>Send following message to the Sensor.</p>
<ul>
<li><p>Message ID: Smgs_cmdIds_CommissionStart</p></li>
<li><p>CM ID:  CM_ProcessRequest</p></li>
<li><p>Data: Device Info</p></li>
</ul>
</li>
</ul>
<ol class="arabic simple" start="3">
<li><p>AUTH_METHOD</p></li>
</ol>
<ul class="simple">
<li><p>Collector: requests the authentication methods the device supports</p></li>
<li><p>Sensor: sends the authentication methods the device supports</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>PASSKEY</p></li>
</ol>
<ul class="simple">
<li><p>Collector: sets the passkey and sends a passkey process confirmation
message</p></li>
<li><p>Sensor: sets the passkey and sends a passkey process confirmation message</p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>KEY_EXCHANGE</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: generates its own ECDH key pair and exchange public key
with each other.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>AUTHENTICATION</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: perform Authentication Process.</p></li>
</ul>
<ol class="arabic simple" start="7">
<li><p>KEY_GEN</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: perform Key Generation Process.</p></li>
<li><p>Collector: If key value is confirmed, sends Cm_ProcessSuccess message to
the Sensor, then move to FINISH_SUCCESS</p></li>
<li><p>Sensor: When receiving Cm_ProcessSuccess message, then move to FINISH_SUCCESS</p></li>
</ul>
<ol class="arabic simple" start="8">
<li><p>FINISH_SUCCESS</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: call the callback function (*SM_successCMProcessFp_t)</p></li>
</ul>
<ol class="arabic simple" start="9">
<li><p>FINISH_FAIL</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: Call the callback function (*SM_failCMProcessFp_t)</p></li>
</ul>
<ol class="arabic simple" start="10">
<li><p>How to get to FINISH_FAIL:</p></li>
</ol>
<ul class="simple">
<li><p>Collector &amp; Sensor: At each state, a failure shall cause the state to go to
FINISH_FAIL</p></li>
<li><p>Possible failures:</p>
<ul>
<li><p>Collector does not support authentication method chosen by Sensor</p></li>
<li><p>Code or nonce mismatch during the authentication state</p></li>
<li><p>Security value mismatch during the key generation state</p></li>
<li><p>Unexpected message received during SM process</p></li>
<li><p>Timeout</p></li>
</ul>
</li>
</ul>
<div class="figure align-center" id="fig-secure-commiss-statem">
<img alt="../_images/fig-sc-fsm.jpg" src="../_images/fig-sc-fsm.jpg" />
<p class="caption"><span class="caption-number">Figure 49. </span><span class="caption-text">Secure Manager State Machine</span><a class="headerlink" href="#fig-secure-commiss-statem" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="key-usage-diagram">
<h3>Key Usage Diagram<a class="headerlink" href="#key-usage-diagram" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="fig-secure-commiss-keyusage">
<img alt="../_images/fig-sc-key-usage.jpg" src="../_images/fig-sc-key-usage.jpg" />
<p class="caption"><span class="caption-number">Figure 50. </span><span class="caption-text">Key Usage</span><a class="headerlink" href="#fig-secure-commiss-keyusage" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="known-limitations-due-to-storing-keys-in-ram">
<h3>Known Limitations due to Storing Keys in RAM<a class="headerlink" href="#known-limitations-due-to-storing-keys-in-ram" title="Permalink to this headline">¶</a></h3>
<p>As shown in the diagram above, the Collector needs to keep
two unique keys per device (Seed Key and Device Key). Due to limited
NV space, all of the keys cannot be stored in NV Memory.
The NV storage only keeps the Sensor information, not device key
information. When using Secure commissioning to secure an end product
application, it is recommended to store all device keys to internal flash or
external flash.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please Note that the keys may need to be encrypted if an external flash
space is used for key storage.</p>
</div>
<p>Due to this limitation it is expected that the device key information in RAM
will be lost after power cycle or reset.
To improve the out of box experience when using secure commissioning, the
Collector implements a key recovery mechanism after reset or power
cycle.</p>
<div class="section" id="key-recovery-process">
<h4>Key Recovery Process<a class="headerlink" href="#key-recovery-process" title="Permalink to this headline">¶</a></h4>
<p><strong>Collector side:</strong></p>
<p>After reset, the Collector checks if there are any devices in the associated
device list. If the device list contains associated devices, then the list in
RAM “Cllc_associatedDevList[ ]” is populated with the devices and they are all
marked as “key information needs to be recovered”. The key recovery process will
be initiated by the event COLLECTOR_START_EVT.</p>
<p>Once the recovery has been initiated by the COLLECTOR_START_EVT, the Collector
will proceed to trigger a commissioning for all the pre-existing devices in the
network to re-establish a secure connection with each one of them.The
key recovery process checks the commissioning progress
and terminates the recovery when all of the devices have been successfully
commissioned (key information is recovered).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During the key recovery process, the Collector will block new association
requests.</p>
</div>
<p><strong>Sensor side:</strong></p>
<p>The key recovery is mainly driven by the Collector. Therefore for a Sensor
device, this process just consists of going through commissioning
again.</p>
<div class="figure align-center" id="fig-secure-commiss-recover">
<img alt="../_images/fig-sc-key-recover.jpg" src="../_images/fig-sc-key-recover.jpg" />
<p class="caption"><span class="caption-number">Figure 51. </span><span class="caption-text">Key Recovery Process</span><a class="headerlink" href="#fig-secure-commiss-recover" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common-user-interface.html" class="btn btn-neutral float-left" title="Common User Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="beacon-mode.html" class="btn btn-neutral float-right" title="Beacon Enabled Mode" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>