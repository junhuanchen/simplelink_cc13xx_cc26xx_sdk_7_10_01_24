<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zigbee Network Processor (ZNP) Interface &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User&#39;s Guide
 7.10.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MT Interface" href="mt_interface.html" />
    <link rel="prev" title="Power Configuration" href="power_configuration.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug zigbee znp_interface";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide

          </a>
              <div class="version">
                7.10.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/tirtos-index.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">SimpleLink CC13xx/CC26xx SDK Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_zigbee_applications.html">Developing Zigbee Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="application_overview.html">Application Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpd_application_overview.html">Green Power Application Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="z-stack-overview.html">Z-Stack Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash_memory-cc13xx_cc26xx.html">Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_map.html">Memory Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_applications.html">Running the Example Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_configuration.html">Network Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_configuration.html">Power Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Zigbee Network Processor (ZNP) Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#acronyms">Acronyms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#physical-interface">Physical Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#network-processor-signals">Network Processor Signals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#uart-transport">UART Transport</a></li>
<li class="toctree-l4"><a class="reference internal" href="#general-frame-format">General Frame Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization-procedures">Initialization Procedures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#znp-software-command-interface">ZNP Software Command Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-interface">Configuration Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#z-stack-3-0-znp-considerations">Z-Stack 3.0 ZNP Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#return-values">Return Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-considerations-for-znp-device-in-z-stack-3-0">Additional Considerations for ZNP device in Z-Stack 3.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-information">Additional Information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mt_interface.html">MT Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="product_certification.html">Product Certification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc13xx_cc26xx/fcc-certification.html">FCC Certification Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/zigbee-ota-index.html">Zigbee Over-The-Air Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence-ieee.html">Wi-Fi Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="packet_sniffer.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/references-cc13xx_cc26xx.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/glossary.html">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../zigbee-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="developing_zigbee_applications.html">Developing Zigbee Applications</a> &raquo;</li>
      <li>Zigbee Network Processor (ZNP) Interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="zigbee-network-processor-znp-interface">
<span id="znp-interface"></span><h1>Zigbee Network Processor (ZNP) Interface<a class="headerlink" href="#zigbee-network-processor-znp-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Z-Stack Zigbee Network Processor (ZNP) is a cost-effective, low power
solution that provides full Zigbee functionality with a minimal
development effort.  An example is already provided for the <a class="reference external" href="http://www.ti.com/tool/simplelink-cc13xx-cc26xx-sdk">SimpleLink CC13xx/CC26xx SDK</a> at the following location:</p>
<p>&lt;SDK_DIR&gt;\examples\rtos\&lt;LaunchPad variant&gt;\zstack\znp\tirtos7\&lt;ccs/iar&gt;</p>
<p>In this solution the Z-Stack runs on a SoC, i.e. the CC13xx or CC26xx, and the application
runs on an external microcontroller, being any host processor. The Z-Stack ZNP handles all the
Zigbee protocol tasks, and leaves the resources of the application
microcontroller free to handle the application.</p>
<p>This makes it easy for users to add Zigbee to new or existing products
at the same time as it provides great flexibility in choice of microcontroller or other host
operating system.</p>
<p>Z-Stack ZNP interfaces to any microcontroller through a UART serial interface.</p>
<div class="figure align-center" id="id5">
<img alt="../_images/fig-single-device-znp-configuration.png" src="../_images/fig-single-device-znp-configuration.png" />
<p class="caption"><span class="caption-number">Figure 69. </span><span class="caption-text">Single Device and ZNP Configuration</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="acronyms">
<h2>Acronyms<a class="headerlink" href="#acronyms" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 86%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>AF</p></td>
<td><p>Zigbee Application Framework</p></td>
</tr>
<tr class="row-even"><td><p>API</p></td>
<td><p>Application Programming Interface</p></td>
</tr>
<tr class="row-odd"><td><p>AREQ</p></td>
<td><p>Asynchronous Request</p></td>
</tr>
<tr class="row-even"><td><p>BDB</p></td>
<td><p>Base Device Behavior</p></td>
</tr>
<tr class="row-odd"><td><p>CTS</p></td>
<td><p>Clear To Send</p></td>
</tr>
<tr class="row-even"><td><p>FCS</p></td>
<td><p>Frame Check Sequence</p></td>
</tr>
<tr class="row-odd"><td><p>GP</p></td>
<td><p>Green Power</p></td>
</tr>
<tr class="row-even"><td><p>GPIO</p></td>
<td><p>General Purpose I/O</p></td>
</tr>
<tr class="row-odd"><td><p>NPI</p></td>
<td><p>Network Processor Interface</p></td>
</tr>
<tr class="row-even"><td><p>NV</p></td>
<td><p>Non-Volatile</p></td>
</tr>
<tr class="row-odd"><td><p>PA/LNA</p></td>
<td><p>Power Amplifier / Low Noise Amplifier (CC259x)</p></td>
</tr>
<tr class="row-even"><td><p>RTS</p></td>
<td><p>Ready To Send</p></td>
</tr>
<tr class="row-odd"><td><p>SoC</p></td>
<td><p>System on Chip</p></td>
</tr>
<tr class="row-even"><td><p>SREQ</p></td>
<td><p>Synchronous request</p></td>
</tr>
<tr class="row-odd"><td><p>SRSP</p></td>
<td><p>Synchronous response</p></td>
</tr>
<tr class="row-even"><td><p>UART</p></td>
<td><p>Universal Asynchronous Receiver Transmitter</p></td>
</tr>
<tr class="row-odd"><td><p>ZDO</p></td>
<td><p>Zigbee Device Object</p></td>
</tr>
<tr class="row-even"><td><p>ZNP</p></td>
<td><p>Zigbee Network Processor</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="physical-interface">
<h2>Physical Interface<a class="headerlink" href="#physical-interface" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe the physical interfaces for the ZNP.</p>
<div class="section" id="network-processor-signals">
<h3>Network Processor Signals<a class="headerlink" href="#network-processor-signals" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows how an application processor interfaces with the
CC13xx or CC26xx.</p>
<p>The CC13xx or CC26xx ZNP uses RX/TX/RTS/CTS for UART communication. See
<a class="reference internal" href="#sec-signal-description"><span class="std std-ref">Signal Description</span></a> for details.</p>
<div class="section" id="pin-configurations">
<h4>Pin Configurations<a class="headerlink" href="#pin-configurations" title="Permalink to this headline">¶</a></h4>
<p>The CC13xx or CC26xx ZNP pin configurations are described in the following
sections.</p>
<div class="section" id="default-pin-configuration">
<h5>Default Pin Configuration<a class="headerlink" href="#default-pin-configuration" title="Permalink to this headline">¶</a></h5>
<p>By default, the pin configurations are the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 24%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Transport</p></th>
<th class="head"><p>CC13xx or CC26xx ZNP
signal</p></th>
<th class="head"><p>CC26x2
PIN</p></th>
<th class="head"><p>CC13x2
PIN</p></th>
<th class="head"><p>Direction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>UART</strong></p></td>
<td><p><strong>TX</strong></p></td>
<td><p>DIO_3</p></td>
<td><p>DIO_13</p></td>
<td><p><em>Out</em></p></td>
</tr>
<tr class="row-odd"><td><p><strong>UART</strong></p></td>
<td><p><strong>RX</strong></p></td>
<td><p>DIO_2</p></td>
<td><p>DIO_12</p></td>
<td><p><em>In</em></p></td>
</tr>
<tr class="row-even"><td><p><strong>UART</strong></p></td>
<td><p><strong>GND</strong></p></td>
<td><p>GND</p></td>
<td><p>GND</p></td>
<td><p><em>In/Out</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="optional-pin-configuration">
<h5>Optional Pin Configuration<a class="headerlink" href="#optional-pin-configuration" title="Permalink to this headline">¶</a></h5>
<p>If <code class="docutils literal notranslate"><span class="pre">NPI_FLOW_CTRL</span></code> is enabled then the following pins also apply:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 30%" />
<col style="width: 22%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Transport</p></th>
<th class="head"><p>CC13xx or CC26xx ZNP
signal</p></th>
<th class="head"><p>CC13xx or CC26xx
PIN</p></th>
<th class="head"><p>Direction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>UART</strong></p></td>
<td><p><strong>CTS</strong></p></td>
<td><p>DIO_19</p></td>
<td><p><em>In</em></p></td>
</tr>
<tr class="row-odd"><td><p><strong>UART</strong></p></td>
<td><p><strong>RTS</strong></p></td>
<td><p>DIO_18</p></td>
<td><p><em>Out</em></p></td>
</tr>
</tbody>
</table>
<p>For additional information of different parameters which can be modified,
refer to the <a class="reference internal" href="application_overview.html#sec-app-configuration"><span class="std std-ref">Application Preprocessor Configuration</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="uart-transport">
<h3>UART Transport<a class="headerlink" href="#uart-transport" title="Permalink to this headline">¶</a></h3>
<div class="section" id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<p>The following UART configuration is supported:</p>
<ul class="simple">
<li><p>Baud rate: 115200</p></li>
<li><p>CTS/RTS flow control with <code class="docutils literal notranslate"><span class="pre">NPI_FLOW_CTRL</span></code> enabled (disabled by default)</p></li>
<li><p>8-N-1 byte format</p></li>
</ul>
</div>
<div class="section" id="frame-format">
<h4>Frame Format<a class="headerlink" href="#frame-format" title="Permalink to this headline">¶</a></h4>
<p>UART transport frame format is shown in the following figure. The
left-most field is transmitted first over the wire. This is the same
General Serial Packet defined by the <a class="reference external" href="../../../zigbee/Z-Stack%20Monitor%20and%20Test%20API.pdf">Z-Stack Monitor and Test API</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 62%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SOF</p></th>
<th class="head"><p>General Frame Format</p></th>
<th class="head"><p>FCS</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bytes: 1</p></td>
<td><p>3-253</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p><strong>SOF</strong> (Start of Frame): This is always set to 0xFE.</p>
<p><strong>General Frame Format</strong>: This is the general frame format as described
in <a class="reference internal" href="#sec-general-frame-format"><span class="std std-ref">General Frame Format</span></a>.</p>
<p><strong>FCS</strong> (Frame Check Sequence): This field is computed as an XOR of all
the bytes in the general format frame fields.</p>
</div>
<div class="section" id="sample-fcs-calculation">
<h4>Sample FCS Calculation<a class="headerlink" href="#sample-fcs-calculation" title="Permalink to this headline">¶</a></h4>
<p>Shown below is a C example for the FCS calculation:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">npiframe_calcMTFCS</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">msg_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">xorResult</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">xorResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">msg_ptr</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">xorResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorResult</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="o">*</span><span class="n">msg_ptr</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">xorResult</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="signal-description">
<span id="sec-signal-description"></span><h4>Signal Description<a class="headerlink" href="#signal-description" title="Permalink to this headline">¶</a></h4>
<p>The following standard UART signals are used:</p>
<ul class="simple">
<li><p>TX: Transmit data</p></li>
<li><p>RX: Receive data</p></li>
<li><p>CTS: Clear to Send</p></li>
<li><p>RTS: Ready to Send</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CTS/RTS are disabled by default, and are optional. You may enable CTS/RTS
by defining NPI_FLOW_CTRL in the predefined symbols. For more information,
refer to the <a class="reference internal" href="application_overview.html#sec-app-configuration"><span class="std std-ref">Application Preprocessor Configuration</span></a>.</p>
</div>
<p>The figure below shows the RTS/CTS flow control connections to the host
processor. On the CC13xx or CC26xx, RTS and CTS are active-low signals. The RT
output is driven low when the receive register is empty and reception is
enabled. Transmission of a byte does not occur before the CTS input is
low.</p>
<img alt="../_images/ditaa-2a6ae53e1e6fb31c8658171379a3c95a280bae09.png" id="rts-cts-flow-control" src="../_images/ditaa-2a6ae53e1e6fb31c8658171379a3c95a280bae09.png" />
</div>
<div class="section" id="signal-operation">
<h4>Signal Operation<a class="headerlink" href="#signal-operation" title="Permalink to this headline">¶</a></h4>
<p>UART transport sends and receives data asynchronously. Data can be sent
and received simultaneously and the transfer of a frame can be initiated
at any time by either the application processor or the ZNP SoC.</p>
</div>
</div>
<div class="section" id="general-frame-format">
<span id="sec-general-frame-format"></span><h3>General Frame Format<a class="headerlink" href="#general-frame-format" title="Permalink to this headline">¶</a></h3>
<p>The general frame format is shown below. The left-most field is transmitted
first over the wire. For multi-byte fields, the lowest order byte is
transmitted first. This is the same General Frame Format defined by the <a class="reference external" href="../../../zigbee/Z-Stack%20Monitor%20and%20Test%20API.pdf">Z-Stack Monitor and Test API</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 29%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Length</p></th>
<th class="head"><p>Command</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bytes: 1</p></td>
<td><p>2</p></td>
<td><p>0-250</p></td>
</tr>
</tbody>
</table>
<p><strong>Length</strong>: The length of the data field of the frame. The length can
range from 0-250.</p>
<p><strong>Command</strong>: The Command ID for the message. Refer to <a class="reference internal" href="#sec-command-field"><span class="std std-ref">Command Field</span></a>
for more information about the Command field.</p>
<p><strong>Data</strong>: The frame data. This field contains actual data to be transmitted.
This depends on the command field and is described for each command in
<a class="reference internal" href="#sec-znp-software-command-interface"><span class="std std-ref">ZNP Software Command Interface</span></a>. The size can range from 0-250 bytes.</p>
<div class="section" id="command-field">
<span id="sec-command-field"></span><h4>Command Field<a class="headerlink" href="#command-field" title="Permalink to this headline">¶</a></h4>
<p>The command field is constructed of two bytes. The bytes are formatted
as shown in the following figure. The Cmd0 byte is transmitted first, followed
by the Cmd1 byte.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 33%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Cmd0</p></th>
<th class="head"><p>Cmd1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bit: 7-5</p></td>
<td><p>4-0</p></td>
<td><p>7-0</p></td>
</tr>
<tr class="row-odd"><td><p>Type</p></td>
<td><p>Subsystem</p></td>
<td><p>Id</p></td>
</tr>
</tbody>
</table>
<p><strong>Type</strong>: The command type described by bits 5, 6, 7 of the Cmd0 byte. The
command type has one of the following values:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Cmd0 Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>POLL</p></td>
<td><p>0x00</p></td>
</tr>
<tr class="row-odd"><td><p>SREQ</p></td>
<td><p>0x20</p></td>
</tr>
<tr class="row-even"><td><p>AREQ</p></td>
<td><p>0x40</p></td>
</tr>
<tr class="row-odd"><td><p>SRSP</p></td>
<td><p>0x60</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><p><strong>0: POLL</strong>. Not used in Z-Stack.</p></li>
<li><p><strong>1: SREQ</strong>: A synchronous request that requires an immediate
response. For example, a function call with a return value would use
an SREQ command.</p></li>
<li><p><strong>2: AREQ</strong>: An asynchronous request. For example, a callback event
or a function call with no return value would use an AREQ command.</p></li>
<li><p><strong>3: SRSP</strong>: A synchronous response. This type of command is only
sent in response to a SREQ command. For an SRSP command the subsystem
and ID are set to the same values as the corresponding SREQ. The
length of an SRSP is generally nonzero, so an SRSP with length=0 can
be used to indicate an error.</p></li>
<li><p><strong>4-7: Reserved</strong>.</p></li>
</ul>
<p><strong>Subsystem</strong>: The subsystem of the command is described by bits 0-4
of Cmd0. The command subsystem values are shown below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Subsystem Value</p></th>
<th class="head"><p>Subsystem Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x00</p></td>
<td><p>RPC Error interface</p></td>
</tr>
<tr class="row-odd"><td><p>0x01</p></td>
<td><p>SYS interface</p></td>
</tr>
<tr class="row-even"><td><p>0x02</p></td>
<td><p>MAC interface</p></td>
</tr>
<tr class="row-odd"><td><p>0x03</p></td>
<td><p>NWK interface</p></td>
</tr>
<tr class="row-even"><td><p>0x04</p></td>
<td><p>AF interface</p></td>
</tr>
<tr class="row-odd"><td><p>0x05</p></td>
<td><p>ZDO interface</p></td>
</tr>
<tr class="row-even"><td><p>0x06</p></td>
<td><p>Simple API interface</p></td>
</tr>
<tr class="row-odd"><td><p>0x07</p></td>
<td><p>UTIL interface</p></td>
</tr>
<tr class="row-even"><td><p>0x08</p></td>
<td><p>DEBUG interface</p></td>
</tr>
<tr class="row-odd"><td><p>0x09</p></td>
<td><p>APP Interface</p></td>
</tr>
<tr class="row-even"><td><p>0x0F</p></td>
<td><p>APP config</p></td>
</tr>
<tr class="row-odd"><td><p>0x15</p></td>
<td><p>GreenPower</p></td>
</tr>
</tbody>
</table>
<p><strong>ID</strong>: The command ID. The ID maps to a particular interface message.</p>
<p>Cmd1 provides an 8-bit command ID code, which maps to a specific interface
message for the Subsystem specified in Cmd0. Therefore, each MT subsystem
can provide up to 256 message handling functions.</p>
</div>
<div class="section" id="command-error">
<h4>Command Error<a class="headerlink" href="#command-error" title="Permalink to this headline">¶</a></h4>
<p>When an SREQ command from the Host Processor is not recognized by the ZNP, an
error SRSP is returned, detailed in the two tables below.</p>
<p><strong>SRSP</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 13%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes: 1</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Length = 0x03</p></td>
<td><p>Cmd0 = 0x60</p></td>
<td><p>Cmd1 = 0x00</p></td>
<td><p>ErrorCode</p></td>
<td><p>ReqCmd0</p></td>
<td><p>ReqCmd1</p></td>
</tr>
</tbody>
</table>
<p><strong>Attributes</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 25%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Length (byte)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ErrorCode</p></td>
<td><p>1</p></td>
<td><p>The error code maps to one of the
following enumerated values.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p>Invalid subsystem</p></td>
</tr>
<tr class="row-odd"><td><p>0x02</p></td>
<td><p>Invalid command ID</p></td>
</tr>
<tr class="row-even"><td><p>0x03</p></td>
<td><p>Invalid parameter</p></td>
</tr>
<tr class="row-odd"><td><p>0x04</p></td>
<td><p>Invalid length</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-odd"><td><p>ReqCmd0</p></td>
<td><p>1</p></td>
<td><p>The Cmd0 value of the
processed SREQ</p></td>
</tr>
<tr class="row-even"><td><p>ReqCmd1</p></td>
<td><p>1</p></td>
<td><p>The Cmd1 value of the
processed SREQ</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="initialization-procedures">
<h3>Initialization Procedures<a class="headerlink" href="#initialization-procedures" title="Permalink to this headline">¶</a></h3>
<div class="section" id="device-znp-power-up-procedure">
<h4>CC13xx or CC26xx ZNP Power-up Procedure<a class="headerlink" href="#device-znp-power-up-procedure" title="Permalink to this headline">¶</a></h4>
<p>The recommended power-up procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Application processor and CC13xx or CC26xx power up.</p></li>
<li><p>The application processor initializes its UART interface.</p></li>
<li><p>The application processor receives the <code class="code docutils literal notranslate"><span class="pre">SYS_RESET_IND</span></code> message.</p></li>
</ol>
<p>The CC13xx or CC26xx ZNP can be reset when the application processor sends a
<code class="code docutils literal notranslate"><span class="pre">SYS_RESET_REQ</span></code> message.</p>
</div>
</div>
</div>
<div class="section" id="znp-software-command-interface">
<span id="sec-znp-software-command-interface"></span><h2>ZNP Software Command Interface<a class="headerlink" href="#znp-software-command-interface" title="Permalink to this headline">¶</a></h2>
<p>The ZNP software command interface is sub-divided into the following
categories</p>
<ul class="simple">
<li><p>The SYS interface (MT_SYS) provides the application processor with a
low level interface to the ZNP hardware and software.</p></li>
<li><p>The AF (MT_AF) and ZDO (MT_ZDO) interfaces feature the complete
Zigbee interface and can be used to create a full range of Zigbee
compliant applications. The AF (Application Framework) interface
allows the application processor to register its application with the
ZNP and send and receive data. The ZDO (Zigbee Device Object)
interface provides various Zigbee management functions like device
and service discovery.</p></li>
<li><p>The UTIL (MT_UTIL) interface provides support functionalities such as
setting PAN-ID, getting device info, getting NV info, subscribing
callbacks, etc.</p></li>
<li><p>The APP CONF (MT_APP_CNF) interface provides support for BDB
functionality such as set Install Codes, Primary or Secondary
Channel, trigger different commissioning methods and other Trust
Center configurations.</p></li>
</ul>
<p>Each of these are enabled inside of the project
<code class="code docutils literal notranslate"><span class="pre">Stack/Config/znp_cnf.opts</span></code> file. For further details on the MT
interface, refer to the <a class="reference external" href="../../../zigbee/Z-Stack%20Monitor%20and%20Test%20API.pdf">Z-Stack Monitor and Test API</a>.</p>
<div class="section" id="configuration-interface">
<h3>Configuration Interface<a class="headerlink" href="#configuration-interface" title="Permalink to this headline">¶</a></h3>
<p>The ZNP device has numerous parameters that can be configured by the
application processor. These configuration parameters are stored in non-volatile
memory on the ZNP device and their values persist across a device reset.</p>
<p>The configuration parameters are divided into “network-specific” and
“device-specific” parameters. The “network-specific” configuration
parameters should be set to the same value for all ZNP devices in a
Zigbee network to ensure proper network operation. The “device-specific”
parameters can be set to different values on each device. These
parameters are listed in detail in <a class="reference internal" href="#sec-device-configuration-parameters"><span class="std std-ref">Device Specific Configuration Parameters</span></a>
and <a class="reference internal" href="#sec-network-configuration-parameters"><span class="std std-ref">Network Specific Configuration Parameters</span></a>. These
configuration parameters must be written in NV for which the host
processor must use the MT interface to write NV parameters into the ZNP
device. Refer to the <a class="reference external" href="../../../zigbee/Z-Stack%20Monitor%20and%20Test%20API.pdf">Z-Stack Monitor and Test API</a> for further details on how to write into NV.</p>
<p>When the ZNP device powers up, it reads two of the configuration
parameters immediately. These are the <code class="code docutils literal notranslate"><span class="pre">STARTOPT_CLEAR_CONFIG</span></code> bit
(part of the <code class="code docutils literal notranslate"><span class="pre">ZCD_NV_STARTUP_OPTION</span></code> parameter) and the
<code class="code docutils literal notranslate"><span class="pre">ZCD_NV_LOGICAL_TYPE</span></code> parameters. Any modification of these parameters
will require a ZNP device reset before they can take effect.</p>
<div class="section" id="device-specific-configuration-parameters">
<span id="sec-device-configuration-parameters"></span><h4>Device Specific Configuration Parameters<a class="headerlink" href="#device-specific-configuration-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="zcd-nv-startup-option">
<h5>ZCD_NV_STARTUP_OPTION<a class="headerlink" href="#zcd-nv-startup-option" title="Permalink to this headline">¶</a></h5>
<p>These are the ZCD_NV_STARTUP_OPTION values:</p>
<ul class="simple">
<li><p>ZCD_STARTOPT_DEFAULT_CONFIG_STATE (0x01)</p></li>
<li><p>ZCD_STARTOPT_DEFAULT_NETWORK_STATE (0x02)</p></li>
<li><p>ZCD_STARTOPT_AUTO_START (0x04)</p></li>
<li><p>ZCD_STARTOPT_CLEAR_CONFIG (ZCD_STARTOPT_DEFAULT_CONFIG_STATE)</p></li>
<li><p>ZCD_STARTOPT_CLEAR_STATE  (ZCD_STARTOPT_DEFAULT_NETWORK_STATE)</p></li>
<li><p>ZCD_STARTOPT_CLEAR_NWK_FRAME_COUNTER (0x80)</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 25%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Item ID</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x0003</p></td>
<td><p>1 Byte</p></td>
<td><p>0x00</p></td>
</tr>
</tbody>
</table>
<p>This parameter controls the device startup options. This is a bit mask
of the following values:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bit Position</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>7</p></td>
<td><p>ZCD_STARTOPT_CLEAR_NWK_FRAME_COUNTER</p></td>
</tr>
<tr class="row-odd"><td><p>6-2</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>ZCD_STARTOPT_CLEAR_STATE</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>ZCD_STARTOPT_CLEAR_CONFIG</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>ZCD_STARTOPT_CLEAR_NWK_FRAME_COUNTER</strong> – If this option is set, then
the network frame counter is cleared for all networks.</p></li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be use only for debug purposes as the network
frame counters must be persistant, even after Factory New resets. The
usage of this option during the operation in the networks may lead to
undesaried behaviour, such as get the ZNP device ignored by other
devices in the network.</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>ZCD_STARTOPT_CLEAR_CONFIG</strong> – If this option is set, the device will
overwrite all the configuration parameters (except this one) with the
“default” values that it is programmed with. This is used to erase
the existing configuration and bring the device into a known state.</p></li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">ZCD_STARTOPT_CLEAR_CONFIG</span></code> bit is read by the ZNP device
immediately when it powers up after a reset. When the configuration
parameters are restored to defaults, the <code class="code docutils literal notranslate"><span class="pre">ZCD_NV_STARTUP_OPTION</span></code>
itself is not restored except for clearing the
<code class="code docutils literal notranslate"><span class="pre">ZCD_STARTOPT_CLEAR_CONFIG</span></code> bit.</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>ZCD_STARTOPT_CLEAR_STATE</strong> – If this option is set, the device will clear
its previous network state (which would exist if the device had been
operating on a network prior to the reset). This is typically used
during application development. During regular device operation, this
flag is typically not set, so that an accidental device reset will
not cause loss of network state.</p></li>
</ul>
<p>The ZNP device has two kinds of information stored in
non-volatile memory. The configuration parameters (in this section)
and network state information (in <a class="reference internal" href="#sec-network-configuration-parameters"><span class="std std-ref">Network Specific Configuration Parameters</span></a>)</p>
<p>The configuration parameters are configured by the user before start
of Zigbee operation.</p>
<p>The network state information is collected by the device after it
joins a network and creates bindings (at runtime). This is not
set by the application processor. This information is stored so that
if the device were to reset, it can restore itself without going through
the network joining and binding process again.</p>
<p>If the application processor does not wish to continue operating in
the previous Zigbee network, it needs to instruct the ZNP device to
clear the network state information and start again based on the
configuration parameters. This is done by setting the
<code class="code docutils literal notranslate"><span class="pre">ZCD_STARTOPT_CLEAR_STATE</span></code> bit in the startup option.</p>
</div>
<div class="section" id="zcd-nv-logical-type">
<h5>ZCD_NV_LOGICAL_TYPE<a class="headerlink" href="#zcd-nv-logical-type" title="Permalink to this headline">¶</a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 25%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Item ID</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x0087</p></td>
<td><p>1 Byte</p></td>
<td><p>0x00</p></td>
</tr>
</tbody>
</table>
<p>This is the logical type of the device in the Zigbee network. This can
be set to a <code class="code docutils literal notranslate"><span class="pre">ZG_DEVICETYPE_COORDINATOR</span></code> (0x00),
<code class="code docutils literal notranslate"><span class="pre">ZG_DEVICETYPE_ROUTER</span></code> (0x01), or <code class="code docutils literal notranslate"><span class="pre">ZG_DEVICETYPE_ENDDEVICE</span></code> (0x02).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This parameter is read by the ZNP device immediately when it powers up
after a reset.</p>
</div>
</div>
<div class="section" id="zcd-nv-zdo-direct-cb">
<h5>ZCD_NV_ZDO_DIRECT_CB<a class="headerlink" href="#zcd-nv-zdo-direct-cb" title="Permalink to this headline">¶</a></h5>
<p>This is set to <code class="code docutils literal notranslate"><span class="pre">TRUE</span></code> by <code class="code docutils literal notranslate"><span class="pre">zgZdoDirectCB</span></code> in <code class="code docutils literal notranslate"><span class="pre">zglobals.c</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 25%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Item ID</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x008F</p></td>
<td><p>1 Byte</p></td>
<td><p>TRUE</p></td>
</tr>
</tbody>
</table>
<p>This configures the manner in which ZDO responses (hereby referred to as
callbacks) are issued to the host processor. By default, this item is
set to <code class="code docutils literal notranslate"><span class="pre">TRUE</span></code>, which means that the host processor will receive the
“verbose” response. For example, the host processor would receive the
<code class="code docutils literal notranslate"><span class="pre">ZDO_IEEE_ADDR_RSP</span></code> command in response to <code class="code docutils literal notranslate"><span class="pre">ZDO_IEEE_ADDR_REQ</span></code>.
If <code class="code docutils literal notranslate"><span class="pre">ZCD_NV_ZDO_DIRECT_CB</span></code> is set to <code class="code docutils literal notranslate"><span class="pre">FALSE</span></code>,
then the host processor must use the <code class="code docutils literal notranslate"><span class="pre">ZDO_MSG_CB_REGISTER</span></code> command to
subscribe to a specific ZDO callback in order to receive it.</p>
</div>
</div>
<div class="section" id="network-specific-configuration-parameters">
<span id="sec-network-configuration-parameters"></span><h4>Network Specific Configuration Parameters<a class="headerlink" href="#network-specific-configuration-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="zcd-nv-panid">
<h5>ZCD_NV_PANID<a class="headerlink" href="#zcd-nv-panid" title="Permalink to this headline">¶</a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 25%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Item ID</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x0083</p></td>
<td><p>2 Bytes</p></td>
<td><p>0xFFFF</p></td>
</tr>
</tbody>
</table>
<p>This parameter identifies the Zigbee network. This should be set to a
value between 0 and 0x3FFF. Networks that exist in the same vicinity
must have different values for this parameter. It can be set to a
special value of 0xFFFF to indicate “don’t care”.</p>
</div>
</div>
</div>
<div class="section" id="z-stack-3-0-znp-considerations">
<h3>Z-Stack 3.0 ZNP Considerations<a class="headerlink" href="#z-stack-3-0-znp-considerations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="backward-compatibility">
<h4>Backward compatibility<a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h4>
<p>ZNP is backward compatible with non Z3.0 devices by using the same API
that already existed in previous releases of the Z-Stack, or by using Base
Device Behavior commissioning MT interface with exception of the new
security schemas for Z3.0 such as <a class="reference internal" href="z-stack-overview.html#sec-distributed-security-network"><span class="std std-ref">Distributed Security Network</span></a>
or <a class="reference internal" href="z-stack-overview.html#sec-install-code-usage"><span class="std std-ref">Install Code Derived Trust Center Link Key</span></a>.</p>
</div>
<div class="section" id="znp-for-zigbee-3-0">
<h4>ZNP for Zigbee 3.0<a class="headerlink" href="#znp-for-zigbee-3-0" title="Permalink to this headline">¶</a></h4>
<p>While the ZNP implementation provides a compatible baseline for Zigbee
3.0 devices, a full implementation of a Zigbee 3.0 device involves
additional layers on top of the ZNP. These layers shall be implemented
by the user on the host-side of the stack, since they are outside the
scope of the network processor. The ZNP provides several new interfaces
to enable the required functionality on the host.</p>
<p>In order to update a legacy ZNP-based device to support Zigbee 3.0, the
following main updates need to be implemented on the host:</p>
<p>Base Device Behavior Specification:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Finding and Binding: Host processor is required to implement Finding
and Binding commissioning method (either as Initiator or as Target)
according to the cluster supported by the host application.</p></li>
<li><p>Touchlink (optional): Proximity-based commissioning method.</p></li>
</ol>
</div></blockquote>
<p>Green Power Basic Proxy:</p>
<blockquote>
<div><p>Zigbee 3.0 coordinator and router devices must implement Green Power
Basic proxy functionality. ZNP includes the necessary GP Stub
interfaces which are available to the application and allow it to
implement GP basic proxy functionality on the host processor.</p>
</div></blockquote>
</div>
<div class="section" id="znp-startup-procedure-for-zigbee-3-0-implementation">
<h4>ZNP Startup Procedure for Zigbee 3.0 Implementation<a class="headerlink" href="#znp-startup-procedure-for-zigbee-3-0-implementation" title="Permalink to this headline">¶</a></h4>
<p>After executing the power-up procedure, the host processor must call
some mandatory APIs before executing any APIs that invoke Zigbee
over-the-air messaging. Not following this sequence could result in
unexpected behaviour. The recommended startup procedure is as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The host processor must use the <code class="code docutils literal notranslate"><span class="pre">SYS_OSAL_NV_WRITE</span></code> command to
configure at the minimum the <code class="code docutils literal notranslate"><span class="pre">ZCD_NV_LOGICAL_TYPE</span></code>.</p></li>
<li><p>If logical device is defined as ZC or ZR, GP basic proxy must be
initialized in the host processor (No ZNP commands are required until
interaction with GP devices are needed).</p></li>
<li><p>Optional configurations to commission the device are:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Set the Primary and/or Secondary channel mask to perform Formation
or Network Steering.</p></li>
<li><p>Set the PAN ID to create or join by setting <code class="code docutils literal notranslate"><span class="pre">ZCD_NV_PAN_ID</span></code>.</p></li>
<li><p>Set Install codes for networks which require it.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p><code class="code docutils literal notranslate"><span class="pre">AF_REGISTER</span></code> command should be sent by the host processor to
register the application endpoint.</p></li>
<li><p>Host should use <code class="code docutils literal notranslate"><span class="pre">APP_CNF_BDB</span></code> API to set channel masks and
create or join the network via standard BDB specification.</p></li>
<li><p>The host processor should wait for BDB notifications on the different
commissioning methods used by the host. Also host processor can rely
on the supported ZDO states reported.</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="example-message-exchange">
<h4>Example Message Exchange<a class="headerlink" href="#example-message-exchange" title="Permalink to this headline">¶</a></h4>
<p>The following sequence chart is provided as a simple example of a
message exchange between a Host and ZNP. In this example the following
(generalized) events take place:</p>
<div class="figure align-center" id="id6">
<p class="plantuml">
<img src="../_images/plantuml-3963645bec2b23b329d7375bb749174492c71309.png" alt="&#64;startuml
participant &quot;Host Processor&quot; as HP
participant ZNP
note left of HP: **Step 1**: The ZNP is reset
ZNP -&gt; HP: MT_SYS_RESET_IND (AREQ) (0x4180)
HP -&gt; ZNP: MT_SYS_RESET_REQ (SREQ) (0x4100)
activate ZNP
ZNP --&gt; HP: MT_SYS_RESET_IND (AREQ) (0x4180)
deactivate ZNP
note left of HP
  **Step 2**: The Host writes some configuration data
  to the ZNP into NV (&quot;&quot;ZCD_NV_LOGICAL_TYPE&quot;&quot;)
  which will define the Logical Device Role.
end note
HP -&gt; ZNP: MT_SYS_WRITE_NV_REQ (SREQ) (0x2109)
activate ZNP
ZNP --&gt; HP: MT_SYS_WRITE_NV_RSP (SRSP) (0x6109)
deactivate ZNP
HP -&gt; ZNP: MT_SYS_RESET_REQ (SREQ) (0x4100)
activate ZNP
ZNP --&gt; HP: MT_SYS_RESET_IND (AREQ) (0x4180)
deactivate ZNP
note left of HP
  **Step 3**: An endpoint in the host
  is registered with the ZNP.
end note
HP -&gt; ZNP: MT_AF_REGISTER (SREQ) (0x2400)
activate ZNP
ZNP --&gt; HP: MT_AF_REGISTER (SRSP) (0x6400)
deactivate ZNP
note left of HP
  **Step 4**: ZNP device starts a commissioning
  method according to device role from Step 2
  (e.g. Commissioning Formation for ZC/ZR, or
  Commissioning Network Steering for ZR/ZED)
end note
HP -&gt; ZNP: MT_APP_CNF_BDB_START_COMMISSIONING (SREQ) (0x2F05)
activate ZNP
ZNP --&gt; HP: MT_APP_CNF_BDB_START_COMMISSIONING (SRSP) (0x6F05)
deactivate ZNP
note right of ZNP
  **Step 5**: BDB reports the result of the
  commissioning method execution.
end note
ZNP -&gt; HP: MT_APP_CNF_BDB_NOTIFICATION (AREQ) (0x4F80)
ZNP -&gt; HP: MT_ZDO_STATE_CHANGE_IND (AREQ) (0x45C0)
note right of ZNP
  **Step 6**: Another device joins the network,
  indicated by the ZDO Device Indications.
end note
ZNP -&gt; HP: MT_ZDO_TC_DEVICE_IND (AREQ) (0x45CA)
note left of HP
  **Step 7**: Data is exchanged between the Host+ZNP
  and joining device through AF Data Requests
  and AF Incoming Messages.
end note
HP -&gt; ZNP: MT_AF_DATA_REQ (SREQ) (0x2401)
activate ZNP
ZNP --&gt; HP: MT_AF_DATA_REQ (SRSP) (0x6401)
deactivate ZNP
HP -&gt; ZNP: MT_AF_DATA_CNF (AREQ) (0x4480)
activate ZNP
ZNP --&gt; HP: MT_AF_INCOMING_MSG (AREQ) (0x4481)
deactivate ZNP
&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 70. </span><span class="caption-text">Example Message Sequence Chart</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="return-values">
<h3>Return Values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h3>
<p>The status parameter that is returned from the ZNP device may take one
of the following values:</p>
<table class="docutils align-default" id="id7">
<caption><span class="caption-number">Table 1. </span><span class="caption-text">General Collection of Status Values</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ZSuccess</p></td>
<td><p><em>0x00</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZFailure</p></td>
<td><p><em>0x01</em></p></td>
</tr>
<tr class="row-even"><td><p>ZInvalidParameter</p></td>
<td><p><em>0x02</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZDecodeError</p></td>
<td><p><em>0x03</em></p></td>
</tr>
<tr class="row-even"><td><p>NV_ITEM_UNINIT</p></td>
<td><p><em>0x09</em></p></td>
</tr>
<tr class="row-odd"><td><p>NV_OPER_FAILED</p></td>
<td><p><em>0x0a</em></p></td>
</tr>
<tr class="row-even"><td><p>NV_BAD_ITEM_LEN</p></td>
<td><p><em>0x0c</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZMemError</p></td>
<td><p><em>0x10</em></p></td>
</tr>
<tr class="row-even"><td><p>ZBufferFull</p></td>
<td><p><em>0x11</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZUnsupportedMode</p></td>
<td><p><em>0x12</em></p></td>
</tr>
<tr class="row-even"><td><p>ZMacMemError</p></td>
<td><p><em>0x13</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZSapiInProgress</p></td>
<td><p><em>0x20</em></p></td>
</tr>
<tr class="row-even"><td><p>ZSapiTimeout</p></td>
<td><p><em>0x21</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZSapiInit</p></td>
<td><p><em>0x22</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNotAuthorized</p></td>
<td><p><em>0x7E</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZMalformedCmd</p></td>
<td><p><em>0x80</em></p></td>
</tr>
<tr class="row-even"><td><p>ZUnsupClusterCmd</p></td>
<td><p><em>0x81</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZOtaAbort</p></td>
<td><p><em>0x95</em></p></td>
</tr>
<tr class="row-even"><td><p>ZOtaImageInvalid</p></td>
<td><p><em>0x96</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZOtaWaitForData</p></td>
<td><p><em>0x97</em></p></td>
</tr>
<tr class="row-even"><td><p>ZOtaNoImageAvailable</p></td>
<td><p><em>0x98</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZOtaRequireMoreImage</p></td>
<td><p><em>0x99</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsFail</p></td>
<td><p><em>0xb1</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZApsTableFull</p></td>
<td><p><em>0xb2</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsIllegalRequest</p></td>
<td><p><em>0xb3</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZApsInvalidBinding</p></td>
<td><p><em>0xb4</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsUnsupportedAttrib</p></td>
<td><p><em>0xb5</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZApsNotSupported</p></td>
<td><p><em>0xb6</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsNoAck</p></td>
<td><p><em>0xb7</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZApsDuplicateEntry</p></td>
<td><p><em>0xb8</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsNoBoundDevice</p></td>
<td><p><em>0xb9</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZApsNotAllowed</p></td>
<td><p><em>0xba</em></p></td>
</tr>
<tr class="row-even"><td><p>ZApsNotAuthenticated</p></td>
<td><p><em>0xbb</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZSecNoKey</p></td>
<td><p><em>0xa1</em></p></td>
</tr>
<tr class="row-even"><td><p>ZSecOldFrmCount</p></td>
<td><p><em>0xa2</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZSecMaxFrmCount</p></td>
<td><p><em>0xa3</em></p></td>
</tr>
<tr class="row-even"><td><p>ZSecCcmFail</p></td>
<td><p><em>0xa4</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkInvalidParam</p></td>
<td><p><em>0xc1</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNwkInvalidRequest</p></td>
<td><p><em>0xc2</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkNotPermitted</p></td>
<td><p><em>0xc3</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNwkStartupFailure</p></td>
<td><p><em>0xc4</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkTableFull</p></td>
<td><p><em>0xc7</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNwkUnknownDevice</p></td>
<td><p><em>0xc8</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkUnsupportedAttribute</p></td>
<td><p><em>0xc9</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNwkNoNetworks</p></td>
<td><p><em>0xca</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkLeaveUnconfirmed</p></td>
<td><p><em>0xcb</em></p></td>
</tr>
<tr class="row-even"><td><p>ZNwkNoAck</p></td>
<td><p><em>0xcc</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZNwkNoRoute</p></td>
<td><p><em>0xcd</em></p></td>
</tr>
<tr class="row-even"><td><p><em>ZMacNoACK</em></p></td>
<td><p><em>0xe9</em></p></td>
</tr>
<tr class="row-odd"><td><p>ZAfDuplicateEndpoint</p></td>
<td><p><em>0xd0</em></p></td>
</tr>
<tr class="row-even"><td><p>ZAfEndpointMax</p></td>
<td><p><em>0xd1</em></p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id8">
<caption><span class="caption-number">Table 2. </span><span class="caption-text">Common ZDO Status Values</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 36%" />
<col style="width: 12%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SUCCESS</p></td>
<td><p><em>0x00</em></p></td>
<td><p>Operation completed successfully</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_REQTYPE</p></td>
<td><p><em>0x80</em></p></td>
<td><p>Supplied request type invalid</p></td>
</tr>
<tr class="row-even"><td><p>DEVICE_NOT_FOUND</p></td>
<td><p><em>0x81</em></p></td>
<td><p>Device not found</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_EP</p></td>
<td><p><em>0x82</em></p></td>
<td><p>Invalid Endpoint value</p></td>
</tr>
<tr class="row-even"><td><p>NOT_ACTIVE</p></td>
<td><p><em>0x83</em></p></td>
<td><p>Endpoint not described by simple
description</p></td>
</tr>
<tr class="row-odd"><td><p>NOT_SUPPORTED</p></td>
<td><p><em>0x84</em></p></td>
<td><p>Optional feature not supported</p></td>
</tr>
<tr class="row-even"><td><p>TIMEOUT</p></td>
<td><p><em>0x85</em></p></td>
<td><p>Operation timed out</p></td>
</tr>
<tr class="row-odd"><td><p>NO_MATCH</p></td>
<td><p><em>0x86</em></p></td>
<td><p>No match for End Device bind</p></td>
</tr>
<tr class="row-even"><td><p>NO_ENTRY</p></td>
<td><p><em>0x88</em></p></td>
<td><p>Unbind request failed, no entry</p></td>
</tr>
<tr class="row-odd"><td><p>NO_DESCRIPTOR</p></td>
<td><p><em>0x89</em></p></td>
<td><p>Child descriptor not available</p></td>
</tr>
<tr class="row-even"><td><p>INSUFFICIENT_SPACE</p></td>
<td><p><em>0x8a</em></p></td>
<td><p>Insufficient space to support
operation</p></td>
</tr>
<tr class="row-odd"><td><p>NOT_PERMITTED</p></td>
<td><p><em>0x8b</em></p></td>
<td><p>Not in proper state to support
operation</p></td>
</tr>
<tr class="row-even"><td><p>TABLE_FULL</p></td>
<td><p><em>0x8c</em></p></td>
<td><p>No table space to support operation</p></td>
</tr>
<tr class="row-odd"><td><p>NOT_AUTHORIZED</p></td>
<td><p><em>0x8d</em></p></td>
<td><p>Permissions indicate request not
authorized</p></td>
</tr>
<tr class="row-even"><td><p>BINDING_TABLE_FULL</p></td>
<td><p><em>0x8e</em></p></td>
<td><p>No binding table space to support
operation</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="additional-considerations-for-znp-device-in-z-stack-3-0">
<h3>Additional Considerations for ZNP device in Z-Stack 3.0<a class="headerlink" href="#additional-considerations-for-znp-device-in-z-stack-3-0" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>The current version of ZNP device does not support commissioning GP
devices in the network if these devices require the basic proxy
device to switch channel during this commissioning process. Other
commissioning methods require that a Host Processor drives the
commissioning process in the application level.</p></li>
<li><p>The ZNP project does not contain an application task and as such the
Z-Stack APIs cannot be used as they would with other Z-Stack examples.</p></li>
</ol>
</div>
<div class="section" id="additional-information">
<h3>Additional Information<a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h3>
<p>For additional details of the individual commands, please refer to the
<a class="reference external" href="../../../zigbee/Z-Stack%20Monitor%20and%20Test%20API.pdf">Z-Stack Monitor and Test API</a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="power_configuration.html" class="btn btn-neutral float-left" title="Power Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mt_interface.html" class="btn btn-neutral float-right" title="MT Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>