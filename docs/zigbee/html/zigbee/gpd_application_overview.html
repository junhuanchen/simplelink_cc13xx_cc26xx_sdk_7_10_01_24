<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Green Power Application Overview &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User&#39;s Guide
 7.10.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Z-Stack Overview" href="z-stack-overview.html" />
    <link rel="prev" title="Application Overview" href="application_overview.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug zigbee gpd_application_overview";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide

          </a>
              <div class="version">
                7.10.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/tirtos-index.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">SimpleLink CC13xx/CC26xx SDK Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_zigbee_applications.html">Developing Zigbee Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="application_overview.html">Application Overview</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Green Power Application Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#green-power-device">Green Power Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-application-architecture">General Application Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#green-power-device-configuration">Green Power Device Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-volatile-memory">Non Volatile Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callbacks">Callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send-green-power-data-frames">Send Green Power Data Frames</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-network-with-gpd-and-gps">Setting Up the Network with GPD and GPS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#select-network-channel">Select Network Channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-and-open-the-network-on-the-gps">Create and Open the Network on the GPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#join-the-gpp-device">Join the GPP Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-commissioning-on-the-gps">Enable Commissioning on the GPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commission-the-gpd-into-the-network">Commission the GPD into the Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-ubiqua-capture-of-green-power-traffic">Example Ubiqua Capture of Green Power Traffic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-green-power-proxy-capabilities-to-routing-sample-applications">Adding Green Power Proxy Capabilities to Routing Sample Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-green-power-sink-capabilities-to-routing-sample-applications">Adding Green Power Sink Capabilities to Routing Sample Applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-steps">Basic Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#detailed-steps-of-adding-sink-functionality">Detailed Steps of Adding Sink Functionality</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="z-stack-overview.html">Z-Stack Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash_memory-cc13xx_cc26xx.html">Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_map.html">Memory Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_applications.html">Running the Example Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_configuration.html">Network Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_configuration.html">Power Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="znp_interface.html">Zigbee Network Processor (ZNP) Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="mt_interface.html">MT Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="product_certification.html">Product Certification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc13xx_cc26xx/fcc-certification.html">FCC Certification Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/zigbee-ota-index.html">Zigbee Over-The-Air Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence-ieee.html">Wi-Fi Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="packet_sniffer.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/references-cc13xx_cc26xx.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/glossary.html">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../zigbee-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="developing_zigbee_applications.html">Developing Zigbee Applications</a> &raquo;</li>
      <li>Green Power Application Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="green-power-application-overview">
<h1>Green Power Application Overview<a class="headerlink" href="#green-power-application-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="green-power-device">
<h2>Green Power Device<a class="headerlink" href="#green-power-device" title="Permalink to this headline">¶</a></h2>
<p>A Green Power Device (GPD) is a special type of Zigbee device different from the three logical devices defined in Zigbee PRO:
<em>Coordinator</em>, <em>Router</em> or <em>End Device</em>.  These devices are designed for applications where the end product has a very strict
energy budget, such as an energy-harvesting device or batteryless devices. GPDs follow their own Zigbee Green Power specification which
defines the possible capabilities of a given GPD implementation, such as security level, commissioning procedures and supported
commands per device definition.</p>
<p>As GPDs are the most restricted device in terms of functionality, these devices are not part of
the Zigbee network unless they are commissioned to a Green Power Sink (GPS) device directly or through a Green Power Proxy
(GPP). If the device to which a GPD is commissioned to is not present, then the GPD must be recommissioned, as it does not have a
means to keep communication with any other device.</p>
<p>Once the GPD is commissioned it can send Green Power Data Frames (GPDF) which
are converted by the GPP into Green Power Notifications (ZCL frames) that can travel through the Zigbee network until it reaches
its GPS destination to be processed by the application. For further details on GPDs and their interactions with the network,
please refer to <a class="reference internal" href="z-stack-overview.html#z-stack-overview-green-power"><span class="std std-ref">Green Power</span></a>.</p>
</div>
<div class="section" id="general-application-architecture">
<span id="sec-gpd-general-application-architecture"></span><h2>General Application Architecture<a class="headerlink" href="#general-application-architecture" title="Permalink to this headline">¶</a></h2>
<p>This section describes how a Green Power Device application task is
structured in more detail.</p>
<div class="section" id="green-power-device-configuration">
<span id="sec-gpd-configuration"></span><h3>Green Power Device Configuration<a class="headerlink" href="#green-power-device-configuration" title="Permalink to this headline">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">gpd_config.h</span></code> provides configuration definitions for security level and keys.
These are used at build time and determine the behavior of the device at runtime.
Thus, to change the Green Power Device behavior, it is necessary to modify the SysConfig settings,
the descriptions of which are covered in <a class="reference internal" href="z-stack-overview.html#z-stack-overview-green-power"><span class="std std-ref">Green Power</span></a>.
An example of creating a GPD switch is given below (found in <code class="code docutils literal notranslate"><span class="pre">default/syscfg/ti_zstack_config.h</span></code>
of the <code class="code docutils literal notranslate"><span class="pre">gpd_switch</span></code> project after building).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef GPD_CHANNEL</span>
<span class="cp">#define GPD_CHANNEL            11</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef DEVICE_ID</span>
<span class="cp">#define DEVICE_ID              0x02</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef GPD_APP_ID</span>
<span class="cp">#define GPD_APP_ID             GPD_APP_TYPE_SRC_ID</span>
<span class="cp">#endif</span>

<span class="cp">#if ( GPD_APP_ID == GPD_APP_TYPE_SRC_ID )</span>
<span class="cp">#define GPD_ID                 0x11223344</span>
<span class="cp">#elif ( GPD_APP_ID == GPD_APP_TYPE_IEEE_ID )</span>
<span class="cp">#define GPD_ID                 ApiMac_extAddr</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef GP_SECURITY_LEVEL</span>
<span class="cp">#define GP_SECURITY_LEVEL      GP_SECURITY_LVL_NO_SEC</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef EXT_OPT_KEY_TYPE</span>
<span class="cp">#define EXT_OPT_KEY_TYPE       KEY_TYPE_OUT_BOX_GPD_KEY</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef GP_SECURITY_KEY</span>
<span class="cp">#define GP_SECURITY_KEY        {0xCF,0xCE,0xCD,0xCC,0xCB,0xCA,0xC9,0xC8,0xC7,0xC6,0xC5,0xC4,0xC3,0xC2,0xC1,0xC0}</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef GPDF_FRAME_DUPLICATES</span>
<span class="cp">#define GPDF_FRAME_DUPLICATES  3</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef AUTO_COMMISSIONING</span>
<span class="cp">#define AUTO_COMMISSIONING     TRUE</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef RX_AFTER_TX</span>
<span class="cp">#define RX_AFTER_TX            FALSE</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef SEQUENCE_NUMBER_CAP</span>
<span class="cp">#define SEQUENCE_NUMBER_CAP    FALSE</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Furthermore, it is possible to define <code class="code docutils literal notranslate"><span class="pre">BATTERYLESS_DEVICE</span></code> from the
<em>Project Properties</em> → <em>Build</em> → <em>ARM Compiler</em> → <em>Predefined Symbols</em>
to operate in batteryless mode (if supported). For example, when <code class="code docutils literal notranslate"><span class="pre">gpd_sw</span></code> is operating
in batteryless mode, it will immediately send an on, off, or toggle command on power up
(based on the combination of keys pressed).</p>
</div>
<div class="section" id="non-volatile-memory">
<span id="sec-gpd-non-volatile-memory"></span><h3>Non Volatile Memory<a class="headerlink" href="#non-volatile-memory" title="Permalink to this headline">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">gpd_memory.c</span></code> provides an interface for Non Volatile (NV) memory required for
attribute persistence in some GPD configurations. For example the persistence
of sequence number when <code class="docutils literal notranslate"><span class="pre">SEQUENCE_NUMBER_CAP</span></code> is required. Use <code class="code docutils literal notranslate"><span class="pre">gp_nv_item_init()</span></code>
to create a new NV item, then <code class="code docutils literal notranslate"><span class="pre">gp_nv_read()</span></code> to get the NV value and
<code class="code docutils literal notranslate"><span class="pre">gp_nv_write()</span></code> to update the NV value when necessary.</p>
</div>
<div class="section" id="callbacks">
<span id="sec-gpd-callbacks"></span><h3>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h3>
<p>The application code also likely includes various callbacks from the protocol
stack layer and <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> modules. To ensure thread safety, processing should be
minimized in the actual callback, and the bulk of the processing should be done
in the application context.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">uint16</span><span class="w"> </span><span class="nf">gpdSampleSw_process_loop</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Forever loop */</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_KEY_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Process Key Presses</span>
<span class="w">            </span><span class="n">gpdSampleSw_processKey</span><span class="p">(</span><span class="n">keys</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">events</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_KEY_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">ApiMac_processIncoming</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="send-green-power-data-frames">
<span id="sec-send-green-power-data-frames"></span><h3>Send Green Power Data Frames<a class="headerlink" href="#send-green-power-data-frames" title="Permalink to this headline">¶</a></h3>
<p>An API to send Green Power Data Frames (GPDF) is provided in <code class="code docutils literal notranslate"><span class="pre">gpd.c</span></code>. The generic
function <code class="code docutils literal notranslate"><span class="pre">GreenPowerDataFrameSend()</span></code> sends a frame formated for the Green
Power Device configuration automatically by providing a <code class="code docutils literal notranslate"><span class="pre">gpdfReq_t</span></code> struct,
the desired channel and a flag to enable frame security.</p>
<p>Additionally <code class="code docutils literal notranslate"><span class="pre">GreenPowerCommissioningSend()</span></code> and <code class="code docutils literal notranslate"><span class="pre">GreenPowerAttributeReportingSend()</span></code>
functions use <code class="code docutils literal notranslate"><span class="pre">GreenPowerDataFrameSend()</span></code> to generate the corresponding commands.</p>
</div>
</div>
<div class="section" id="setting-up-the-network-with-gpd-and-gps">
<h2>Setting Up the Network with GPD and GPS<a class="headerlink" href="#setting-up-the-network-with-gpd-and-gps" title="Permalink to this headline">¶</a></h2>
<p>To set up a network with a Green Power Device (GPD) and a Green Power Sink (GPS), you will need 2-3 devices:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Green Power Device (<code class="code docutils literal notranslate"><span class="pre">gpd_switch</span></code> or <code class="code docutils literal notranslate"><span class="pre">gpd_temperaturesensor</span></code>)</p></li>
<li><p>Green Power Sink (<code class="code docutils literal notranslate"><span class="pre">zc/zr_light_sink</span></code> or <code class="code docutils literal notranslate"><span class="pre">zc/zr_thermostat_sink</span></code>)</p></li>
<li><p>Optional: Green Power Proxy (any other Zigbee 3.0 routing device, e.g. <code class="code docutils literal notranslate"><span class="pre">zc/zr_genericapp</span></code>)</p></li>
</ol>
</div></blockquote>
<div class="section" id="select-network-channel">
<h3>Select Network Channel<a class="headerlink" href="#select-network-channel" title="Permalink to this headline">¶</a></h3>
<p>First, determine which channel you would like to use for your test.
On the Green Power Sink (and Green Power Proxy, if applicable), configure the channel mask accordingly (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-configuring-channel"><span class="std std-ref">Configuring Channel</span></a>).
Select the same channel for the Green Power Device (see <a class="reference internal" href="../sysconfig/zigbee.html#sysconfig-zigbee-radio-configuration"><span class="std std-ref">Radio Configuration</span></a>).</p>
</div>
<div class="section" id="create-and-open-the-network-on-the-gps">
<h3>Create and Open the Network on the GPS<a class="headerlink" href="#create-and-open-the-network-on-the-gps" title="Permalink to this headline">¶</a></h3>
<p>Next, create a network with your coordinator. For example, use <code class="code docutils literal notranslate"><span class="pre">zc_light_sink</span></code> to create a network, following the
instructions in the <strong>Commissioning the Device Into the Network</strong> section of this readme:</p>
<ul class="simple">
<li><p><a class="reference external" href="../../../../examples/rtos/CC26X2R1_LAUNCHXL/zstack/zc_light_sink/README.html">Light Sink Coordinator Readme</a></p></li>
</ul>
</div>
<div class="section" id="join-the-gpp-device">
<h3>Join the GPP Device<a class="headerlink" href="#join-the-gpp-device" title="Permalink to this headline">¶</a></h3>
<p>If you would prefer a Green Power Proxy (GPP) to route GP Data Frames, it must be joined to the network formed by the coordinator.
For example, we can use <code class="code docutils literal notranslate"><span class="pre">zr_genericapp</span></code> as a GPP by simply joining it into the network,
following the instructions <strong>Example Usage</strong> section of this readme:</p>
<ul>
<li><p><a class="reference external" href="../../../../examples/rtos/CC26X2R1_LAUNCHXL/zstack/zr_genericapp/README.html">Generic App Router Readme</a></p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is entirely optional as the GPD can be directly commissioned to the GPS coordinator</p>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="enable-commissioning-on-the-gps">
<h3>Enable Commissioning on the GPS<a class="headerlink" href="#enable-commissioning-on-the-gps" title="Permalink to this headline">¶</a></h3>
<p>Next, enable GPS Commissioning on the <code class="code docutils literal notranslate"><span class="pre">zc_light_sink</span></code> by following the instructions in the <strong>Interfacing with the GP On/Off Switch Example App</strong>
section of this readme:</p>
<ul class="simple">
<li><p><a class="reference external" href="../../../../examples/rtos/CC26X2R1_LAUNCHXL/zstack/zc_light_sink/README.html">Light Sink Coordinator Readme</a></p></li>
</ul>
</div>
<div class="section" id="commission-the-gpd-into-the-network">
<h3>Commission the GPD into the Network<a class="headerlink" href="#commission-the-gpd-into-the-network" title="Permalink to this headline">¶</a></h3>
<p>Lastly, commission a GPD like the <code class="code docutils literal notranslate"><span class="pre">gpd_switch</span></code> into the network by following the instructions in the <strong>Interfacing with the Light Sink Example App</strong>
section of this readme:</p>
<ul class="simple">
<li><p><a class="reference external" href="../../../../examples/rtos/CC26X2R1_LAUNCHXL/zstack/gpd_switch/README.html">Green Power Switch Readme</a></p></li>
</ul>
</div>
<div class="section" id="example-ubiqua-capture-of-green-power-traffic">
<h3>Example Ubiqua Capture of Green Power Traffic<a class="headerlink" href="#example-ubiqua-capture-of-green-power-traffic" title="Permalink to this headline">¶</a></h3>
<p>Here is an annotated Ubiqua capture of the expected behavior following the instructions above:</p>
<div class="figure align-center">
<img alt="../_images/green-power-network-example.png" src="../_images/green-power-network-example.png" />
</div>
</div>
</div>
<div class="section" id="adding-green-power-proxy-capabilities-to-routing-sample-applications">
<h2>Adding Green Power Proxy Capabilities to Routing Sample Applications<a class="headerlink" href="#adding-green-power-proxy-capabilities-to-routing-sample-applications" title="Permalink to this headline">¶</a></h2>
<p>As required for Zigbee 3.0, routing device sample applications must implement the proxy functionality (Green Power Proxy Basic, or GPPB).
Although this functionality is enabled by default, for testing purposes it may be disabled by defining DISABLE_GREENPOWER_BASIC_PROXY.</p>
<p>This section will detail the necessary application code that is required for the GPPB.
Note that necessary code to implement the GPPB is included in all routing sample applications (those prepended with <code class="code docutils literal notranslate"><span class="pre">zc_</span></code> or <code class="code docutils literal notranslate"><span class="pre">zr_</span></code>).</p>
<ol class="arabic simple">
<li><p>Include the <code class="code docutils literal notranslate"><span class="pre">gp_common</span></code> header file, like in <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.c</span></code>:</p></li>
</ol>
<p><code class="code docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;gp_common.h&quot;</span></code></p>
<ol class="arabic simple" start="2">
<li><p>Add the three events for Green Power application events. Choose event bitmasks that aren’t already used for other events. Look at <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.h</span></code> for reference.</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Green Power Events</span>
<span class="cp">#define SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT              0x0200</span>
<span class="cp">#define SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT       0x0400</span>
<span class="cp">#define SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT            0x0800</span>
</pre></div>
</div>
<p>3. In the ZCL initialization function initialize the Green Power EndPoint and Green Power application events, like in
<code class="code docutils literal notranslate"><span class="pre">zclSampleLight_Init()</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gp_endpointInit</span><span class="p">(</span><span class="n">appServiceTaskId</span><span class="p">);</span><span class="w"></span>
<span class="n">app_Green_Power_Init</span><span class="p">(</span><span class="n">appServiceTaskId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appServiceTaskEvents</span><span class="p">,</span><span class="w"> </span><span class="n">appSemHandle</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>4. Add the handlers for application events in the application process loop, like in <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_process_loop()</span></code>.
All the required processing that the spec mandates is done by these handlers; any other processing specific to the application
implementation is out of the specification scope.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_process_loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Forever loop</span>
<span class="w">  </span><span class="k">for</span><span class="p">(;;)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">zstackmsg_genericReq_t</span><span class="w"> </span><span class="o">*</span><span class="n">pMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Wait for response message</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Semaphore_pend</span><span class="p">(</span><span class="n">appSemHandle</span><span class="p">,</span><span class="w"> </span><span class="n">BIOS_WAIT_FOREVER</span><span class="w"> </span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">zgGP_ProxyCommissioningMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TRUE</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">zcl_gpSendCommissioningNotification</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">zcl_gpSendNotification</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">gp_expireDuplicateFiltering</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">gp_returnOperationalChannel</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
</pre></div>
</div>
<p>5. Add the handlers to process messages from the stack, like in <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_processZStackMsgs()</span></code>. All the required
processing that the spec mandates is done by this handlers, any other processing specific to the application implementation
is out of the specification scope.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_processZStackMsgs</span><span class="p">(</span><span class="n">zstackmsg_genericReq_t</span><span class="w"> </span><span class="o">*</span><span class="n">pMsg</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">event</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_GP_DATA_IND</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">zstackmsg_gpDataInd_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInd</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">pInd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">zstackmsg_gpDataInd_t</span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">gp_processDataIndMsg</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">Req</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_GP_SECURITY_REQ</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">zstackmsg_gpSecReq_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInd</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">pInd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">zstackmsg_gpSecReq_t</span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">gp_processSecRecMsg</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">Req</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_GP_CHECK_ANNCE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">zstackmsg_gpCheckAnnounce_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInd</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">pInd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">zstackmsg_gpCheckAnnounce_t</span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">gp_processCheckAnnceMsg</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">Req</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="adding-green-power-sink-capabilities-to-routing-sample-applications">
<h2>Adding Green Power Sink Capabilities to Routing Sample Applications<a class="headerlink" href="#adding-green-power-sink-capabilities-to-routing-sample-applications" title="Permalink to this headline">¶</a></h2>
<p>This section provides guidance on how to add sink functionality to a coordinator or router sample application, using <code class="code docutils literal notranslate"><span class="pre">zc/zr_light</span></code> as an example.</p>
<div class="section" id="basic-steps">
<h3>Basic Steps<a class="headerlink" href="#basic-steps" title="Permalink to this headline">¶</a></h3>
<p>In the <a class="reference external" href="http://www.ti.com/tool/simplelink-cc13xx-cc26xx-sdk">SimpleLink CC13xx/CC26xx SDK</a>, sink examples are provided for the corresponding GPD examples.
For example, there are <code class="code docutils literal notranslate"><span class="pre">zc/zr_light_sink</span></code> and <code class="code docutils literal notranslate"><span class="pre">zc/zr_thermostat_sink</span></code>, which respectively correspond to <code class="code docutils literal notranslate"><span class="pre">gpd_switch</span></code> and <code class="code docutils literal notranslate"><span class="pre">gpd_temperaturesensor</span></code>.
Default application functionality is provided for the sinks to act upon the GPDFs sent by commissioned GPDs.
For this reason, it is a simple task to enable the default sink functionality on <code class="code docutils literal notranslate"><span class="pre">zc/zr_light</span></code> and <code class="code docutils literal notranslate"><span class="pre">zc/zr_thermostat</span></code>:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Add these files to <code class="code docutils literal notranslate"><span class="pre">&lt;project&gt;/Common/gp</span></code>:</dt><dd><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">gp_bit_fields.c/h</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">gp_sink_table.c</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">gp_sink.c/h</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Add this to predefined symbols:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><code class="code docutils literal notranslate"><span class="pre">ENABLE_GREENPOWER_COMBO_BASIC</span></code></dt><dd><ul>
<li><p>To access predefined symbols in CCS: (right-click project-&gt;*Project Properties*-&gt;*Build*-&gt;*ARM Compiler*-&gt;*Predefined Symbols*)</p></li>
<li><p>To access predifned symbols in IAR: (right-click project-&gt;*Options*-&gt;*C/C++ Compiler*-&gt;*Preprocessor*-&gt;*Defined symbols*)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="detailed-steps-of-adding-sink-functionality">
<h3>Detailed Steps of Adding Sink Functionality<a class="headerlink" href="#detailed-steps-of-adding-sink-functionality" title="Permalink to this headline">¶</a></h3>
<p>Here are detailed instructions on adding sink functionality. This will serve as a guide on how other sample applications may also be modified to support their respective GPD.
The <cite>zc/zr_light</cite> sample application will be used for this purpose.</p>
<ol class="arabic simple">
<li><p>Define <code class="code docutils literal notranslate"><span class="pre">ENABLE_GREENPOWER_COMBO_BASIC</span></code> compilation flag on the project options to enable the sink related functionality.</p></li>
</ol>
<p>2. Declare the sink application callbacks struct (<code class="code docutils literal notranslate"><span class="pre">GpSink_AppCallbacks_t</span></code>) like in <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.c</span></code>.
The pointers defined in this structure are the callbacks that will process the Green Power application commands
sent by the Green Power Devices. This example only defines pointers for a Sample Light application; every thing else is declared
as null. Adjust this structure according to the specific application requirements.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GpSink_AppCallbacks_t</span><span class="w"> </span><span class="n">zclSampleLight_GpSink_AppCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="cp">#ifdef ZCL_IDENTIFY</span>
<span class="w">    </span><span class="n">zclSampleLight_GPSink_Identify</span><span class="p">,</span><span class="w">     </span><span class="c1">//IdentifyCmd;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef ZCL_SCENES</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//RecallSceneCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StoreSceneCmd;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef ZCL_ON_OFF</span>
<span class="w">    </span><span class="n">zclSampleLight_GPSink_Off</span><span class="p">,</span><span class="w">          </span><span class="c1">//OffCmd;</span>
<span class="w">    </span><span class="n">zclSampleLight_GPSink_On</span><span class="p">,</span><span class="w">           </span><span class="c1">//OnCmd;</span>
<span class="w">    </span><span class="n">zclSampleLight_GPSink_Toggle</span><span class="p">,</span><span class="w">       </span><span class="c1">//ToggleCmd;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef ZCL_LEVEL_CTRL</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//LevelControlStopCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveUpWithOnOffCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveDownWithOnOffCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepUpWithOnOffCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepDownWithOnOffCmd;</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveHueStopCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveHueUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveHueDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepHueUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepHueDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveSaturationStopCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveSaturationUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveSaturationDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepSaturationUpCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepSaturationDownCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MoveColorCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//StepColorCmd;</span>
<span class="cp">#ifdef ZCL_DOORLOCK</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//LockDoorCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//UnlockDoorCmd;</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//AttributeReportingCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MfrSpecificReportingCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MultiClusterReportingCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//MfrSpecificMultiReportingCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//RequestAttributesCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//ReadAttributeRspCmd;</span>
<span class="w">    </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                               </span><span class="c1">//zclTunnelingCmd;</span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Register the sink application callbacks using <code class="code docutils literal notranslate"><span class="pre">zclGp_RegisterCBForGPDCommand(&amp;zclSampleLight_GpSink_AppCallbacks);</span></code>, as in <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_Init()</span></code>.</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_Init</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// ...</span>

<span class="cp">#if defined (ENABLE_GREENPOWER_COMBO_BASIC)</span>
<span class="w">    </span><span class="n">zclGp_RegisterCBForGPDCommand</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zclSampleLight_GpSink_AppCallbacks</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="c1">// ...</span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Declare all the functions required as application callbacks by the sink. Look at <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.c</span></code> for reference.</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*********************************************************************</span>
<span class="cm"> * @fn      zclSampleLight_GPSink_Identify</span>
<span class="cm"> *</span>
<span class="cm"> * @brief   Callback to process Identify command from a GPD</span>
<span class="cm"> *</span>
<span class="cm"> * @param   zclGpNotification</span>
<span class="cm"> *</span>
<span class="cm"> * @return  none</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_GPSink_Identify</span><span class="p">(</span><span class="n">zclGpNotification_t</span><span class="w"> </span><span class="o">*</span><span class="n">zclGpNotification</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">afAddrType_t</span><span class="w">  </span><span class="n">dstAddr</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">dstAddr</span><span class="p">.</span><span class="n">endPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SAMPLELIGHT_ENDPOINT</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">dstAddr</span><span class="p">.</span><span class="n">panId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">dstAddr</span><span class="p">.</span><span class="n">addrMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">afAddr16Bit</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">dstAddr</span><span class="p">.</span><span class="n">addr</span><span class="p">.</span><span class="n">shortAddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_NIB</span><span class="p">.</span><span class="n">nwkDevAddress</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">//Identify is a payloadless command which triggers a 60 seconds identify in</span>
<span class="w">  </span><span class="c1">/// the device (doc 14-0563-16 GP spec Table 49)</span>
<span class="w">  </span><span class="n">zclGeneral_SendIdentify</span><span class="p">(</span><span class="n">SAMPLELIGHT_ENDPOINT</span><span class="p">,</span><span class="o">&amp;</span><span class="n">dstAddr</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/*********************************************************************</span>
<span class="cm"> * @fn      zclSampleLight_GPSink_Off</span>
<span class="cm"> *</span>
<span class="cm"> * @brief   Callback to process Off command from a GPD</span>
<span class="cm"> *</span>
<span class="cm"> * @param   zclGpNotification</span>
<span class="cm"> *</span>
<span class="cm"> * @return  none</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_GPSink_Off</span><span class="p">(</span><span class="n">zclGpNotification_t</span><span class="w"> </span><span class="o">*</span><span class="n">zclGpNotification</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">zclSampleLight_OnOffCB</span><span class="p">(</span><span class="n">COMMAND_ON_OFF_OFF</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/*********************************************************************</span>
<span class="cm"> * @fn      zclSampleLight_GPSink_On</span>
<span class="cm"> *</span>
<span class="cm"> * @brief   Callback to process On command from a GPD</span>
<span class="cm"> *</span>
<span class="cm"> * @param   zclGpNotification</span>
<span class="cm"> *</span>
<span class="cm"> * @return  none</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_GPSink_On</span><span class="p">(</span><span class="n">zclGpNotification_t</span><span class="w"> </span><span class="o">*</span><span class="n">zclGpNotification</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">zclSampleLight_OnOffCB</span><span class="p">(</span><span class="n">COMMAND_ON_OFF_ON</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/*********************************************************************</span>
<span class="cm"> * @fn      zclSampleLight_GPSink_Toggle</span>
<span class="cm"> *</span>
<span class="cm"> * @brief   Callback to process Toggle command from a GPD</span>
<span class="cm"> *</span>
<span class="cm"> * @param   zclGpNotification</span>
<span class="cm"> *</span>
<span class="cm"> * @return  none</span>
<span class="cm"> */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_GPSink_Toggle</span><span class="p">(</span><span class="n">zclGpNotification_t</span><span class="w"> </span><span class="o">*</span><span class="n">zclGpNotification</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">zclSampleLight_OnOffCB</span><span class="p">(</span><span class="n">COMMAND_ON_OFF_TOGGLE</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="application_overview.html" class="btn btn-neutral float-left" title="Application Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="z-stack-overview.html" class="btn btn-neutral float-right" title="Z-Stack Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>