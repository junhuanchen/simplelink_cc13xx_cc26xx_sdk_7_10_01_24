<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Application Overview &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User&#39;s Guide
 7.10.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Green Power Application Overview" href="gpd_application_overview.html" />
    <link rel="prev" title="Developing Zigbee Applications" href="developing_zigbee_applications.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug zigbee application_overview";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide

          </a>
              <div class="version">
                7.10.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/tirtos-index.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">SimpleLink CC13xx/CC26xx SDK Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_zigbee_applications.html">Developing Zigbee Applications</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Application Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#application-architecture">Application Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-preprocessor-configuration">Application Preprocessor Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-up-in-main">Start-Up in main()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-initialization-function">Application Initialization Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-processing-in-the-task-function">Event Processing in the Task Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events-signaled-through-the-internal-event-variable">Events Signaled Through the Internal Event Variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callbacks">Callbacks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#osalport-framework">OSALPort Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#osalport-protocol-stack-service">OSALPort Protocol Stack Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-service">OSALPort Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messaging-and-thread-synchronization">Messaging and Thread Synchronization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#heap-allocation-and-management">Heap Allocation and Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-initialization-and-registration">OSALPort Initialization and Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osalport-thread-synchronization">OSALPort Thread Synchronization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-osalport-usage">Example OSALPort Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-application-builder-functionality">Customizing Application Builder Functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-user-interface">Common User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#welcome-and-help-screens">Welcome and &lt;Help&gt; Screens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#information-screen">Information Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-menu">&lt;Configure&gt; Menu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-instl-code-menu">&lt;Add Instl Code&gt; Menu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-instl-code-screen">&lt;Set Instl Code&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-i-c-addr-screen">&lt;Set I.C. Addr&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-install-code-screen">Apply Install Code Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#channel-mask-screens">Channel Mask Screens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pan-id-screen">&lt;PAN ID&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#base-device-behavior-commissioning-mode-screens">Base Device Behavior Commissioning Mode Screens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commissioning-screen">&lt;Commissioning&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset-to-fn-screen">&lt;Reset to FN&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#back-screen">&lt;Back&gt; Screen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-menu">&lt;App&gt; Menu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#buttons-and-leds">Buttons and LEDs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpd_application_overview.html">Green Power Application Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="z-stack-overview.html">Z-Stack Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash_memory-cc13xx_cc26xx.html">Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_map.html">Memory Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_applications.html">Running the Example Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_configuration.html">Network Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_configuration.html">Power Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="znp_interface.html">Zigbee Network Processor (ZNP) Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="mt_interface.html">MT Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="product_certification.html">Product Certification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc13xx_cc26xx/fcc-certification.html">FCC Certification Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/zigbee-ota-index.html">Zigbee Over-The-Air Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence-ieee.html">Wi-Fi Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="packet_sniffer.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/references-cc13xx_cc26xx.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zigbee-guide/glossary.html">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../zigbee-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
Z-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../zigbee-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="developing_zigbee_applications.html">Developing Zigbee Applications</a> &raquo;</li>
      <li>Application Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="application-overview">
<h1>Application Overview<a class="headerlink" href="#application-overview" title="Permalink to this headline">¶</a></h1>
<p>Z-Stack example applications are designed to enable faster end-product development by
providing different implementations of Zigbee device definitions while conforming to
ZCL v7 Specifications requirements for certification.  This allows the
developers to explore the usage of the stack for configuring and running a device in
a network along with other essential features, such as nonvolatile (NV) memory storage
to save the network parameters and application specific information. The configuration
and usage of peripherals such as UART, switches, and LEDs are also shown by these
sample applications. This chapter explains the application’s implementation to help
developers quickly modify the Z-Stack out-of-box example applications for customized
development. The following sections detail the example applications of the Z-Stack projects.</p>
<ul class="simple">
<li><p>Pre-<a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> initialization</p></li>
<li><p>Application architecture: the Application task which is the lowest priority
task in the system. The code for this task resides in the <code class="docutils literal notranslate"><span class="pre">Application</span></code> IDE folder.</p></li>
<li><p>OSALPort: an interface module between Z-Stack services (such as Z-Stack APIs) as well as
certain primitive services (such as thread synchronization) provided by the real-time
operating system (<a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>)</p></li>
</ul>
<div class="section" id="application-architecture">
<span id="sec-application-architecture"></span><h2>Application Architecture<a class="headerlink" href="#application-architecture" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#fig-example-application-block-diagram"><span class="std std-numref">Figure 21.</span></a> shows the block diagram of the
Light and Switch example applications on the CC13xx and CC26xx.</p>
<div class="figure align-center" id="id8">
<span id="fig-example-application-block-diagram"></span><img alt="../_images/fig-example-application-block-diagram.png" src="../_images/fig-example-application-block-diagram.png" />
<p class="caption"><span class="caption-number">Figure 21. </span><span class="caption-text">Example Application Block Diagram</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>High-level descriptions of various blocks in <a class="reference internal" href="#fig-example-application-block-diagram"><span class="std std-numref">Figure 21.</span></a>
are as follows:</p>
<p><strong>TI-RTOS7 Start-up Code:</strong> Initializes the application (see
<a class="reference internal" href="#sec-start-up-in-main"><span class="std std-ref">Start-Up in main()</span></a> for more
details).</p>
<p><strong>Example Application:</strong> The platform-independent implementation of the example
use case. The Z-Stack out-of-box demonstrates two use cases – Light and
Switch. Developers can modify this module’s out-of-box example code for custom
for custom application requirements to quickly develop end products.</p>
<p><strong>Utility Functions:</strong> Provides various platform utilities which the application
can use.  Examples include LED, timers, keys, UART and so on.</p>
<p><strong>Application-Specific Functions:</strong> Implements platform-specific functions such
as data storage over power cycles (nonvolatile) and provides user interface
functions, such as handling button presses or displaying essential information on
the UART.</p>
<p><strong>Z-Stack API Module (API Z-Stack Module):</strong> This module provides an interface
to the management and data services of the Zigbee stack through the OSALPort
Framework module.  This is further described in <a class="reference internal" href="#sec-osalport-framework"><span class="std std-ref">OSALPort Framework</span></a>.</p>
<div class="section" id="application-preprocessor-configuration">
<span id="sec-app-configuration"></span><h3>Application Preprocessor Configuration<a class="headerlink" href="#application-preprocessor-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following table contains the preprocessor symbols which can be added or
removed pertaining to device operation.  They are located in the Project Properties
as further discussed in the <em>Useful CCS IDE Settings</em> section of the <a class="reference external" href="../../../zigbee/zstack-quick-start-guide.html">Z-Stack Quick Start Guide</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 38%" />
<col style="width: 13%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Symbol</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Modifiable?</strong></p></th>
<th class="head"><p><strong>Applicable projects</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDB_FINDING_BINDING_CAPABILITY_ENABLED</p></td>
<td><p>Set to zero to disable BDB F&amp;B</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>BDB_REPORTING</p></td>
<td><p>Allows automatic cluster attibute reporting</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>BOARD_DISPLAY_USE_UART</p></td>
<td><p>Use UART communication for application
information</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>[LaunchPad variant]</p></td>
<td><p>LaunchPad variant, may be changed when migrating
to a custom development board</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>COMBO_MAC</p></td>
<td><p>MAC radio configuration</p></td>
<td><p>N</p></td>
<td><p>CC1352 devices</p></td>
</tr>
<tr class="row-odd"><td><p>CONFIG_PA_TYPE</p></td>
<td><p>Set to APIMAC_HIGH_PA for the internal power
amplifier, otherwise APIMAC_DEFAULT_PA</p></td>
<td><p>Y</p></td>
<td><p>CC1352P devices</p></td>
</tr>
<tr class="row-even"><td><p>CUI_DISABLE</p></td>
<td><p>Determines whether to disable the Common User
Interface</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>DISABLE_GREENPOWER_BASIC_PROXY</p></td>
<td><p>Disable GP proxy functionality</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>DeviceFamily_CC[13/26]X2</p></td>
<td><p>Select the chipset</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>DEVICE_FAMILY</p></td>
<td><p>Select the chipset</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ENABLE_GREENPOWER_COMBO_BASIC</p></td>
<td><p>Enable Green Power Sink functionality</p></td>
<td><p>N</p></td>
<td><p>Green power sink examples</p></td>
</tr>
<tr class="row-odd"><td><p>FACTORY_IMAGE</p></td>
<td><p>Creates factory image backup of current image</p></td>
<td><p>Y</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-even"><td><p>FEATURE_NON_BEACON_MODE</p></td>
<td><p>Standard beacon type per the Zigbee specification</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>FREQ_2_4G</p></td>
<td><p>Frequency to be used, only 2.4 GHz is supported</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>HEAPMGR_CONFIG</p></td>
<td><p>Type of heap configuration used</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>HEAPMGR_SIZE</p></td>
<td><p>Heap size if not automatically configured</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>MAX_DEVICE_TABLE_ENTRIES</p></td>
<td><p>Required as part of 15.4 stack</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>MAX_STATUS_LINES</p></td>
<td><p>Maximum lines supported by the CUI</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>MT_[FUNC]</p></td>
<td><p>Function enabled for the MT interface</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>NO_CC1312R1_SUPPORT</p></td>
<td><p>Board-specific key initialization</p></td>
<td><p>N</p></td>
<td><p>CC1352 devices</p></td>
</tr>
<tr class="row-even"><td><p>NPI</p></td>
<td><p>Include Network Processor Interface</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>NPI_FLOW_CTRL</p></td>
<td><p>Enables CTS/RTS for UART transportation</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>NPI_USE_UART</p></td>
<td><p>Use UART communication for ZNP processing</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>NVOCMP_NVPAGES</p></td>
<td><p>Number of flash pages allocated for NV memory</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>NV_INIT</p></td>
<td><p>Store network settings in non-volatile memory</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>NV_RESTORE</p></td>
<td><p>Restore previous network settings on start-up</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>NWK_MANAGER</p></td>
<td><p>Enables device to become the Network Manager</p></td>
<td><p>Y</p></td>
<td><p>zc/zr/znp builds</p></td>
</tr>
<tr class="row-odd"><td><p>OSAL_PORT2TIRTOS[_OSALMAP]</p></td>
<td><p>Use the OSAL Port to interface with the
management and data services of the Zigbee stack</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>OTA_APP_VERSION</p></td>
<td><p>Version of OTA application</p></td>
<td><p>Y</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-odd"><td><p>OTA_CLIENT_INTEGRATED</p></td>
<td><p>Device is an OTA client</p></td>
<td><p>N</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-even"><td><p>OTA_MANUFACTURER_ID</p></td>
<td><p>ID of manufacturer for OTA applications</p></td>
<td><p>Y</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-odd"><td><p>OTA_SERVER</p></td>
<td><p>Application is an OTA server for host interaction
Define as TRUE or FALSE</p></td>
<td><p>Y</p></td>
<td><p>[zc/zr]_ota_server</p></td>
</tr>
<tr class="row-even"><td><p>OTA_TYPE_ID</p></td>
<td><p>OTA device type</p></td>
<td><p>N</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-odd"><td><p>POWER_TEST_DATA_ACK</p></td>
<td><p>Enables data transmit power test mode</p></td>
<td><p>Y</p></td>
<td><p>light and sw examples</p></td>
</tr>
<tr class="row-even"><td><p>POWER_TEST_POLL_ACK</p></td>
<td><p>Enables data request power test mode</p></td>
<td><p>Y</p></td>
<td><p>light and sw examples</p></td>
</tr>
<tr class="row-odd"><td><p>POWER_TEST_POLL_DATA</p></td>
<td><p>Enables data receive power test mode</p></td>
<td><p>Y</p></td>
<td><p>light and sw examples</p></td>
</tr>
<tr class="row-even"><td><p>POWER_TEST_TX_PWR</p></td>
<td><p>Define a TX output level for power tests</p></td>
<td><p>Y</p></td>
<td><p>light and sw examples</p></td>
</tr>
<tr class="row-odd"><td><p>SECURITY</p></td>
<td><p>Enables OTA secure BIM</p></td>
<td><p>N</p></td>
<td><p>[zc/zed/zr]_sw_ota_client</p></td>
</tr>
<tr class="row-even"><td><p>TC_LINKKEY_JOIN</p></td>
<td><p>Check if a specific device has been authenticated</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>TIMAC_ROM_IMAGE_BUILD</p></td>
<td><p>Use the TIMAC image stored in ROM</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>TIMAC_ROM_PATCH</p></td>
<td><p>Apply TIMAC ROM patches</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>CUI_DISABLE</p></td>
<td><p>Disable the common user interface</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ZCL_[CLUSTER NAME]</p></td>
<td><p>Zigbee clusters allowed by the application</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>ZCL_[READ/WRITE/ETC]</p></td>
<td><p>Ability to process ZCL foundation incoming
command and response messages</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ZCL_REPORT_CONFIGURING_DEVICE</p></td>
<td><p>Device can can configure reporting parameters</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>ZCL_REPORT_DESTINATION_DEVICE</p></td>
<td><p>Device is a destination for ZCL reports</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ZCL_STANDALONE</p></td>
<td><p>Enables local ZCL function control</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>ZDO_API_BASIC</p></td>
<td><p>Basic ZDO functions enabled</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ZDO_API_ADVANCED</p></td>
<td><p>Advanced ZDO functions enabled</p></td>
<td><p>Y</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>ZNP_NPI</p></td>
<td><p>If the device is a Zigbee Network Processor</p></td>
<td><p>Y</p></td>
<td><p>znp</p></td>
</tr>
<tr class="row-even"><td><p>Z_POWER_TEST</p></td>
<td><p>Enables power test modes for an application</p></td>
<td><p>Y</p></td>
<td><p>light and sw examples</p></td>
</tr>
<tr class="row-odd"><td><p>ZSTACK_SECURITY</p></td>
<td><p>Initializes the AES ECB module</p></td>
<td><p>N</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>ZSTACK_GPD</p></td>
<td><p>Project for a Green Power device</p></td>
<td><p>N</p></td>
<td><p>gpd_[switch/temperature]</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several of the symbols referenced are used for specific sample
applications and do not apply to all projects included in Z-Stack.  ZCL
definitions are used to reduce project memory space and if enabled then
users are responsible for registering the associated endpoints and callbacks
inside of the Z-Stack application.  Failure to do so will cause issues
(ex. failed callbacks) which are not discovered during the project build.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to the preprocessor symbols section of the
<a class="reference external" href="../../../zigbee/zstack-quick-start-guide.html">Z-Stack Quick Start Guide</a> to setup compile options for the project if using IAR.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="start-up-in-main">
<span id="sec-start-up-in-main"></span><h3>Start-Up in main()<a class="headerlink" href="#start-up-in-main" title="Permalink to this headline">¶</a></h3>
<p>The <code class="code docutils literal notranslate"><span class="pre">main()</span></code> function inside of <code class="code docutils literal notranslate"><span class="pre">main.c</span></code> is the application starting
point at runtime. This is where the board is brought up with interrupts
disabled and board-related components are initialized.
Tasks in this function are configured by initializing the
necessary parameters, setting their priority, and initializing the stack size
for the application. The primary IEEE address (programmed by TI) is
obtained from the <a class="reference internal" href="../zigbee-guide/glossary.html#term-CCFG"><span class="xref std std-term">CCFG</span></a> area of the flash memory and NV drivers are
initialized.  In the final step, interrupts are enabled and the
<code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code> kernel scheduler is started by calling <code class="code docutils literal notranslate"><span class="pre">BIOS_start()</span></code>,
which does not return. See the <a class="reference external" href="http://www.ti.com/lit/pdf/swcu185">CC13x2 CC26x2 SimpleLink Wireless MCU Technical Reference Manual</a> for information on the start-up sequence
before <code class="code docutils literal notranslate"><span class="pre">main()</span></code> is reached.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="cp">#ifndef USE_DEFAULT_USER_CFG</span>
<span class="w">    </span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">macConfig</span><span class="p">.</span><span class="n">pAssertFP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assertHandler</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* enable iCache prefetching */</span><span class="w"></span>
<span class="w">    </span><span class="n">VIMSConfigure</span><span class="p">(</span><span class="n">VIMS_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span><span class="w"></span>

<span class="cp">#if defined(USE_CACHE_RAM)</span>
<span class="w">    </span><span class="cm">/* Disable cache */</span><span class="w"></span>
<span class="w">    </span><span class="n">VIMSModeSet</span><span class="p">(</span><span class="w"> </span><span class="n">VIMS_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">VIMS_MODE_DISABLED</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="cm">/* Enable cache */</span><span class="w"></span>
<span class="w">    </span><span class="n">VIMSModeSet</span><span class="p">(</span><span class="w"> </span><span class="n">VIMS_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">VIMS_MODE_ENABLED</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     Initialization for board related stuff such as LEDs</span>
<span class="cm">     following TI-RTOS convention</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="n">Board_initGeneral</span><span class="p">();</span><span class="w"></span>

<span class="c1">// OTA client projects use BIM, so CCFG isn&#39;t present in this image</span>
<span class="cp">#if !((defined OTA_CLIENT_STANDALONE) || (defined OTA_CLIENT_INTEGRATED))</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * Copy the extended address from the CCFG area</span>
<span class="cm">     * Assumption: the memory in CCFG_IEEE_MAC_0 and CCFG_IEEE_MAC_1</span>
<span class="cm">     * is contiguous and LSB first.</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Used to check for a valid extended address */</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">dummyExtAddr</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">OsalPort_memcpy</span><span class="p">(</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">extendedAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">__ccfg</span><span class="p">.</span><span class="n">CCFG_IEEE_MAC_0</span><span class="p">),</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Check to see if the CCFG IEEE is valid */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">extendedAddress</span><span class="p">,</span><span class="w"> </span><span class="n">dummyExtAddr</span><span class="p">,</span><span class="w"> </span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// (defined OTA_CLIENT_STANDALONE) || (defined OTA_CLIENT_INTEGRATED</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* No, it isn&#39;t valid.  Get the Primary IEEE Address */</span><span class="w"></span>
<span class="w">        </span><span class="n">OsalPort_memcpy</span><span class="p">(</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">extendedAddress</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">FCFG1_BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">EXTADDR_OFFSET</span><span class="p">),</span><span class="w"></span>
<span class="w">                       </span><span class="p">(</span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Setup the NV driver */</span><span class="w"></span>
<span class="w">    </span><span class="n">NVOCMP_loadApiPtrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifdef NVOCMP_MIN_VDD_FLASH_MV</span>
<span class="w">    </span><span class="n">NVOCMP_setLowVoltageCb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Main_lowVoltageCb</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">.</span><span class="n">initNV</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="cp">#ifdef ZSTACK_GPD</span>
<span class="w">    </span><span class="n">OsalPort_memcpy</span><span class="p">(</span><span class="n">ApiMac_extAddr</span><span class="p">,</span><span class="w"> </span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">extendedAddress</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">APIMAC_SADDR_EXT_LEN</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">_macTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macTaskInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">macConfig</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="cm">/* configure stack task */</span><span class="w"></span>
<span class="w">    </span><span class="n">stackTask_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstack_user0Cfg</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// ZSTACK_GPD</span>

<span class="cp">#ifdef NPI</span>
<span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">NPITask_createTask</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">NPITask_createTask</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">Semaphore_Params</span><span class="w"> </span><span class="n">semParam</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Semaphore_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">semParam</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ti_sysbios_knl_Semaphore_Mode_COUNTING</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Semaphore_construct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">npiInitializationMutex</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">npiInitializationMutexHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Semaphore_handle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">npiInitializationMutex</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="c1">// ZNP does not need an application task</span>
<span class="cp">#ifndef ZNP_NPI</span>

<span class="cp">#ifndef CUI_DISABLE</span>
<span class="w">    </span><span class="n">CUI_params_t</span><span class="w"> </span><span class="n">cuiParams</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">CUI_paramsInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cuiParams</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">CUI_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cuiParams</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="n">Task_Params</span><span class="w"> </span><span class="n">taskParams</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Configure app task. */</span><span class="w"></span>
<span class="w">    </span><span class="n">Task_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myTaskStack</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">stackSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_TASK_STACK_SIZE</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">taskParams</span><span class="p">.</span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Task_construct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myTask</span><span class="p">,</span><span class="w"> </span><span class="n">taskFxn</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="cp">#endif</span>

<span class="cp">#ifdef DEBUG_SW_TRACE</span>
<span class="w">    </span><span class="n">IOCPortConfigureSet</span><span class="p">(</span><span class="n">IOID_8</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_PORT_RFC_TRC</span><span class="p">,</span><span class="w"> </span><span class="n">IOC_STD_OUTPUT</span><span class="w"></span>
<span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">IOC_CURRENT_4MA</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IOC_SLEW_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif </span><span class="cm">/* DEBUG_SW_TRACE */</span><span class="cp"></span>

<span class="w">    </span><span class="n">BIOS_start</span><span class="p">();</span><span class="w"> </span><span class="cm">/* enable interrupts and start SYS/BIOS */</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// never executed</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In terms of the IDE workspace, <code class="docutils literal notranslate"><span class="pre">main.c</span></code> exists in the Application project –
meaning that when compiled it is placed in the allocated section of the application’s flash.</p>
</div>
<div class="section" id="application-initialization-function">
<span id="sec-application-init-function"></span><h3>Application Initialization Function<a class="headerlink" href="#application-initialization-function" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../tirtos/tasks.html#sec-rtos-overview-tasks"><span class="std std-ref">Tasks</span></a> describes how a task is constructed. After the
task is constructed
and the <code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code> kernel scheduler is started, the function that was passed
during task construction is run when the task is ready. Power-management
functions are initialized here, then the application task is initialized and started.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Void</span><span class="w"> </span><span class="nf">taskFxn</span><span class="p">(</span><span class="n">UArg</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">UArg</span><span class="w"> </span><span class="n">a1</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="cp">#if defined(USE_CACHE_RAM)</span>
<span class="w">    </span><span class="cm">/* Retain the Cache RAM */</span><span class="w"></span>
<span class="w">    </span><span class="n">Power_setConstraint</span><span class="p">(</span><span class="n">PowerCC26XX_SB_VIMS_CACHE_RETAIN</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#ifdef ZSTACK_GPD</span>

<span class="cp">#else</span>
<span class="w">    </span><span class="cm">/* get the service taskId of the Stack */</span><span class="w"></span>
<span class="w">    </span><span class="n">stackServiceTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stackTask_getStackServiceId</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* configure the message API the application will use to communicate with</span>
<span class="cm">       the stack */</span><span class="w"></span>
<span class="w">    </span><span class="n">Zstackapi_init</span><span class="p">(</span><span class="n">stackServiceTaskId</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Kick off application */</span><span class="w"></span>
<span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">sampleApp_task</span><span class="p">(</span><span class="n">NVINTF_nvFuncts_t</span><span class="w"> </span><span class="o">*</span><span class="n">pfnNV</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">sampleApp_task</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstack_user0Cfg</span><span class="p">.</span><span class="n">nvFps</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For application examples, <code class="code docutils literal notranslate"><span class="pre">main</span></code> calls <code class="code docutils literal notranslate"><span class="pre">taskfnx()</span></code>,
which later calls <code class="code docutils literal notranslate"><span class="pre">zclSampleApp_task</span></code> that serves as the entrance for
the application code to configure Z-Stack network parameters as well as
application specific peripherals configurations, callbacks, and stack
notifications. Some examples are:</p>
<ul class="simple">
<li><p>Timers initialization.</p></li>
<li><p>Button and LEDs.</p></li>
<li><p>Register the application endpoint, clusters, and attributes.</p></li>
<li><p>Register for callbacks to process general clusters commands.</p></li>
<li><p>Initialize network configuration parameters.</p></li>
<li><p>Register for ZDO callbacks.</p></li>
<li><p>Initialize the serial Common User Interface (CUI).</p></li>
</ul>
</div>
<div class="section" id="event-processing-in-the-task-function">
<span id="sec-event-processing-task-function"></span><h3>Event Processing in the Task Function<a class="headerlink" href="#event-processing-in-the-task-function" title="Permalink to this headline">¶</a></h3>
<p>After initializing the peripherals and configuring the application and
implementing the initialization function from the previous code snippet,
<code class="code docutils literal notranslate"><span class="pre">zclSampleApp_task()</span></code>, it enters an infinite loop so as to continuously
process as an independent task and not run to completion, seen
in <a class="reference internal" href="#fig-light-task-flow-chart"><span class="std std-numref">Figure 22.</span></a>.</p>
<div class="figure align-center" id="id9">
<span id="fig-light-task-flow-chart"></span><p class="plantuml">
<img src="../_images/plantuml-9d5e58c5a3ea07198fe930b58b793b47361124c1.png" alt="&#64;startuml
:zclSampleApp_task();
:zclSampleLight_initialization()]
:zclSampleLight_process_loop()]
    repeat
    while(Process Z-Stack messages)
    :Process Application peripheral events]
    :Process Application events]
    endwhile (No events to process)
    repeat while
:End;
&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 22. </span><span class="caption-text">Light Example Application Task Flow Chart</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p><a class="reference internal" href="#fig-light-task-flow-chart"><span class="std std-numref">Figure 22.</span></a> shows various reasons for posting to the
semaphore, causing the task to become active.</p>
</div>
<div class="section" id="events-signaled-through-the-internal-event-variable">
<span id="sec-events-signaled-through-internal-event-variable"></span><h3>Events Signaled Through the Internal Event Variable<a class="headerlink" href="#events-signaled-through-the-internal-event-variable" title="Permalink to this headline">¶</a></h3>
<p>The Application task uses an event variable bit mask to identify what action
caused the process to wake up and take appropriate action. Each bit of the
event variable corresponds to a defined event such as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Application Events</span>
<span class="cp">#define SAMPLELIGHT_POLL_CONTROL_TIMEOUT_EVT  0x0001</span>
<span class="cp">#define SAMPLELIGHT_LEVEL_CTRL_EVT            0x0002</span>
<span class="cp">#define SAMPLEAPP_END_DEVICE_REJOIN_EVT       0x0004</span>
<span class="cp">#define SAMPLEAPP_DISCOVERY_TIMEOUT_EVT       0x0008</span>
<span class="cp">#define SAMPLEAPP_PROV_CONNECT_EVT            0x0080</span>
<span class="cp">#define SAMPLEAPP_PROV_DISCONNECT_EVT         0x0010</span>
<span class="cp">#define SAMPLEAPP_POLICY_UPDATE_EVT           0x0020</span>
<span class="cp">#define SAMPLEAPP_SYNC_ATTR_EVT               0x0040</span>
</pre></div>
</div>
<p>Whichever function sets this bit in the event variable must also ensure to post
to the semaphore to wake up the application for processing. An example of this
is the clock handler for clock timeouts.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_processLevelControlTimeoutCallback</span><span class="p">(</span><span class="n">UArg</span><span class="w"> </span><span class="n">a0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">a0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Parameter is not used</span>

<span class="w">    </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">SAMPLELIGHT_LEVEL_CTRL_EVT</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Wake up the application thread when it waits for clock event</span>
<span class="w">    </span><span class="n">Semaphore_post</span><span class="p">(</span><span class="n">appSemHandle</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Which is later handled and the event bit is cleared as the event got processed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLELIGHT_LEVEL_CTRL_EVT</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">zclSampleLight_AdjustLightLevel</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLELIGHT_LEVEL_CTRL_EVT</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>When adding an event, it must be unique for the given task and be a power of 2
(so that only 1 bit is set). Because the event variable is initialized as
<code class="code docutils literal notranslate"><span class="pre">uint32_t</span></code>, this setup allows for a maximum of 32 internal events.
However, the sample projects pre-determine several application events
inside their header file (for example, <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.c</span></code>) along with
0x8000 being generally reserved for <code class="code docutils literal notranslate"><span class="pre">SYS_EVENT_MSG</span></code>. Therefore, only
customizable application events from 0x10000 and above should be utilized.</p>
</div>
<div class="section" id="callbacks">
<span id="sec-callbacks"></span><h3>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h3>
<p>The application code also likely includes various callbacks from the protocol
stack layer and <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> modules. To ensure thread safety, processing should be
minimized in the actual callback and the bulk of the processing should be done
in the application context. The following code snippet shows how the events
and callbacks from the stack are processed, the stack notifications are
redirected to <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_processZStackMsgs()</span></code>, and the application
events are directly processed here.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">zclSampleLight_process_loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Forever loop */</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">zstackmsg_genericReq_t</span><span class="w"> </span><span class="o">*</span><span class="n">pMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">msgProcessed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* Wait for response message */</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Semaphore_pend</span><span class="p">(</span><span class="n">appSemHandle</span><span class="p">,</span><span class="w"> </span><span class="n">BIOS_WAIT_FOREVER</span><span class="w"> </span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* Retrieve the response message */</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="n">pMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">zstackmsg_genericReq_t</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OsalPort_msgReceive</span><span class="p">(</span><span class="w"> </span><span class="n">appServiceTaskId</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>

<span class="w">                </span><span class="n">zclSampleLight_processZStackMsgs</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifdef PER_TEST</span>
<span class="w">                </span><span class="n">PERTest_processZStackMsg</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">                </span><span class="c1">// Free any separately allocated memory</span>
<span class="w">                </span><span class="n">msgProcessed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Zstackapi_freeIndMsg</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="n">msgProcessed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pMsg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">OsalPort_msgDeallocate</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="cp">#ifdef PER_TEST</span>
<span class="w">            </span><span class="n">PERTest_process</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#ifndef CUI_DISABLE</span>
<span class="w">            </span><span class="c1">//Process the events that the UI may have</span>
<span class="w">            </span><span class="n">zclsampleApp_ui_event_loop</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_DISCOVERY_TIMEOUT_EVT</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">discoveryInprogress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"></span>

<span class="w">              </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_DISCOVERY_TIMEOUT_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="cp">#if defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>
<span class="w">                        </span><span class="c1">// REMOVED DMM CODE</span>
<span class="cp">#endif </span><span class="c1">// defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>

<span class="cp">#ifdef ZCL_LEVEL_CTRL</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLELIGHT_LEVEL_CTRL_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">zclSampleLight_AdjustLightLevel</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLELIGHT_LEVEL_CTRL_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// ZCL_LEVEL_CTRL</span>

<span class="cp">#if !defined (DISABLE_GREENPOWER_BASIC_PROXY) &amp;&amp; (ZG_BUILD_RTR_TYPE)</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">zgGP_ProxyCommissioningMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TRUE</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="n">zcl_gpSendCommissioningNotification</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="n">zcl_gpSendNotification</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_DATA_SEND_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">gp_expireDuplicateFiltering</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_EXPIRE_DUPLICATE_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">gp_returnOperationalChannel</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_PROCESS_GP_TEMP_MASTER_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#if ZG_BUILD_ENDDEVICE_TYPE</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">SAMPLEAPP_END_DEVICE_REJOIN_EVT</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">zstack_bdbRecoverNwkRsp_t</span><span class="w"> </span><span class="n">zstack_bdbRecoverNwkRsp</span><span class="p">;</span><span class="w"></span>

<span class="w">          </span><span class="n">Zstackapi_bdbRecoverNwkReq</span><span class="p">(</span><span class="n">appServiceTaskId</span><span class="p">,</span><span class="o">&amp;</span><span class="n">zstack_bdbRecoverNwkRsp</span><span class="p">);</span><span class="w"></span>

<span class="w">              </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">SAMPLEAPP_END_DEVICE_REJOIN_EVT</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#if defined (Z_POWER_TEST)</span>
<span class="w">                        </span><span class="c1">// REMOVED POWER TEST CODE</span>
<span class="cp">#endif </span><span class="c1">// Z_POWER_TEST</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Stack notifications are meant to provide context to the application
to take some decisions and notify the stack, if required. An example of this
is the BDB Filter Networks Descriptors indication shown below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_BDB_FILTER_NWK_DESCRIPTOR_IND</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="cm">/*   User logic to remove networks that do not want to join</span>
<span class="cm">     *   Networks to be removed can be released with Zstackapi_bdbNwkDescFreeReq</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="n">Zstackapi_bdbFilterNwkDescComplete</span><span class="p">(</span><span class="n">appServiceTaskId</span><span class="p">);</span><span class="w"></span>

<span class="k">break</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>In this case the message contained in the notification carries the network descriptor
of the networks found during the commissioning process.  The application is in charge
of removing those networks that are not meant to be joined (if the application is
willing to join specific networks) by calling <code class="code docutils literal notranslate"><span class="pre">Zstackapi_bdbNwkDescFreeReq()</span></code>
to remove the network descriptor. After the filtering is done, the application must
indicate to the stack that it has to process the remaining network descriptors (even
if all the network descriptors has been removed) by calling
<code class="code docutils literal notranslate"><span class="pre">Zstackapi_bdbFilterNwkDescComplete()</span></code> so that the stack may continues with its process.</p>
<p>Other stack notifications can be handled by application logic to update the application
state, such as Base Device Behavior <a class="reference internal" href="../zigbee-guide/glossary.html#term-BDB"><span class="xref std std-term">BDB</span></a> notifications, which provides status of
the previous commissioning requests from the application.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_BDB_NOTIFICATION</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">zstackmsg_bdbNotificationInd_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInd</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">pInd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">zstackmsg_bdbNotificationInd_t</span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">zclSampleLight_ProcessCommissioningStatus</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">Req</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="k">break</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Asynchronous Z-Stack Callbacks must be registered by calling
<code class="code docutils literal notranslate"><span class="pre">Zstackapi_DevZDOCBReq()</span></code> with the correct fields set to true in a
<code class="code docutils literal notranslate"><span class="pre">zstack_devZDOCBReq_t</span></code>.  For example, if you would like to receive device state change
notifications then the following must be called from <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_Init</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetupZStackCallbacks</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">zstack_devZDOCBReq_t</span><span class="w"> </span><span class="n">zdoCBReq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Register for Callbacks, turn on:</span>
<span class="w">    </span><span class="c1">//  Device State Change,</span>
<span class="w">    </span><span class="c1">//  ZDO Match Descriptor Response,</span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">has_devStateChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">devStateChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">has_matchDescRsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">matchDescRsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">has_ieeeAddrRsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">ieeeAddrRsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="cp">#if defined Z_POWER_TEST</span>
<span class="cp">#if defined (POWER_TEST_POLL_DATA)</span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">has_deviceAnnounce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zdoCBReq</span><span class="p">.</span><span class="n">deviceAnnounce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#endif </span><span class="c1">// Z_POWER_TEST</span>

<span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">Zstackapi_DevZDOCBReq</span><span class="p">(</span><span class="n">appServiceTaskId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">zdoCBReq</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Afterwards it can be handled in a <code class="code docutils literal notranslate"><span class="pre">zclSampleLight_processZStackMsgs()</span></code> case statement.
More information is provided in the <a class="reference external" href="../../../zigbee/zstack-apis.html">Z-Stack API</a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nl">zstackmsg_CmdIDs_DEV_STATE_CHANGE_IND</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="cp">#if !defined(CUI_DISABLE) || defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>
<span class="w">            </span><span class="c1">// The ZStack Thread is indicating a State change</span>
<span class="w">            </span><span class="n">zstackmsg_devStateChangeInd_t</span><span class="w"> </span><span class="o">*</span><span class="n">pInd</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="n">zstackmsg_devStateChangeInd_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">pMsg</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// !defined(CUI_DISABLE) || defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>

<span class="cp">#ifndef CUI_DISABLE</span>
<span class="w">            </span><span class="n">UI_DeviceStateUpdated</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">req</span><span class="p">));</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#if defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>
<span class="w">            </span><span class="n">provState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pInd</span><span class="o">-&gt;</span><span class="n">req</span><span class="p">.</span><span class="n">state</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="n">appServiceTaskEvents</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">SAMPLEAPP_POLICY_UPDATE_EVT</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Wake up the application thread when it waits for clock event</span>
<span class="w">            </span><span class="n">Semaphore_post</span><span class="p">(</span><span class="n">appSemHandle</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// defined(USE_DMM) &amp;&amp; defined(BLE_START)</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="osalport-framework">
<span id="sec-osalport-framework"></span><h2>OSALPort Framework<a class="headerlink" href="#osalport-framework" title="Permalink to this headline">¶</a></h2>
<p>OSALPort is a module that provides a mechanism for the Application to
interface with Z-Stack services (such as Z-Stack APIs), as well as certain
primitive services (such as thread synchronization) provided by the real-time
operating system (<a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>). OSALPort allows both the Application and
protocol stack tasks to efficiently operate, communicate, and share resources in
a unified <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> environment.</p>
<div class="figure align-center" id="id10">
<span id="fig-osalport-block-diagram"></span><a class="reference internal image-reference" href="../_images/fig-osalport-block-diagram.png"><img alt="../_images/fig-osalport-block-diagram.png" src="../_images/fig-osalport-block-diagram.png" style="width: 586.4px; height: 520.0px;" /></a>
<p class="caption"><span class="caption-number">Figure 23. </span><span class="caption-text">OSALPort Application – Protocol Stack Abstraction</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="osalport-protocol-stack-service">
<span id="sec-osalport-zigbee-stack-service"></span><h3>OSALPort Protocol Stack Service<a class="headerlink" href="#osalport-protocol-stack-service" title="Permalink to this headline">¶</a></h3>
<p>As depicted in <a class="reference internal" href="#fig-osalport-block-diagram"><span class="std std-numref">Figure 23.</span></a>, the OSALPort core use case
involves messages between a server entity (the Z-Stack task) and a client
entity (the Application task). The reasoning for this architecture is twofold:
to enable independent updating of the application and Z-Stack, and to
maintain API consistency as the software is ported from legacy platforms (for
example OSAL for the CC253x) to the CC13xx or CC26xx TI-RTOS7. The OSALPort Z-Stack
service serves as the Application interface to all Z-Stack APIs.
Internally, when a Z-Stack protocol stack API is called by the
Application, the OSALPort module routes (dispatches) the command to the
Z-Stack, and where appropriate, routes messages from the Z-Stack to the Application.</p>
</div>
<div class="section" id="osalport-service">
<span id="sec-osalport-service"></span><h3>OSALPort Service<a class="headerlink" href="#osalport-service" title="Permalink to this headline">¶</a></h3>
<p>OSALPort includes a service that abstracts various operating
system-related functions. Due to shared resources, and to maintain interprocess
communication, the Application must use the following OSALPort
service functions.</p>
<ul class="simple">
<li><p>Messaging and Thread Synchronization</p></li>
<li><p>Heap Allocation and Management</p></li>
</ul>
</div>
<div class="section" id="messaging-and-thread-synchronization">
<span id="sec-messaging-and-thread-synchronization"></span><h3>Messaging and Thread Synchronization<a class="headerlink" href="#messaging-and-thread-synchronization" title="Permalink to this headline">¶</a></h3>
<p>The messaging and thread synchronization functions provided by the OSALPort
let users design an application to protocol stack interface in the multithreaded
<a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> environment. Within the OSALPort, messaging between two tasks is
achieved by sending a message block from one thread to the other using a message
queue. The sender allocates memory, writes the content of the message into the
memory block, and then sends (enqueues) the memory block to the recipient.
Notification of message delivery is accomplished using a signaling semaphore.
The receiver wakes up on the semaphore, copies the message memory block (or
blocks), processes the message, and returns (frees) the memory block to the heap.</p>
<p>The Stack uses the OSALPort for notifying and sending messages to the
Application. These service messages (such as state change notifications)
received by the Application task are delivered by the OSALPort and
processed in the task context of the Application.</p>
</div>
<div class="section" id="heap-allocation-and-management">
<span id="sec-heap-allocation-and-management"></span><h3>Heap Allocation and Management<a class="headerlink" href="#heap-allocation-and-management" title="Permalink to this headline">¶</a></h3>
<p>The OSALPort provides the Application with global heap APIs for dynamic
memory allocation. OSALPort uses
this heap for all protocol stack messaging as well as to obtain memory for other
OSALPort services. TI recommends that the Application uses these
OSALPort APIs for dynamic memory allocation within the Application.</p>
<p>The heap itself is automatically sized in <code class="code docutils literal notranslate"><span class="pre">.syscfg</span></code> and can be configured by
changing the <code class="code docutils literal notranslate"><span class="pre">BIOS.heapSize</span></code> variable. In order to monitor your heap usage,
add the <code class="code docutils literal notranslate"><span class="pre">HEAPMGR_METRICS</span></code> definition to the Z-Stack project.  Inside a debug
session it will then be possible to monitor several heap variables:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">heapmgrBlkMax</span><span class="w"></span>
<span class="n">heapmgrBlkCnt</span><span class="w"></span>
<span class="n">heapmgrBlkFree</span><span class="w"></span>
<span class="n">heapmgrMemAlo</span><span class="w"></span>
<span class="n">heapmgrMemMax</span><span class="w"></span>
<span class="n">heapmgrMemUB</span><span class="w"></span>
<span class="n">heapmgrMemFail</span><span class="w"></span>
<span class="n">heapmgrMemFreeTotal</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="osalport-initialization-and-registration">
<span id="sec-osalport-init-and-registration"></span><h3>OSALPort Initialization and Registration<a class="headerlink" href="#osalport-initialization-and-registration" title="Permalink to this headline">¶</a></h3>
<p>To instantiate and initialize the OSALPort service, the following functions
must be called by the application in <code class="docutils literal notranslate"><span class="pre">main()</span></code> before starting the <code class="docutils literal notranslate"><span class="pre">SYS/BIOS</span></code>
kernel scheduler.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* configure stack task */</span><span class="w"></span>
<span class="n">stackTask_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">zstack_user0Cfg</span><span class="p">);</span><span class="w"></span>

<span class="cm">/* get the service taskId of the Stack */</span><span class="w"></span>
<span class="n">stackServiceTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stackTask_getStackServiceId</span><span class="p">();</span><span class="w"></span>
<span class="cm">/* configure the message API the application will use to communicate with</span>
<span class="cm">   the stack */</span><span class="w"></span>
<span class="n">Zstackapi_init</span><span class="p">(</span><span class="n">stackServiceTaskId</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Calling <code class="code docutils literal notranslate"><span class="pre">stackTask_init()</span></code> initializes the OSALPort service
(for example, heap manager) and framework. Calling
<code class="code docutils literal notranslate"><span class="pre">Zstackapi_init()</span></code> creates, but does not start, the Z-Stack
protocol stack task.</p>
<p>Semaphores must be created to send and receive messages
through the OSALPort. This registration is done for the application in
<code class="code docutils literal notranslate"><span class="pre">zclSampleLight_initialization()</span></code>, which is called by the application’s initialization
functions. The following is the call to the OSALPort in <code class="docutils literal notranslate"><span class="pre">zclSampleLight_initialization()</span></code>
in <code class="code docutils literal notranslate"><span class="pre">zcl_samplelight.c</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* create semaphores for messages / events</span>
<span class="cm"> */</span><span class="w"></span>
<span class="n">Semaphore_Params</span><span class="w"> </span><span class="n">semParam</span><span class="p">;</span><span class="w"></span>
<span class="n">Semaphore_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="n">semParam</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ti_sysbios_knl_Semaphore_Mode_COUNTING</span><span class="p">;</span><span class="w"></span>
<span class="n">Semaphore_construct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appSem</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">semParam</span><span class="p">);</span><span class="w"></span>
<span class="n">appSemHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Semaphore_handle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">appSem</span><span class="p">);</span><span class="w"></span>

<span class="n">appServiceTaskId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OsalPort_registerTask</span><span class="p">(</span><span class="n">Task_self</span><span class="p">(),</span><span class="w"> </span><span class="n">appSemHandle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appServiceTaskEvents</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask</span></code> supplies the <code class="code docutils literal notranslate"><span class="pre">Task_self()</span></code>, <code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code>,
and <code class="code docutils literal notranslate"><span class="pre">appServiceTaskEvents</span></code>  inputs which then returns the <code class="code docutils literal notranslate"><span class="pre">appServiceTaskId</span></code>
subsequently used by the OSALPort to facilitate messages between the Application and server
tasks. The <code class="code docutils literal notranslate"><span class="pre">Task_self()</span></code> argument points to the task destination message queue,
<code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> represents the semaphore used for signaling, and
<code class="code docutils literal notranslate"><span class="pre">appServiceTaskEvents</span></code> points to the event flag. Each task registering with the OSALPort
has unique <code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> and <code class="code docutils literal notranslate"><span class="pre">appServiceTaskEvents</span></code> identifiers.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Z-Stack APIs defined in zstackapi.c, and other OSALPort services,
are not available for use before OSALPort registration.  OsalPort should not be used
in place of TI-RTOS7 drivers from inside the application code.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="osalport-thread-synchronization">
<span id="sec-osalport-thread-synchronization"></span><h3>OSALPort Thread Synchronization<a class="headerlink" href="#osalport-thread-synchronization" title="Permalink to this headline">¶</a></h3>
<p>The OSALPort module switches between Application and Stack threads through
the use of semaphore synchronization services provided by the
<a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a>.  To allow a client or a server thread to block until it receives a
message, OSALPort uses <code class="code docutils literal notranslate"><span class="pre">Semaphore_pend(appSemHandle,</span> <span class="pre">BIOS_WAIT_FOREVER</span> <span class="pre">)</span></code>.
This blocks until the semaphore associated with the caller <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread is posted.</p>
<p>Allowing an application or a server thread to block yields the
processor resource to other lower priority threads, or conserves energy by
shutting down power and clock domains whenever possible. The semaphore
associated with an <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread is signaled by either of the following
conditions.</p>
<ul class="simple">
<li><p>A new message is queued to the Application <a class="reference internal" href="../zigbee-guide/glossary.html#term-RTOS"><span class="xref std std-term">RTOS</span></a> thread queue.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> is called for the semaphore.</p></li>
</ul>
<p><code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> is provided so that an application or a server can add
its own event to unblock <code class="code docutils literal notranslate"><span class="pre">Semaphore_pend()</span></code> and synchronize the thread.
<code class="code docutils literal notranslate"><span class="pre">Semaphore_post()</span></code> accepts a semaphore handle
<code class="code docutils literal notranslate"><span class="pre">appSemHandle</span></code> as its sole argument. The semaphore handle
associated with the thread is registered through the <code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask()</span></code> call.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not necessary to use OSALPort APIs in place of TI-RTOS7 APIs for the
application semaphore</p>
</div>
</div></blockquote>
</div>
<div class="section" id="example-osalport-usage">
<span id="sec-example-osalport-usage"></span><h3>Example OSALPort Usage<a class="headerlink" href="#example-osalport-usage" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#fig-osalport-messaging-example"><span class="std std-numref">Figure 24.</span></a> shows an example command being sent from
the application to the Z-Stack through the OSALPort, with a corresponding
return value passed back to the application. <code class="code docutils literal notranslate"><span class="pre">stackTask_init()</span></code> initializes
the OSALPort module instance itself and <code class="code docutils literal notranslate"><span class="pre">Zstackapi_init()</span></code>
creates a task per external image, with an entry function at a known address.
After initializing the OSALPort, the Application task registers with the
OSALPort using <code class="code docutils literal notranslate"><span class="pre">OsalPort_registerTask</span></code>. After the SYS/BIOS
scheduler starts and the Application task runs, the application sends a protocol
command defined in <code class="code docutils literal notranslate"><span class="pre">zstackapi.c</span></code> such as <code class="code docutils literal notranslate"><span class="pre">Zstackapi_bdbSetAttributesReq()</span></code>.
The protocol command is not executed in the application thread. Instead the
command is encapsulated in an OSALPort message and routed to the Z-Stack
task through the OSALPort. In other words, this command is sent to the
OSALPort where it is then executed on the Z-Stack. The Application thread meanwhile
blocks (waits for) the corresponding command status message (status). When the Z-Stack
protocol stack finishes executing the command, the command status message response is
sent through the OSALPort back to the application thread.</p>
<div class="figure align-center" id="id11">
<span id="fig-osalport-messaging-example"></span><p class="plantuml">
<img src="../_images/plantuml-86bba697fcd53052c17ad6079f05528f5d00689b.png" alt="&#64;startuml
App-&gt;OSALPort: stackTask_init
App-&gt;OSALPort: Zstackapi_init
App-&gt;OSALPort: OsalPort_registerTask
App-&gt;OSALPort: Zstackapi_bdbSetAttributesReq()\nBDB_SET_REQ
OSALPort-&gt;&quot;Z-Stack&quot;: &quot;Semaphore_pend\n(Z-Stack Service)&quot;
note over App: App Task Blocks
note over &quot;Z-Stack&quot;: Stack Executes\nBDB_SET_REQ
&quot;Z-Stack&quot;-&gt;OSALPort: Semaphore_post(sendCmdStatus)
OSALPort-&gt;App: Semaphore_post(sendCmdStatus)
&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 24. </span><span class="caption-text">OSALPort Messaging Example</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="customizing-application-builder-functionality">
<span id="sec-custom-application-builder-functionality"></span><h2>Customizing Application Builder Functionality<a class="headerlink" href="#customizing-application-builder-functionality" title="Permalink to this headline">¶</a></h2>
<p>For <em>SampleApp</em> projects which use the <a class="reference internal" href="../sysconfig/zigbee.html#sysconfig-zigbee-application-builder"><span class="std std-ref">Application Builder</span></a>,
there are specific instructions necessary to modify and use the code produced by the
<code class="code docutils literal notranslate"><span class="pre">zcl_config.c</span></code> file for an application’s needs.  ZCL command callbacks generated
in <code class="code docutils literal notranslate"><span class="pre">zcl_config.c</span></code> can be implemented by copying the function declaration into
<code class="code docutils literal notranslate"><span class="pre">sampleapp.c</span></code> and removing the <code class="code docutils literal notranslate"><span class="pre">WEAK</span></code> tag, this will in effect direct
the compiler to use the callback function defined in this file.  Below is pseudocode
using <code class="code docutils literal notranslate"><span class="pre">sampleApp_IdentifyCB</span></code> as an example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Copy ZCL command callback, attribute variables, and default values</span>
<span class="c1">// to sampleapp.c after removing the WEAK tag used in zcl_config.c</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sampleApp_IdentifyCB</span><span class="p">(</span><span class="w"> </span><span class="n">zclIdentify_t</span><span class="w"> </span><span class="o">*</span><span class="n">pCmd</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">uint16</span><span class="w"> </span><span class="n">DEFAULT_IDENTIFY_IDENTIFY_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="p">;</span><span class="w"> </span><span class="c1">// Constant can now be redefined</span>
<span class="n">uint16</span><span class="w"> </span><span class="n">sampleApp_Identify_IdentifyTime</span><span class="p">;</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="c1">// Implementing the function further in sampleapp.c</span>
<span class="kt">void</span><span class="w"> </span><span class="n">sampleApp_IdentifyCB</span><span class="p">(</span><span class="w"> </span><span class="n">zclIdentify_t</span><span class="w"> </span><span class="o">*</span><span class="n">pCmd</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Perform action based on application needs</span>
<span class="w">    </span><span class="c1">// Variable sampleApp_Identify_IdentifyTime can now be used and modified</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Likewise, ZCL attribute variables and default values which are generated in
<code class="code docutils literal notranslate"><span class="pre">zcl_config.c</span></code> can be modified inside <code class="code docutils literal notranslate"><span class="pre">sampleapp.c</span></code> after copying over the
declarations and removing the <code class="code docutils literal notranslate"><span class="pre">WEAK</span></code> tag, as is shown through
<code class="code docutils literal notranslate"><span class="pre">sampleApp_Identify_IdentifyTime</span></code> and <code class="code docutils literal notranslate"><span class="pre">DEFAULT_IDENTIFY_IDENTIFY_TIME</span></code>
in the pseudocode above.  Be sure to only implement changes to application files (such
as <code class="code docutils literal notranslate"><span class="pre">sampleapp.c</span></code>) given that <code class="code docutils literal notranslate"><span class="pre">zcl_config.c/h</span></code> will be overwritten with each
project build.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Always be sure to Clean and Rebuild projects inside the IDE after making
these application changes to ensure that they properly take effect.</p>
</div>
</div>
<div class="section" id="common-user-interface">
<span id="sec-common-user-interface"></span><h2>Common User Interface<a class="headerlink" href="#common-user-interface" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to use <strong>PuTTY</strong> as the serial terminal program
for these sample applications because the serial output has been verified to be
formatted correctly in this program. For serial port setup, select <strong>115200</strong> for
baud rate and <strong>disable</strong> flow control.</p>
<p>The user interface allows to control the commissioning configuration as well as
application behavior. The commissioning interface is common for all
applications and is implemented in the module <code class="code docutils literal notranslate"><span class="pre">zcl_sampleapps_ui.c</span></code>.
The application specifics of the serial interface is implemented in its respective application files.</p>
<p>The user interface consists of a series of circular menus that are navigated with the arrow keys.
Pressing the <strong>Enter</strong> key will enter submenu.
Use the up and down arrow keys to change the parameters on the menu (eg. channel mask, PAN ID, install codes, etc.).</p>
<p>The common user interface is also dependent on the capabilities of the compiled
device, e.g. Trust Center devices (coordinators) will require the IEEE address
of the joining device when introducing Install Codes, whereas router or end
devices will only require the install code as the IEEE address is of itself.
<a class="reference internal" href="#common-menu-navigation-diagram"><span class="std std-numref">Figure 25.</span></a> shows the common menus for all sample applications.</p>
<div class="figure align-center" id="id12">
<span id="common-menu-navigation-diagram"></span><a class="reference internal image-reference" href="../_images/Common-menu-navigation-diagram.png"><img alt="../_images/Common-menu-navigation-diagram.png" src="../_images/Common-menu-navigation-diagram.png" style="width: 1096.1999999999998px; height: 247.1px;" /></a>
<p class="caption"><span class="caption-number">Figure 25. </span><span class="caption-text">Common Sample Application Diagram</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</div>
<p>The common user interface also allows interaction with the specific
application menu system under the App menu screen.</p>
<div class="section" id="welcome-and-help-screens">
<h3>Welcome and &lt;Help&gt; Screens<a class="headerlink" href="#welcome-and-help-screens" title="Permalink to this headline">¶</a></h3>
<p>The Welcome Screen (<a class="reference internal" href="#welcome-screen"><span class="std std-numref">Figure 26.</span></a>) displays the application name and leads to the
Help Screen (<a class="reference internal" href="#help-screen"><span class="std std-numref">Figure 27.</span></a>), which outlines the generic functionality of the keys throughout the
application. The following sections describe the specific functionality of the keys for each
menu screen.</p>
<div class="figure align-center" id="id13">
<span id="welcome-screen"></span><a class="reference internal image-reference" href="../_images/Welcome-screen.png"><img alt="../_images/Welcome-screen.png" src="../_images/Welcome-screen.png" style="width: 355.8px; height: 152.7px;" /></a>
<p class="caption"><span class="caption-number">Figure 26. </span><span class="caption-text">Welcome screen</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id14">
<span id="help-screen"></span><a class="reference internal image-reference" href="../_images/Help-screen.png"><img alt="../_images/Help-screen.png" src="../_images/Help-screen.png" style="width: 523.8px; height: 59.099999999999994px;" /></a>
<p class="caption"><span class="caption-number">Figure 27. </span><span class="caption-text">Help screen</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 13%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Welcome and Help Screens</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right Arrow Keys</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Help</p></td>
<td><p>Press Enter to show the help screen, press Enter again to go back to the Welcome Screen</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="information-screen">
<h3>Information Screen<a class="headerlink" href="#information-screen" title="Permalink to this headline">¶</a></h3>
<p>The lower portion of the screen (<a class="reference internal" href="#info-screen"><span class="std std-numref">Figure 28.</span></a>) displays various information about the device.
about the device such as the IEEE address, the PAN ID, the channel,
short address, logical device type, and the parent short address.</p>
<div class="figure align-center" id="id15">
<span id="info-screen"></span><a class="reference internal image-reference" href="../_images/Info-screen.png"><img alt="../_images/Info-screen.png" src="../_images/Info-screen.png" style="width: 707.2px; height: 219.60000000000002px;" /></a>
<p class="caption"><span class="caption-number">Figure 28. </span><span class="caption-text">Info screen example</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="device-info">
<h4>Device Info<a class="headerlink" href="#device-info" title="Permalink to this headline">¶</a></h4>
<p>The Device Info field shows information about the device.</p>
<p>IEEE Addr:</p>
<blockquote>
<div><ul class="simple">
<li><p>64-bit IEEE address, unique per device (programmed in manufacturing by TI)</p></li>
</ul>
</div></blockquote>
<p>Power Mode:</p>
<blockquote>
<div><ul class="simple">
<li><p>RX Always On - Receiver is always enabled, mandatory for routing devices and optional for end devices</p></li>
<li><p>Sleepy - Low power device, where the receiver is enabled as needed</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="nwk-info">
<h4>NWK Info<a class="headerlink" href="#nwk-info" title="Permalink to this headline">¶</a></h4>
<p>The Network Info field shows information on the current network, unless BDB Info indicates NotOnNwk.</p>
<p>PAN ID (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-configuring-pan-id-and-network-joining"><span class="std std-ref">Configuring the PAN ID and Network to Join</span></a>):</p>
<blockquote>
<div><ul class="simple">
<li><p>16-bit PAN ID which this device is part of</p></li>
</ul>
</div></blockquote>
<p>Channel (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-configuring-channel"><span class="std std-ref">Configuring Channel</span></a>):</p>
<blockquote>
<div><ul class="simple">
<li><p>Logical channel of the network</p></li>
</ul>
</div></blockquote>
<p>Short Address (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-address-types"><span class="std std-ref">Address Types</span></a>):</p>
<blockquote>
<div><ul class="simple">
<li><p>16-bit NWK address of the device</p></li>
</ul>
</div></blockquote>
<p>Parent Address:</p>
<blockquote>
<div><ul class="simple">
<li><p>16-bit NWK address of the device’s parent</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="bdb-info">
<h4>BDB Info<a class="headerlink" href="#bdb-info" title="Permalink to this headline">¶</a></h4>
<p>The Base Device Behavior Info field shows the current state of the commissioning process
(see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-commissioning"><span class="std std-ref">Commissioning</span></a> and <a class="reference internal" href="z-stack-overview.html#sec-bdb-notifications"><span class="std std-ref">BDB Notifications</span></a>).</p>
<p>BDB Commissioning Procedure being executed:</p>
<blockquote>
<div><ul class="simple">
<li><p>IN - Initialization</p></li>
<li><p>NS - Network Steering</p></li>
<li><p>NF - Network Formation</p></li>
<li><p>FB - Finding and Binding</p></li>
<li><p>TL - Touchlink</p></li>
<li><p>PL - Parent Lost (for end devices only)</p></li>
<li><p>– - idle (commissioning not currently active)</p></li>
</ul>
</div></blockquote>
<p>Current Network status:</p>
<blockquote>
<div><ul class="simple">
<li><p>NotOnNwk - not currently connected to a network</p></li>
<li><p>FORM - network was formed by the current device during the latest execution of the NF method</p></li>
<li><p>JOIN - the current device joined an existing network during the latest execution of the NS method</p></li>
<li><p>EXST - the device was already connected to a network when the commissioning was started</p></li>
</ul>
</div></blockquote>
<p>Joining permission state (not shown on end devices):</p>
<blockquote>
<div><ul class="simple">
<li><p>CLOSED - the current device is closed for joining of other devices.</p></li>
<li><p>OpenXXX - the current device is open for joining of other devices, and will close in XXX seconds.</p></li>
</ul>
</div></blockquote>
<p>Finding and Binding (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-finding-binding"><span class="std std-ref">Finding and Binding</span></a>):</p>
<blockquote>
<div><ul class="simple">
<li><p>IdXXX - Time remaining (XXX) for F&amp;B target to stay in Identify mode</p></li>
<li><p>SrchXXX/XX - Time remaining (XXX) for F&amp;B initiator to search for F&amp;B targets; Number of binds (XX) created to F&amp;B targets</p></li>
</ul>
</div></blockquote>
<p>Touchlink (see <a class="reference internal" href="z-stack-overview.html#z-stack-overview-touchlink-commissioning"><span class="std std-ref">Touchlink Commissioning</span></a>):</p>
<blockquote>
<div><ul class="simple">
<li><p>TL Target - indicates how long the target is enabled to perform touchlink commissioning</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="bind-info">
<h4>Bind Info<a class="headerlink" href="#bind-info" title="Permalink to this headline">¶</a></h4>
<p>Information on the last bind that this device created.</p>
<blockquote>
<div><ul class="simple">
<li><p>Addr - 64-bit IEEE address of the device to which a bind was created</p></li>
<li><p>ClusterId - Cluster involved in the last bind created</p></li>
<li><p>Endpoint - Destination endpoint of the last bind created</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="gp-info">
<h4>GP Info<a class="headerlink" href="#gp-info" title="Permalink to this headline">¶</a></h4>
<p>The Green Power Info shows information on Green Power.</p>
<p>GPP Commissioning:</p>
<p>The Green Power Proxy Commissioning field shows whether or not the GP Proxy device is set in GP commissioning mode by a Green Power Sink device.</p>
<blockquote>
<div><ul class="simple">
<li><p>DISABLED - GPP commissioning process is not in progress</p></li>
<li><p>ENABLED - GPP commissioning process is in progress</p></li>
<li><p>TIME XXX - GPP commissioning process is in progress and will end in XXX seconds</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="app-info">
<h4>APP Info<a class="headerlink" href="#app-info" title="Permalink to this headline">¶</a></h4>
<p>The Application Info screen shows application specific information. This will vary across different examples.</p>
</div>
<div class="section" id="ota-info">
<h4>OTA Info<a class="headerlink" href="#ota-info" title="Permalink to this headline">¶</a></h4>
<p>For OTA-enabled client projects, these two lines provide the current file version followed by OTA status (Stopped, In Progress, Completed).</p>
</div>
<div class="section" id="per-info">
<h4>PER Info<a class="headerlink" href="#per-info" title="Permalink to this headline">¶</a></h4>
<p>For projects where <code class="code docutils literal notranslate"><span class="pre">PER_TEST</span></code> is pre-defined and <code class="code docutils literal notranslate"><span class="pre">per_test.c/h</span></code> from C:\ti\simplelink_cc13xx_cc26xx_sdk_x_xx_xx_xx\source\ti\zstack\per_test
has been added to the project’s main directory, the ongoing results of a packet error rate (PER) test will be
displayed.  The device under test should also define <code class="code docutils literal notranslate"><span class="pre">PER_TEST_SEND_TO_PARENT</span></code> if testing directly with their parent
or <code class="code docutils literal notranslate"><span class="pre">PER_TEST_SEND_USE_FINDING_BINDING</span></code> to test with a device which they’ve binded to.
<code class="code docutils literal notranslate"><span class="pre">PER_TEST_ENABLE_FWD_NOTIFICATION</span></code> should also be enabled on routing devices to enable notification of forwarded frames.</p>
</div>
</div>
<div class="section" id="configure-menu">
<h3>&lt;Configure&gt; Menu<a class="headerlink" href="#configure-menu" title="Permalink to this headline">¶</a></h3>
<p>The Configure Menu (<a class="reference internal" href="#id5"><span class="std std-numref">Figure 29.</span></a>) contains several sub-menus that allow the user to manipulate the install
codes, commissioning procedures, channel masks and PAN ID. This configuration will define
the device behavior during BDB commissioning procedures.</p>
<div class="figure align-center" id="id16">
<span id="id5"></span><a class="reference internal image-reference" href="../_images/Configure-Menu.png"><img alt="../_images/Configure-Menu.png" src="../_images/Configure-Menu.png" style="width: 323.7px; height: 152.1px;" /></a>
<p class="caption"><span class="caption-number">Figure 29. </span><span class="caption-text">Configure Menu</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="add-instl-code-menu">
<h3>&lt;Add Instl Code&gt; Menu<a class="headerlink" href="#add-instl-code-menu" title="Permalink to this headline">¶</a></h3>
<p>The Add Install Code Menu (<a class="reference internal" href="#add-install-code-menu"><span class="std std-numref">Figure 30.</span></a>) provides a user interface to set install codes. The same install code
must be applied to both the Trust Center and the joining device before attempting to join. These
devices will use this install code to generate the TCLK. Joining devices can only store a single
install code at a time, but a Trust Center can store multiple install codes and corresponding IEEE
addresses for joining devices.
Pressing <strong>Enter</strong> key while on this screen enters the Install-Code menu
(the screens for Trust Center and joining devices will differ).</p>
<div class="figure align-center" id="id17">
<span id="add-install-code-menu"></span><a class="reference internal image-reference" href="../_images/Add-install-code-menu.png"><img alt="../_images/Add-install-code-menu.png" src="../_images/Add-install-code-menu.png" style="width: 322.5px; height: 152.7px;" /></a>
<p class="caption"><span class="caption-number">Figure 30. </span><span class="caption-text">Add Install Code Screen</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="set-instl-code-screen">
<h3>&lt;Set Instl Code&gt; Screen<a class="headerlink" href="#set-instl-code-screen" title="Permalink to this headline">¶</a></h3>
<p>The Set Install Code Screen (<a class="reference internal" href="#set-install-code-menu"><span class="std std-numref">Figure 31.</span></a>) has two modes of operation, view and edit. In the view
mode, the install code is shown in the first two lines. The edit mode allows changing the
default install code to any desired value. In edit mode, the CRC of the install code is also
displayed, on the left side of the third line.</p>
<div class="figure align-center" id="id18">
<span id="set-install-code-menu"></span><a class="reference internal image-reference" href="../_images/Set-install-code-menu.png"><img alt="../_images/Set-install-code-menu.png" src="../_images/Set-install-code-menu.png" style="width: 321.0px; height: 150.9px;" /></a>
<p class="caption"><span class="caption-number">Figure 31. </span><span class="caption-text">Set Install Code Screen</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Set Instl Code&gt; Screen - view mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Enter edit mode</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 20%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Set Instl Code&gt; Screen - edit mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Digit navigation</p></td>
<td><p>Move to previous/next digit</p></td>
</tr>
<tr class="row-even"><td><p>0-F</p></td>
<td><p>Value change</p></td>
<td><p>Determine the value of the highlighted digit</p></td>
</tr>
<tr class="row-odd"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Save and exit mode</p></td>
</tr>
</tbody>
</table>
<p>Note that the Apply Install Code Screen must be used to apply the altered install codes.</p>
</div>
<div class="section" id="set-i-c-addr-screen">
<h3>&lt;Set I.C. Addr&gt; Screen<a class="headerlink" href="#set-i-c-addr-screen" title="Permalink to this headline">¶</a></h3>
<p>The Set Install Code Address Screen (<a class="reference internal" href="#set-install-address-code-menu"><span class="std std-numref">Figure 32.</span></a>) is only
available for a Trust Center and has two modes of operation. In the first mode, the
IEEE address to be associated with the install code entered in the previous screen is
shown. The second mode allows this address to be changed. When a device with this IEEE
address tries to join the Trust Center, the Trust Center will use the associated
Install Code to generate a Trust Center Link Key to use with this device.</p>
<div class="figure align-center" id="id19">
<span id="set-install-address-code-menu"></span><a class="reference internal image-reference" href="../_images/Set-install-address-code-menu.png"><img alt="../_images/Set-install-address-code-menu.png" src="../_images/Set-install-address-code-menu.png" style="width: 323.09999999999997px; height: 148.5px;" /></a>
<p class="caption"><span class="caption-number">Figure 32. </span><span class="caption-text">Set Install Code Address Screen (Trust Center only)</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Set I.C. Addr&gt; Screen - view mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Enter edit mode</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 20%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Set I.C. Addr&gt; Screen - edit mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Digit navigation</p></td>
<td><p>Move to previous/next digit</p></td>
</tr>
<tr class="row-even"><td><p>0-F</p></td>
<td><p>Value change</p></td>
<td><p>Determine the value of the highlighted digit</p></td>
</tr>
<tr class="row-odd"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Save and exit mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="apply-install-code-screen">
<h3>Apply Install Code Screen<a class="headerlink" href="#apply-install-code-screen" title="Permalink to this headline">¶</a></h3>
<p>The Apply Install Code Screen (<a class="reference internal" href="#apply-install-code-menu"><span class="std std-numref">Figure 33.</span></a>) will save the last
configuration done for remote nodes in the case of a Trust Center, or local
configuration for routers and end devices. The last status must be successful to
ensure the correct application of install code.</p>
<div class="figure align-center" id="id20">
<span id="apply-install-code-menu"></span><a class="reference internal image-reference" href="../_images/Apply-install-code-menu.png"><img alt="../_images/Apply-install-code-menu.png" src="../_images/Apply-install-code-menu.png" style="width: 338.09999999999997px; height: 153.0px;" /></a>
<p class="caption"><span class="caption-number">Figure 33. </span><span class="caption-text">Apply Install Code screen</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 18%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Aply Inst Code&gt; Screen</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Apply the install code configured in the previous screens</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="channel-mask-screens">
<h3>Channel Mask Screens<a class="headerlink" href="#channel-mask-screens" title="Permalink to this headline">¶</a></h3>
<p>The Channel Mask Screens (<a class="reference internal" href="#primary-channel-mask"><span class="std std-numref">Figure 34.</span></a>, <a class="reference internal" href="#secondary-channel-mask"><span class="std std-numref">Figure 35.</span></a>)
display and allow modification of the default channel configuration of the
device for primary and secondary channel masks. Channels marked with * are enabled in the
selected channel mask. Press the <strong>Enter</strong> key to start changing the mask.</p>
<p>The display numbers in the channel mask are read as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="17"><p>Channel mask conversion</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Logical Channel</p></td>
<td><p>11</p></td>
<td><p>12</p></td>
<td><p>13</p></td>
<td><p>14</p></td>
<td><p>15</p></td>
<td><p>16</p></td>
<td><p>17</p></td>
<td><p>18</p></td>
<td><p>19</p></td>
<td><p>20</p></td>
<td><p>21</p></td>
<td><p>22</p></td>
<td><p>23</p></td>
<td><p>24</p></td>
<td><p>25</p></td>
<td><p>26</p></td>
</tr>
<tr class="row-odd"><td><p>Displayed Digit</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id21">
<span id="primary-channel-mask"></span><a class="reference internal image-reference" href="../_images/Primary-Channel-Mask.png"><img alt="../_images/Primary-Channel-Mask.png" src="../_images/Primary-Channel-Mask.png" style="width: 323.7px; height: 150.9px;" /></a>
<p class="caption"><span class="caption-number">Figure 34. </span><span class="caption-text">Primary Channel Mask Screen</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id22">
<span id="secondary-channel-mask"></span><a class="reference internal image-reference" href="../_images/Secondary-Channel-Mask.png"><img alt="../_images/Secondary-Channel-Mask.png" src="../_images/Secondary-Channel-Mask.png" style="width: 322.2px; height: 151.2px;" /></a>
<p class="caption"><span class="caption-number">Figure 35. </span><span class="caption-text">Secondary Channel Mask Screen</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 22%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Primary Channel Mask&gt;, &lt;Secondary Channel Mask&gt; Screens – view mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Enter edit mode</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 22%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Primary Channel Mask&gt;, &lt;Secondary Channel Mask&gt; Screens – edit mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Channel navigation</p></td>
<td><p>Move to previous/next channel indicator</p></td>
</tr>
<tr class="row-even"><td><p>0-F</p></td>
<td><p>Value change</p></td>
<td><p>Determine the value of the highlighted digit</p></td>
</tr>
<tr class="row-odd"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Save and exit mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pan-id-screen">
<h3>&lt;PAN ID&gt; Screen<a class="headerlink" href="#pan-id-screen" title="Permalink to this headline">¶</a></h3>
<p>The PAN ID Screen (<a class="reference internal" href="#pan-id"><span class="std std-numref">Figure 36.</span></a>) allows changing of the default PAN ID (0xFFFF by default) to any desired
value.</p>
<div class="figure align-center" id="id23">
<span id="pan-id"></span><a class="reference internal image-reference" href="../_images/PAN-ID.png"><img alt="../_images/PAN-ID.png" src="../_images/PAN-ID.png" style="width: 321.59999999999997px; height: 152.4px;" /></a>
<p class="caption"><span class="caption-number">Figure 36. </span><span class="caption-text">PAN ID Screen - view mode</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;PAN ID&gt; Screen – view mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Enter edit mode</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 20%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;PAN ID&gt; Screen – edit mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Digit navigation</p></td>
<td><p>Move to previous/next digit</p></td>
</tr>
<tr class="row-even"><td><p>Up/Down</p></td>
<td><p>Value change</p></td>
<td><p>Increase/decrease the value of the highlighted digit</p></td>
</tr>
<tr class="row-odd"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Save and exit mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="base-device-behavior-commissioning-mode-screens">
<h3>Base Device Behavior Commissioning Mode Screens<a class="headerlink" href="#base-device-behavior-commissioning-mode-screens" title="Permalink to this headline">¶</a></h3>
<p>The Base Device Behavior (BDB) Commissioning Screens (<a class="reference internal" href="#bdb-tl-initiator"><span class="std std-numref">Figure 39.</span></a>,
<a class="reference internal" href="#bdb-formation"><span class="std std-numref">Figure 40.</span></a>, <a class="reference internal" href="#bdb-steering"><span class="std std-numref">Figure 41.</span></a>, <a class="reference internal" href="#bdb-findingbinding"><span class="std std-numref">Figure 42.</span></a>) allow
enabling/disabling of the top level commissioning procedures that will be performed
when BDB commissioning is triggered by commissioning screen
(<a class="reference internal" href="#id6"><span class="std std-numref">Figure 43.</span></a>) or any other means.</p>
<div class="section" id="touchlink">
<h4>Touchlink<a class="headerlink" href="#touchlink" title="Permalink to this headline">¶</a></h4>
<p>BDB Touchlink is a proximity commissioning method for network formation with
distributed security, this means that the network created does not have a Trust Center.
This procedure can be invoked on <em>Router</em> and <em>End Devices</em>, but not by <em>Coordinators</em>.
The commissioning involves two configurations which are touchlink initiator and
touchlink target.</p>
<p>If the device supports touchlink target (by setting the compile option <code class="code docutils literal notranslate"><span class="pre">BDB_TL_TARGET</span></code>), the screen <a class="reference internal" href="#tl-target-time"><span class="std std-numref">Figure 37.</span></a> in the commissioning
menu allows you to change the amount of time the device will accept the touchlink commissioning process.
Once a time period is selected, the target is enabled to perform this commissioning procedure with initiators.
The screen <a class="reference internal" href="#tl-target-steal"><span class="std std-numref">Figure 38.</span></a> sets the <em>allow stealing</em> configuration.</p>
<div class="figure align-center" id="id24">
<span id="tl-target-time"></span><a class="reference internal image-reference" href="../_images/TL-Target-time.png"><img alt="../_images/TL-Target-time.png" src="../_images/TL-Target-time.png" style="width: 286.8px; height: 153.0px;" /></a>
<p class="caption"><span class="caption-number">Figure 37. </span><span class="caption-text">Touchlink Target time screen</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id25">
<span id="tl-target-steal"></span><a class="reference internal image-reference" href="../_images/TL-Target-steal.png"><img alt="../_images/TL-Target-steal.png" src="../_images/TL-Target-steal.png" style="width: 287.09999999999997px; height: 152.1px;" /></a>
<p class="caption"><span class="caption-number">Figure 38. </span><span class="caption-text">Touchlink Target allow stealing screen</span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</div>
<p>If the device supports Touchlink as Initiator (by setting the compile option
<code class="code docutils literal notranslate"><span class="pre">BDB_TL_INITIATOR</span></code>), the screen <a class="reference internal" href="#bdb-tl-initiator"><span class="std std-numref">Figure 39.</span></a> in the commissioning menu
allows you to set if touchlink as initiator will be executed when the commissioning screen is triggered.</p>
<div class="figure align-center" id="id26">
<span id="bdb-tl-initiator"></span><a class="reference internal image-reference" href="../_images/BDB-TL-Initiator.png"><img alt="../_images/BDB-TL-Initiator.png" src="../_images/BDB-TL-Initiator.png" style="width: 287.09999999999997px; height: 152.7px;" /></a>
<p class="caption"><span class="caption-number">Figure 39. </span><span class="caption-text">Touchlink Initiator Screen</span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</div>
<p>More details on this commissioning process are provided in the “Touchlink Commissioning” section of <a class="reference internal" href="z-stack-overview.html#z-stack-overview"><span class="std std-ref">Z-Stack Overview</span></a>.</p>
</div>
<div class="section" id="formation">
<h4>Formation<a class="headerlink" href="#formation" title="Permalink to this headline">¶</a></h4>
<p>BDB Formation procedure is meant to be used by Coordinator devices and Router devices.
Coordinator devices will create a centralized network, whereas Router devices will
create a distributed network, after which any other Router or End Device may join these
networks. For further details on the differences between these two types of networks
please refer to the “Centralized Security Network” and “Distributed Security Network” sections of <a class="reference internal" href="z-stack-overview.html#z-stack-overview"><span class="std std-ref">Z-Stack Overview</span></a>.
This commissioning procedure cannot be used if the device is already on a network or does not have formation
capabilities such as End Devices.</p>
<div class="figure align-center" id="id27">
<span id="bdb-formation"></span><a class="reference internal image-reference" href="../_images/BDB-Formation.png"><img alt="../_images/BDB-Formation.png" src="../_images/BDB-Formation.png" style="width: 320.7px; height: 153.29999999999998px;" /></a>
<p class="caption"><span class="caption-number">Figure 40. </span><span class="caption-text">Formation Screen</span><a class="headerlink" href="#id27" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="network-steering">
<h4>Network Steering<a class="headerlink" href="#network-steering" title="Permalink to this headline">¶</a></h4>
<p>BDB Network Steering procedure is meant to allow joining devices such as Routers and
End Devices to discover and join a suitable network.
Performing the network discovery process is necessary to complete the joining process.
Devices that are already in a network will use this commissioning procedure to open the
network and allow other devices to join the network.</p>
<div class="figure align-center" id="id28">
<span id="bdb-steering"></span><a class="reference internal image-reference" href="../_images/BDB-Steering.png"><img alt="../_images/BDB-Steering.png" src="../_images/BDB-Steering.png" style="width: 322.8px; height: 152.1px;" /></a>
<p class="caption"><span class="caption-number">Figure 41. </span><span class="caption-text">Steering Screen</span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="finding-and-binding">
<h4>Finding and Binding<a class="headerlink" href="#finding-and-binding" title="Permalink to this headline">¶</a></h4>
<p>BDB Finding and Binding is an application commissioning procedure that allows
applications to match its clusters with other devices and easily create binds.
For example, Light devices will set Identify mode state for 180 seconds, in which it
can be discovered by Switch devices performing this commissioning procedure. After
the Switch device creates the binds with the Light devices found during the procedure,
it will be able to control those lights.</p>
<div class="figure align-center" id="id29">
<span id="bdb-findingbinding"></span><a class="reference internal image-reference" href="../_images/BDB-FindingBinding.png"><img alt="../_images/BDB-FindingBinding.png" src="../_images/BDB-FindingBinding.png" style="width: 322.5px; height: 152.1px;" /></a>
<p class="caption"><span class="caption-number">Figure 42. </span><span class="caption-text">Finding and Binding Screen</span><a class="headerlink" href="#id29" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 18%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;T.L. Initiator &gt;,&lt;Nwk Formation&gt;, &lt;Nwk Steering&gt;, &lt;Findng+Bndng&gt; Screens</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Toggle enable/disable commissioning procedure</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="commissioning-screen">
<h3>&lt;Commissioning&gt; Screen<a class="headerlink" href="#commissioning-screen" title="Permalink to this headline">¶</a></h3>
<p>The Commissioning Screen (<a class="reference internal" href="#id6"><span class="std std-numref">Figure 43.</span></a>) starts the BDB top level
commissioning processes selected in the configuration menus.</p>
<div class="figure align-center" id="id30">
<span id="id6"></span><a class="reference internal image-reference" href="../_images/Commissioning-Screen.png"><img alt="../_images/Commissioning-Screen.png" src="../_images/Commissioning-Screen.png" style="width: 322.5px; height: 152.7px;" /></a>
<p class="caption"><span class="caption-number">Figure 43. </span><span class="caption-text">Commissioning Screen</span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 27%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Commission&gt; Screen</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Start commissioning procedure</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="reset-to-fn-screen">
<h3>&lt;Reset to FN&gt; Screen<a class="headerlink" href="#reset-to-fn-screen" title="Permalink to this headline">¶</a></h3>
<p>Reset to Factory New (<a class="reference internal" href="#reset-fn-screen"><span class="std std-numref">Figure 44.</span></a>) clears the device’s network
information and restores the NVM tables to default. The device will perform a
soft reset automatically during this procedure and then display
the Welcome Screen (<a class="reference internal" href="#welcome-screen"><span class="std std-numref">Figure 26.</span></a>).</p>
<div class="figure align-center" id="id31">
<span id="reset-fn-screen"></span><a class="reference internal image-reference" href="../_images/Reset-FN-Screen.png"><img alt="../_images/Reset-FN-Screen.png" src="../_images/Reset-FN-Screen.png" style="width: 321.9px; height: 151.2px;" /></a>
<p class="caption"><span class="caption-number">Figure 44. </span><span class="caption-text">Reset to Factory New Screen</span><a class="headerlink" href="#id31" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Reset to Fn&gt; Screen</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Perform Factory New Reset</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the LaunchPad’s XDS110 emulator device control during programming,
the device must undergo a hardware reset (typically via a push button
pull-down on the RESET pin or power cycle) in order for this screen to
effectively perform a software reset instead of crashing.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="back-screen">
<h3>&lt;Back&gt; Screen<a class="headerlink" href="#back-screen" title="Permalink to this headline">¶</a></h3>
<p>The Back Screen (<a class="reference internal" href="#id7"><span class="std std-numref">Figure 45.</span></a>) allows returning to the previous screen.
When the back action is performed the upper level screen will be displayed automatically.</p>
<div class="figure align-center" id="id32">
<span id="id7"></span><a class="reference internal image-reference" href="../_images/Back-Screen.png"><img alt="../_images/Back-Screen.png" src="../_images/Back-Screen.png" style="width: 322.8px; height: 151.5px;" /></a>
<p class="caption"><span class="caption-number">Figure 45. </span><span class="caption-text">Back Screen</span><a class="headerlink" href="#id32" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;Back&gt; Screen</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Back to upper menu</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="app-menu">
<h3>&lt;App&gt; Menu<a class="headerlink" href="#app-menu" title="Permalink to this headline">¶</a></h3>
<p>The App menu (<a class="reference internal" href="#app-screen"><span class="std std-numref">Figure 46.</span></a>) is application specific and will contain
the menus to interact with the specific application implementation. Those
specific application menus are explained in the README documentation provided
by each application and referred in <a class="reference internal" href="example_applications.html#chap-example-applications"><span class="std std-ref">Running the Example Applications</span></a>.</p>
<p>This menu is intended to be used once the device is already commissioned to a
network, as it provides ways to interact with the other devices in the network.
For example, the Switch application will have a Toggle Remote Light interface which
will trigger the Switch application to send a Toggle Light command to all lights
previously binded.</p>
<div class="figure align-center" id="id33">
<span id="app-screen"></span><a class="reference internal image-reference" href="../_images/App-Screen.png"><img alt="../_images/App-Screen.png" src="../_images/App-Screen.png" style="width: 323.09999999999997px; height: 152.4px;" /></a>
<p class="caption"><span class="caption-number">Figure 46. </span><span class="caption-text">App Screen</span><a class="headerlink" href="#id33" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>&lt;App&gt; Menu</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key</p></td>
<td><p>Functionality</p></td>
<td><p>Comment</p></td>
</tr>
<tr class="row-odd"><td><p>Left/Right</p></td>
<td><p>Menu navigation</p></td>
<td><p>Move to previous/next screen</p></td>
</tr>
<tr class="row-even"><td><p>Enter</p></td>
<td><p>Select</p></td>
<td><p>Application specific action</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="buttons-and-leds">
<h3>Buttons and LEDs<a class="headerlink" href="#buttons-and-leds" title="Permalink to this headline">¶</a></h3>
<p>The common user interface also controls the funtionality of push buttons
and LEDs, two of which are already incorporated into the example applications
for use with the LaunchPad boards:</p>
<ul class="simple">
<li><p>BTN-1: Starts the BDB commissioning process (Network Formation, Steering,
and/or Finding &amp; Binding)</p></li>
<li><p>BTN-2: Application-specific function (ex. light switch) or Factory New
Reset when held down during a power cycle</p></li>
<li><p>GREEN_LED: Turns on when a network has formed/resumed (ZC/ZR) or been joined
(ZR/ZED), blinking if actively identifying as a Finding &amp; Binding target, off
otherwise</p></li>
<li><p>RED_LED: Application-specific function (ex. light)</p></li>
</ul>
<p>More DIOs can be added to fit the requirements of a custom board design and
specific application in accordance with SysConfig initialization, for more
information refer to <a class="reference internal" href="../sysconfig/sysconfig-board-cc23xx.html#sysconfig-board-files"><span class="std std-ref">Configure The Board Files with SysConfig</span></a></p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developing_zigbee_applications.html" class="btn btn-neutral float-left" title="Developing Zigbee Applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gpd_application_overview.html" class="btn btn-neutral float-right" title="Green Power Application Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>