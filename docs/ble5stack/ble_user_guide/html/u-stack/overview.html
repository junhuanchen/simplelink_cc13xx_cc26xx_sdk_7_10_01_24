<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User&#39;s Guide
 2.02.08.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Application Layer" href="uStack-application.html" />
    <link rel="prev" title="Micro BLE Stack" href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug u-stack overview";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide

          </a>
              <div class="version">
                2.02.08.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/ble5-quick-start.html">TI BLE5-Stack Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/platform-cc13xx_cc26xx.html">The CC13xx or CC26xx SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/freertos-index.html">FreeRTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble-stack-5-index-cc13xx_cc26xx.html">BLE5-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/developing-with-sdk-index-cc13xx_cc26xx.html">Developing a Bluetooth LE Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence.html">Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/localization-index-cc13xx_cc26xx.html">RTLS Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-mesh/index.html">Bluetooth Mesh</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html">Micro BLE Stack</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constraints-and-requirements">Constraints and Requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#system-architecture">System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#micro-rf-interface">Micro RF interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#micro-link-layer">Micro Link Layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#radio-initialization">Radio Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-parameters">Application Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#micro-link-layer-states">Micro Link Layer States</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#standby-state">Standby State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advertising-state">Advertising State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-state">Monitoring State</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rf-callbacks">RF Callbacks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#micro-gap">Micro GAP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parameters-management">Parameters Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ugbnumadvevent">ugbNumAdvEvent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ugbdutyontime">ugbDutyOnTime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ugbdutyofftime">ugbDutyOffTime</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#role-management">Role Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#broadcaster-role">Broadcaster Role</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitor-role">Monitor Role</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="uStack-application.html">Application Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-interface.html">External Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/memory-index.html">Memory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-cc13xx_cc26xx.html">TI Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/sysconfig-index-cc13xx_cc26xx.html">System Configuration Tool (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/migration-cc13xx_cc26xx.html">Porting Guide and Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/api-reference-cc13xx_cc26xx.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html">Micro BLE Stack</a> &raquo;</li>
      <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="overview">
<span id="sec-uble-overview"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>This section describes the high level design and functionality of the Micro BLE
Stack. The Micro BLE Stack enables applications on the CC13xx or CC26xx to advertise,
scan, or behave as a connection monitor. The Micro BLE stack utilizes the
MultiMode RF driver as well. The MultiMode RF Driver enables dual-mode
applications where another communication protocol stack is integrated and
utilized alongside the Micro BLE Stack.</p>
<div class="section" id="constraints-and-requirements">
<h2>Constraints and Requirements<a class="headerlink" href="#constraints-and-requirements" title="Permalink to this headline">¶</a></h2>
<p>The Micro BLE Stack has the following internal constraints and requirements:</p>
<ul class="simple">
<li><p>This design optionally depends on partial integration of ICall to save
system resources if there already is an application using ICall in the
dual-mode use case. In the case of using the ICall module, ICall’s system
heap management and TI-RTOS service abstraction will be used.</p></li>
<li><p>There is no HCI because there is no separation between the controller and the
host.</p></li>
<li><p>The privacy feature is not supported, but random address generation is
supported</p></li>
<li><p>To minimize the memory overhead and remove redundant context switching,
the Micro BLE Stack doesn’t have a separate TI-RTOS task. It is instead
integrated in the application task.</p></li>
<li><p>The micro stack requires the use of the MultiMode RF driver</p></li>
<li><p>Device using only micro stack can not be Bluetooth qualified.</p></li>
</ul>
</div>
</div>
<div class="section" id="system-architecture">
<span id="id2"></span><h1>System Architecture<a class="headerlink" href="#system-architecture" title="Permalink to this headline">¶</a></h1>
<p>The Micro BLE Stack consists of the Micro Link Layer (Micro LL or
uLL), Micro Generic Access Profile (Micro GAP or uGAP), and
a Micro Radio Interface (Micro RFI or uRFI).</p>
<p>The uLL is mainly responsible for maintaining the device state and scheduling
radio commands to perform advertising, scanning or connection monitoring operations.
The pre- and post-processing for each radio command execution are also done by the uLL.
The  uLL directly invokes the RF Driver and will utilize the MicroRFI to initialize
the radio for the  Micro BLE Stack features being exercised.</p>
<p>Micro LL performs:</p>
<ul class="simple">
<li><p>Radio management</p></li>
<li><p>Device state management between standby, advertising/scanning, and monitoring</p></li>
</ul>
<p>The uGAP sits between the uLL and the application and is mainly responsible for
controlling the uLL to set up and run a profile role. The application can
indirectly configure the uLL through uGAP and be notified of events from uLL
through uGAP callbacks. uGAP needs TI-RTOS because the clock/timer service is
used.</p>
<p>Micro GAP performs:</p>
<ul class="simple">
<li><p>Broadcaster role</p></li>
<li><p>Connection Monitor feature</p></li>
<li><p>Initialization and configuration of the uLL</p></li>
<li><p>State Management within the role/feature</p></li>
<li><p>Interfacing with the application</p></li>
</ul>
<p>The uRFI is primarily used to initialize the Radio and allow Radio
commands to be sent. Depending on the features enabled the uRFI will define
the proper parameter structures which the uLL will externally reference
to utilize the RF driver.</p>
<p>Micro BLE Stack is not designed to run as a separate TI-RTOS task, in order
to save memory that would otherwise be required to maintain an additional task.
Instead, it is integrated in the application, from TI-RTOS context’s point of
view, so that all the application callbacks that are originated from RF and
Clock SWIs in the Micro BLE Stack and might have lengthy operations such as
command completion post processing and error handling are called in the
application task context. How the Micro BLE Stack is integrated context-wise in
the application is illustrated in <a class="reference internal" href="#system-context-diagram"><span class="std std-numref">Figure 162.</span></a> Note that
only the subcomponents directly relevant to the Micro BLE Stack in the
application and the RF driver are depicted.</p>
<div class="figure align-center" id="id3">
<span id="system-context-diagram"></span><img alt="alternate text" src="../_images/system_context_diagram.jpg" />
<p class="caption"><span class="caption-number">Figure 162. </span><span class="caption-text">System Context Diagram</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="micro-rf-interface">
<span id="sec-urfi-cc13xx-26xx"></span><h1>Micro RF interface<a class="headerlink" href="#micro-rf-interface" title="Permalink to this headline">¶</a></h1>
<p>The micro RF interface or <code class="docutils literal notranslate"><span class="pre">urfi</span></code> is responsible for instantiating and
configuring various RF commands used by the micro stack.</p>
<p>The following RF commands are used by the micro stack</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rfc_CMD_BLE_ADV_COMMON_t</span></code> : Advertiser command, used by broadcaster</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rfc_CMD_BLE_SCANNER_t</span></code> : Scanner command, used by observer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rfc_CMD_BLE_GENERIC_RX_t</span></code> : Generic RX command, used by connection monitor</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="micro-link-layer">
<h1>Micro Link Layer<a class="headerlink" href="#micro-link-layer" title="Permalink to this headline">¶</a></h1>
<p>The uLL is mainly responsible for the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>Maintaining the device state</p></li>
<li><p>Scheduling radio activities</p></li>
<li><p>Pre- and post-processing</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> without privacy is supported.</p>
</div>
<div class="section" id="radio-initialization">
<h2>Radio Initialization<a class="headerlink" href="#radio-initialization" title="Permalink to this headline">¶</a></h2>
<p>The uLL has a direct interface to the RF Driver. It opens a connection to the RF
Driver as an independent client using <code class="docutils literal notranslate"><span class="pre">RF_open()</span></code> with setup parameters for
BLE PHY. The setup parameters referenced to interface with the RF Driver are
defined in the <a class="reference internal" href="#sec-urfi-cc13xx-26xx"><span class="std std-ref">Micro RF interface</span></a>. These parameters are dependent on
the features enabled in Micro BLE Stack.</p>
</div>
<div class="section" id="application-parameters">
<span id="parameters-to-rely-on-cc13xx-26xx"></span><h2>Application Parameters<a class="headerlink" href="#application-parameters" title="Permalink to this headline">¶</a></h2>
<p>The uLL maintains parameters used for advertising, scanning and connection
monitoring. Most of the
parameters can be accessed by uGAP through <a class="reference external" href="../../doxygen/ble/html/group___u_b_l_e.html#ga2ef1d23433d7698925c63c8b884e48a4">uble_setParameter()</a> and
<a class="reference external" href="../../doxygen/ble/html/group___u_b_l_e.html#gacae1ae355447d5150c8e035e364b6052">uble_getParameter()</a> functions. See local and global variables defined
<code class="docutils literal notranslate"><span class="pre">uble.c</span></code> in the stack folder for Application parameters.</p>
</div>
<div class="section" id="micro-link-layer-states">
<h2>Micro Link Layer States<a class="headerlink" href="#micro-link-layer-states" title="Permalink to this headline">¶</a></h2>
<p>There are 4 states in the uLL: Standby, Advertising, Scanning, and Monitoring.
The uLL changes the state from one to another at the uGAP’s request.
Interfacing to the BLE Micro Stack should be done through uGAP APIs.</p>
<div class="section" id="standby-state">
<h3>Standby State<a class="headerlink" href="#standby-state" title="Permalink to this headline">¶</a></h3>
<p>This is the default state in the uLL. The uLL doesn’t do any radio activities in this
state. The uLL may leave this state to enter any other state.</p>
</div>
<div class="section" id="advertising-state">
<span id="ustack-advertising-state-cc13xx-26xx"></span><h3>Advertising State<a class="headerlink" href="#advertising-state" title="Permalink to this headline">¶</a></h3>
<p>In this state, the uLL sends advertising PDUs in advertising events.</p>
<p>Each advertising event is composed of 3 advertising PDUs sent on the
advertising channels as the commands are chained together.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-number">Listing 189. </span><span class="caption-text">urfi.c: Chainning advertising command</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="n">urfiAdvCmd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pNextOp</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rfc_radioOp_t</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">urfiAdvCmd</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="linenos">2</span><span class="w"> </span><span class="n">urfiAdvCmd</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pNextOp</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rfc_radioOp_t</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">urfiAdvCmd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="linenos">3</span><span class="w"> </span><span class="n">urfiAdvCmd</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pNextOp</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>The time between two consecutive advertising events is specified in
<code class="docutils literal notranslate"><span class="pre">UBLE_PARAM_ADVINTERVAL</span></code>. The actual interval will be
<code class="docutils literal notranslate"><span class="pre">UBLE_PARAM_ADVINTERVAL</span></code> + AdvDelay, where AdvDelay is a pseudo-random
value ranging from 0 ms to 10 ms generated by the uLL for each advertising
event.</p>
<p>An advertising event is limited to the following type in this version of design:</p>
<ul class="simple">
<li><p>A non-connectable undirected event: ADV_NONCONN_IND PDU is used. No response
PDU is expected.</p></li>
</ul>
<p>Per each advertising event, the following notifications will be delivered to the
uGAP before and after the event. Note that these notifications are conveyed
based on the application task’s priority since they are following the paths
illustrated in <a class="reference internal" href="#system-context-diagram"><span class="std std-numref">Figure 162.</span></a></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">UGB_EVT_ADV_PREPARE</span></code>: This notification event is generated
<code class="docutils literal notranslate"><span class="pre">UBLE_PARAM_DFLT_TIMETOADV</span></code> ms prior to every advertising event. The purpose of
this event is to let the application take time to update the advertising data
with up-to-date information if necessary. If <code class="docutils literal notranslate"><span class="pre">UBLE_PARAM_DFLT_TIMETOADV</span></code> is
0, this notification event won’t happen.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can change advertising data by using <a class="reference external" href="../../doxygen/ble/html/group___u_b_l_e.html#ga2ef1d23433d7698925c63c8b884e48a4">uble_setParameter()</a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGB_EVT_ADV_POSTPROCESS</span></code>: This notification event is generated at the
completion of every advertising event.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGB_EVT_STATE_CHANGE</span></code>: This notification event is generated when state has
changed</p></li>
</ul>
</div>
<div class="section" id="monitoring-state">
<span id="monitoring-state-cc13xx-26xx"></span><h3>Monitoring State<a class="headerlink" href="#monitoring-state" title="Permalink to this headline">¶</a></h3>
<p>In this state, the uLL will scan a particular channel with specified scan
parameters. An access address filter is applied based on the <code class="docutils literal notranslate"><span class="pre">accessAddr</span></code>
parameter. The uGAP will supply all the necessary parameters and initialize the
scan. Each scan has an associated <code class="docutils literal notranslate"><span class="pre">monitorHandle</span></code> which
maintains the session. The scan will be performed over the specified channels by
<code class="docutils literal notranslate"><span class="pre">monitorChan</span></code>.</p>
<p>The monitor session currently scanning is determined by the
<code class="docutils literal notranslate"><span class="pre">startTime</span></code> which accounts for when the next connection event of the
monitored connection should start. Furthermore the <code class="docutils literal notranslate"><span class="pre">crcInit</span></code> of the connection
to follow must be input.</p>
<p>If a packet is detected before the end of scan duration, <code class="docutils literal notranslate"><span class="pre">monitorDuration</span></code>,
the uLL will call the callback registered for indications.
The application is then notified with a <code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_MONITOR_INDICATION</span></code>
event.</p>
<p>Once the scan duration is elapsed, the application is notified with
<code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_MONITOR_COMPLETE</span></code> event.</p>
<p>If there are pending scans, the uGAP will automatically start the next one.</p>
<p>If there is a state change, the application is notified with
<code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_STATE_CHANGE</span></code> event.</p>
</div>
</div>
<div class="section" id="rf-callbacks">
<h2>RF Callbacks<a class="headerlink" href="#rf-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Each RF event is processed differently depending on the role
the micro stack is operating in (broadcaster, observer, connection monitor).
These RF events are consumed through callbacks that are plugged to the RF driver
via the uLL. See the table below for a summary of how the RF events are
processed by the uLL.</p>
<span id="tbl-ustack-rf-event-processing"></span><table class="docutils align-default" id="id5">
<caption><span class="caption-number">Table 36. </span><span class="caption-text">RF Driver Event processing by the Micro BLE-Stack</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 14%" />
<col style="width: 33%" />
<col style="width: 39%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Mode</p></td>
<td><p>RF callback</p></td>
<td><p>Events Processed</p></td>
<td><p>Events generated</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Broadcaster</p></td>
<td rowspan="2"><p>ull_advDoneCb</p></td>
<td><p>RF_EventLastCmdDone</p></td>
<td><p>ULL_EVT_ADV_TX_SUCCESS</p></td>
</tr>
<tr class="row-odd"><td><p>RF_EventCmdAborted, RF_EventCmdStopped,
RF_EventCmdPreempted, RF_EventCmdCancelled</p></td>
<td><p>ULL_EVT_ADV_TX_FAILED</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Observer</p></td>
<td rowspan="2"><p>ull_scanDoneCb</p></td>
<td><p>RF_EventRxEntryDone</p></td>
<td><p>ULL_EVT_SCAN_RX_SUCCESS</p></td>
</tr>
<tr class="row-odd"><td><p>RF_EventLastCmdDone, RF_EventInternalError</p></td>
<td><p>ULL_EVT_SCAN_RX_FAILED or ULL_EVT_SCAN_RX_BUF_FULL
(depending on status from RF driver)</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>Connection Monitor</p></td>
<td rowspan="3"><p>ull_monitorDoneCb</p></td>
<td><p>RF_EventRxEntryDone</p></td>
<td><p>ULL_EVT_MONITOR_RX_SUCCESS</p></td>
</tr>
<tr class="row-odd"><td><p>RF_EventLastCmdDone</p></td>
<td><p>ULL_EVT_MONITOR_RX_WINDOW_COMPLETE
ULL_EVT_MONITOR_RX_BUF_FULL
ULL_EVT_MONITOR_RX_FAILED
(depending on status from RF driver)</p></td>
</tr>
<tr class="row-even"><td><p>RF_EventInternalError</p></td>
<td><p>ULL_EVT_MONITOR_RX_FAILED</p></td>
</tr>
</tbody>
</table>
<p>For more information regarding the RF driver see the RF Driver API
<a class="reference internal" href="../ble-stack-5.x-guide/api-reference-cc13xx_cc26xx.html#ti-driver-reference"><span class="std std-ref">Driver API Reference</span></a>.</p>
</div>
</div>
<div class="section" id="micro-gap">
<h1>Micro GAP<a class="headerlink" href="#micro-gap" title="Permalink to this headline">¶</a></h1>
<p>The uGAP sits between the uLL and the application, and it is responsible for
controlling the uLL to set up and run profile roles. The application can
indirectly configure the uLL through the uGAP and be notified of events from the
uLL through uGAP callbacks.</p>
<div class="section" id="parameters-management">
<span id="parameters-management-cc13xx-26xx"></span><h2>Parameters Management<a class="headerlink" href="#parameters-management" title="Permalink to this headline">¶</a></h2>
<p>The uGAP maintains the following parameters that control its behavior</p>
<div class="section" id="ugbnumadvevent">
<h3>ugbNumAdvEvent<a class="headerlink" href="#ugbnumadvevent" title="Permalink to this headline">¶</a></h3>
<p>The number of advertising events to be done before the Broadcaster stops its
job. This is given when the application starts the Broadcaster by calling
ug_bcastStart(). If this parameter is set to 0, the Broadcaster will not go to
<code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_INITIALIZED</span></code> state once started unless it is requested to
stop.</p>
</div>
<div class="section" id="ugbdutyontime">
<h3>ugbDutyOnTime<a class="headerlink" href="#ugbdutyontime" title="Permalink to this headline">¶</a></h3>
<p>Time period during which the Broadcaster stays in <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_ADVERTISING</span></code>
state. The uLL stays in Advertising State as well. When this time period ends,
the Broadcaster state will transition to <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_WAITING</span></code> and the uLL
will exit Advertising State. This parameter is effective only if Broadcaster
Duty Control is enabled. If Broadcaster Duty Control is disabled, transition
to other state from <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_ADVERTISING</span></code> is not affected by this parameter.
A 100-ms time unit is used.</p>
</div>
<div class="section" id="ugbdutyofftime">
<h3>ugbDutyOffTime<a class="headerlink" href="#ugbdutyofftime" title="Permalink to this headline">¶</a></h3>
<p>Time period during which the Broadcaster stays in UB_BCAST_STATE_WAITING state.
The uLL cannot be in Advertising State during this period. When this time period
ends, the Broadcaster state will transition to <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_ADVERTISING</span></code> and
the uLL will enter Advertising State. This parameter is effective only if
Broadcast Duty Control is enabled. If 0, Broadcaster Duty Control is disabled
and the Broadcaster will not enter <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_WAITING</span></code> state.
A 100-ms time unit is used.</p>
</div>
</div>
<div class="section" id="role-management">
<h2>Role Management<a class="headerlink" href="#role-management" title="Permalink to this headline">¶</a></h2>
<p>The uGAP is the main interface to operate in various roles.</p>
<p>There are three distinct roles the uGAP supports:</p>
<ul class="simple">
<li><p>Broadcaster</p></li>
<li><p>Monitor</p></li>
<li><p>Observer</p></li>
</ul>
<p>The application must configure the uGAP to operate in the
mode desired. This section goes over specifics of the
individual roles.</p>
<div class="section" id="broadcaster-role">
<h3>Broadcaster Role<a class="headerlink" href="#broadcaster-role" title="Permalink to this headline">¶</a></h3>
<p>If the application configures the uGAP to operate Broadcaster role, the uGAP
lets the uLL send advertising events as described in <a class="reference internal" href="#ustack-advertising-state-cc13xx-26xx"><span class="std std-ref">Advertising State</span></a></p>
<p>The Broadcaster Role has 4 states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UG_BCAST_STATE_INITIALIZED</span></code>: Broadcaster is initialized but has never started.
The corresponding state of the uLL can be anything but <code class="docutils literal notranslate"><span class="pre">ULL_STATE_ADVERTISING</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_ADVERTISING</span></code>: Broadcaster is advertising in this state. The
corresponding state of the uLL is <code class="docutils literal notranslate"><span class="pre">ULL_STATE_ADVERTISING</span></code>. If Broadcaster Duty
Control is enabled, the duty timer starts with the duration of
BcastDutyOnTime when this state is entered. Then, the state switches to
<code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_WAITING</span></code> when the duty timer expires. If 0 was passed to
NumAdvEvent when ug_bcastStart() is called, ugbNumAdvEvent won’t have any
effect on this state. Otherwise, the state switches to UG_BCAST_STATE_IDLE if
requested through ug_bcastStop() or the total number of Advertising Events
since ug_bcastStart() was called reaches ugbNumAdvEvent. If ug_bcastSuspend()
is called, the state switches to <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_SUSPENDED</span></code>, putting the duty
timer on hold if Duty Control is enabled. The duty timer will resume when the
state switches back to this state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_WAITING</span></code>: Broadcaster started but is not advertising in this
state because it’s in DutyOffTime period. The corresponding state of the uLL
is UL_STATE_STANDBY. If Broadcaster Duty Control is enabled, the duty timer
starts with the duration of BcastDutyOffTime when this state is entered.
Then, the state switches to <code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_ADVERTISING</span></code> when the duty timer
expires. The state switches to UG_BCAST_STATE_IDLE if requested through
ug_bcastStop(). If ug_bcastSuspend() is called, the state switches to
<code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_SUSPENDED</span></code>, putting the duty timer on hold if Duty Control is
enabled. The duty timer will resume when the state switches back to this
state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_BCAST_STATE_SUSPENDED</span></code>: Broadcaster started but is not advertising in this
state. The corresponding state of the uLL can be anything but
<code class="docutils literal notranslate"><span class="pre">ULL_STATE_ADVERTISING</span></code>. The former state shall be recorded when this state is
entered. If the suspension is lifted through ug_bcastResume(), the state will
switch back to the former state. The state switches to UG_BCAST_STATE_IDLE
if ug_bcastStop() is called.</p></li>
</ul>
<div class="figure align-center" id="id6">
<span id="broadcaster-states"></span><img alt="alternate text" src="../_images/broadcaster_states.jpg" />
<p class="caption"><span class="caption-number">Figure 163. </span><span class="caption-text">Broadcaster states</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>The <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> doesn’t allow Broadcaster to have Limited Discoverable
Mode. However, the uGAP provides a duty control means similar to Limited
Discoverable Mode to save power consumption. The duty control can be implemented
with timers based on BcastDutyOnTime and BcastDutyOffTime explained in
<a class="reference internal" href="#parameters-management-cc13xx-26xx"><span class="std std-ref">Parameters Management</span></a>. Broadcaster’s Advertising State corresponds to the
uLL’s Advertising State.</p>
<p>The typical life cycle of the Broadcasting function encompassing the application
down to the uLL is illustrated in <a class="reference internal" href="#life-cycle-broadcaster-function"><span class="std std-numref">Figure 164.</span></a></p>
<div class="figure align-center" id="id7">
<span id="life-cycle-broadcaster-function"></span><img alt="alternate text" src="../_images/life_cycle_broadcaster_function.jpg" />
<p class="caption"><span class="caption-number">Figure 164. </span><span class="caption-text">Life Cycle of Broadcaster Function</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="monitor-role">
<h3>Monitor Role<a class="headerlink" href="#monitor-role" title="Permalink to this headline">¶</a></h3>
<p>The Monitor Role is not defined by <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>.
This section is to describe how the uGAP operates when using
the Monitor Feature.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This role is should only be used as stand alone condition only, which means
no other uBLE Stack feature should be used in conjunction.</p>
</div>
<p>Monitor role is designed to follow an active Bluetooth LE connection.
It requires knowledge of connection information such as access address, hop increment,
and connection interval. With this information the Monitor role
sets up uGAP and uBLE.</p>
<p>The Monitor Role has 3 States:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_STATE_INITIALIZED</span></code>: The monitor is initialized but is not monitoring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_STATE_IDLE</span></code>: The monitor is not monitoring in this state. This corresponds
to UL_STATE_STANDBY in the uLL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_STATE_MONITORING</span></code>: The monitor is scanning. This corresponds to
UL_STATE_MONITORING in the uLL.</p></li>
</ul>
<p>When a packet is detected with the during a scan with the Connection
Parameters passed in from the ‘uble.c’ source file a <code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_MONITOR_INDICATION</span></code>
event is generated.</p>
<p>When a scan is complete, a <code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_MONITOR_COMPLETE</span></code> event is generated.
If there are pending scans, the uGAP will start the next scheduled scan.</p>
<p>Each time the Monitor switches states, a <code class="docutils literal notranslate"><span class="pre">UGAP_MONITOR_EVT_STATE_CHANGE</span></code>
event is generated.</p>
<p>For more information regarding monitor role and its application, please refer
to <a class="reference internal" href="uStack-application.html#sec-cm-app"><span class="std std-ref">Connection Monitor (CM) Application</span></a></p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html" class="btn btn-neutral float-left" title="Micro BLE Stack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="uStack-application.html" class="btn btn-neutral float-right" title="Application Layer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>