<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Privacy &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User&#39;s Guide
 2.02.08.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logical Link Control and Adaptation Layer Protocol (L2CAP)" href="../ble-stack-common/l2cap.html" />
    <link rel="prev" title="GAP Bond Manager and LE Secure Connections" href="gapbondmngr-cc13xx_cc26xx.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-5.x privacy";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide

          </a>
              <div class="version">
                2.02.08.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/ble5-quick-start.html">TI BLE5-Stack Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/platform-cc13xx_cc26xx.html">The CC13xx or CC26xx SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/freertos-index.html">FreeRTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ble-stack-5.x-guide/ble-stack-5-index-cc13xx_cc26xx.html">BLE5-Stack</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview-cc13xx_cc26xx.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="gap-cc13xx_cc26xx.html">Generic Access Profile (GAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gatt.html">Generic Attribute Profile (GATT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gatt.html#gap-gatt-service-ggs">GAP GATT Service (GGS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gatt.html#generic-attribute-profile-service-gatt-service">Generic Attribute Profile Service (GATT Service)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gatt.html#gattservapp-module">GATTServApp Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="gapbondmngr-cc13xx_cc26xx.html">GAP Bond Manager and LE Secure Connections</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Privacy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#privacy-and-address-types">Privacy and Address Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#device-addresses-in-the-ble-core-specification">Device Addresses in the BLE Core Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-device-addresses-in-stack-applications">Using Device Addresses in BLE5-Stack Applications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#resolving-private-addresses">Resolving Private Addresses</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#host-responsibilities">Host Responsibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolving-list">Resolving List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controller-responsibilities">Controller Responsibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-privacy-mode-vs-device-privacy-mode">Network Privacy Mode vs. Device Privacy Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bluetooth-5-1-privacy-additions">Bluetooth 5.1 Privacy Additions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-privacy-in-stack">Using Privacy in BLE5-Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simple-peripheral-setup">Simple Peripheral Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simple-central-setup">Simple Central Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#demonstrating-privacy">Demonstrating Privacy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#host-address-resolution-in-stack">Host Address Resolution in BLE5-Stack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ble-stack-common/l2cap.html">Logical Link Control and Adaptation Layer Protocol (L2CAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble-stack-common/link-layer-cc13xx_cc26xx.html">Link Layer (LL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel-selection-algorithm-number-two.html">Channel Selection Algorithm #2</a></li>
<li class="toctree-l2"><a class="reference internal" href="hci.html">Host Controller Interface (HCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="phy.html">Physical Layer (PHY)</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack-configuration-cc13xx_cc26xx.html">Stack Configurations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/developing-with-sdk-index-cc13xx_cc26xx.html">Developing a Bluetooth LE Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence.html">Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/localization-index-cc13xx_cc26xx.html">RTLS Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-mesh/index.html">Bluetooth Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/memory-index.html">Memory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-cc13xx_cc26xx.html">TI Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/sysconfig-index-cc13xx_cc26xx.html">System Configuration Tool (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/migration-cc13xx_cc26xx.html">Porting Guide and Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/api-reference-cc13xx_cc26xx.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ble-stack-5.x-guide/ble-stack-5-index-cc13xx_cc26xx.html">BLE5-Stack</a> &raquo;</li>
      <li>Privacy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="privacy">
<span id="le-privacy"></span><h1>Privacy<a class="headerlink" href="#privacy" title="Permalink to this headline">¶</a></h1>
<p>The LE privacy feature allows devices to periodically generate new address to
use over the air. This behavior greatly reduces the ability for a scanner to
track broadcasting Bluetooth Low Energy devices over a period of time.</p>
<p>There are two privacy variants defined by the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>: Controller-based and
Host-based. In Host-based privacy, the Host is responsible for managing all
aspects of the privacy feature - generating new addresses to use and resolving
private addresses sent by peers to determine their identity. In Controller-based
privacy, the privacy feature is largely implemented in the Link Layer of the
Controller. However, interaction with the Host is required for configuration and
to manage communication with other devices using privacy.</p>
<p>The BLE5-Stack supports only the Controller-based privacy variant as defined by the
<a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> (Vol 1, Part A, Section 5.4.5). The Link Layer privacy feature is
always enabled in the BLE5-Stack.</p>
<p>Privacy is discussed in the following sections of the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>. It is
suggested to review and familiarize yourself with these sections before
continuing.</p>
<blockquote>
<div><ul class="simple">
<li><p>Vol 1, Part A, Section 5.4.5 - Overview of the LE Privacy Feature</p></li>
<li><p>Vol 2, Part E, Sections 7.8 - HCI Commands</p></li>
<li><p>Vol 3, Part C, Section 10.7 - Privacy in the Host</p></li>
<li><p>Vol 3, Part C, Section 12 - GAP Service and Characteristics for GATT Server</p></li>
<li><p>Vol 6, Part B, Section 1.3 - Device Address</p></li>
<li><p>Vol 6, Part B, Section 6 - Privacy in the Link Layer</p></li>
</ul>
</div></blockquote>
<p>The following terms are used throughout the Privacy section. It is suggested to
review these terms before continuing.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Device-Address"><span class="xref std std-term">Device Address</span></a></p></li>
<li><p><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Identity-Address"><span class="xref std std-term">Identity Address</span></a></p></li>
<li><p><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a></p></li>
<li><p><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a></p></li>
<li><p><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a></p></li>
</ul>
</div></blockquote>
<div class="section" id="privacy-and-address-types">
<h2>Privacy and Address Types<a class="headerlink" href="#privacy-and-address-types" title="Permalink to this headline">¶</a></h2>
<p>Before going too in depth into a discussion of the BLE5-Stack privacy
implementation, one should have a thorough understanding about Device Address
Types as defined by the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> and how they are used by the BLE5-Stack. The
section below is intended to refresh the key concepts in order to provide
context for the topic of Privacy. For other important implementation details,
see the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> or the BLE5-Stack API Guide.</p>
<div class="section" id="device-addresses-in-the-ble-core-specification">
<h3>Device Addresses in the BLE Core Specification<a class="headerlink" href="#device-addresses-in-the-ble-core-specification" title="Permalink to this headline">¶</a></h3>
<p>According to the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>, all Bluetooth device addresses can be divided into
two types: Public (0x00) and Random (0x01). The Random address type can be
categorized into two subtypes: Static or Private. The Private address subtype
can be further divided into two subtypes: Resolvable or Non-Resolvable. These
divisions can be visualized with the following tree:</p>
<img alt="../_images/ditaa-d1b8795467be24ca66e7de7f14d1f6c846216101.png" id="fig-sig-address-types" src="../_images/ditaa-d1b8795467be24ca66e7de7f14d1f6c846216101.png" />
<div class="section" id="public-device-address">
<h4>Public Device Address<a class="headerlink" href="#public-device-address" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Static - does not change during device lifecycle</p></li>
<li><p>Can be used as an Identity Address</p></li>
</ul>
</div>
<div class="section" id="random-static-device-address">
<h4>Random Static Device Address<a class="headerlink" href="#random-static-device-address" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Static - does not change during device lifecycle. May change after a power
cycle.</p></li>
<li><p>Can be used as an Identity Address</p></li>
</ul>
</div>
<div class="section" id="random-resolvable-private-device-address-rpa">
<h4>(Random) Resolvable Private Device Address (RPA)<a class="headerlink" href="#random-resolvable-private-device-address-rpa" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Device Address changes over time</p></li>
<li><p>Address can be matched, or resolved, to an Identity Address for tracking by
trusted peers.</p></li>
</ul>
</div>
<div class="section" id="random-non-resolvable-private-device-address">
<h4>(Random) Non-resolvable Private Device Address<a class="headerlink" href="#random-non-resolvable-private-device-address" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Device Address changes over time</p></li>
<li><p>Does not provide a way to link private device address to a static address</p></li>
</ul>
</div>
</div>
<div class="section" id="using-device-addresses-in-stack-applications">
<span id="privacy-using-device-addresses-in-applications"></span><h3>Using Device Addresses in BLE5-Stack Applications<a class="headerlink" href="#using-device-addresses-in-stack-applications" title="Permalink to this headline">¶</a></h3>
<p><strong>Configuring Local Device Address Mode</strong></p>
<p>A BLE5-Stack application configures its own device address mode with the
<code class="docutils literal notranslate"><span class="pre">addrMode</span></code> parameter of <a class="reference external" href="../../doxygen/ble/html/group___g_a_p.html#gabd7c5f3cc85470854cf425e7e49b5ca5">GAP_DeviceInit()</a>. This API must be called
when initializing the GAP layer and before attempting to start
discovery or advertising. See <a class="reference internal" href="#gapbondmgr-enable-rpa"><span class="std std-numref">Listing 125.</span></a>. It can only be
called once per device reset.</p>
<p>The modes that are supported by the BLE5-Stack are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 6%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>symbol</p></td>
<td><p>value</p></td>
<td><p>description</p></td>
</tr>
<tr class="row-even"><td><p>ADDRMODE_PUBLIC</p></td>
<td><p>0x00</p></td>
<td><p>the local device will only use a Public device address</p></td>
</tr>
<tr class="row-odd"><td><p>ADDRMODE_RANDOM</p></td>
<td><p>0x01</p></td>
<td><p>the local device will only use a Random Static device address</p></td>
</tr>
<tr class="row-even"><td><p>ADDRMODE_RP_WITH_PUBLIC_ID</p></td>
<td><p>0x02</p></td>
<td><p>the local device will always use an RPA that can be resolved to
a Public Identity Address. The device will only accept requests
from peers who use its RPA over the air. It will not accept requests
if the request is being directed to its identity address.</p></td>
</tr>
<tr class="row-odd"><td><p>ADDRMODE_RP_WITH_RANDOM_ID</p></td>
<td><p>0x03</p></td>
<td><p>the local device will always use an RPA that can be resolved to
a Random Static Identity Address. The device will only accept
requests from peers who use its RPA over the air. It will not accept
peer requests if the request is being directed to its identity address.</p></td>
</tr>
</tbody>
</table>
<p>A BLE5-Stack device can only change its address modes using GAP_DeviceInit. If
the address mode is changed, or if a different Random Static address is used,
the BLE5-Stack will erase all existing bonds and local identification information.
The BLE5-Stack does not allow the user to configure the local device to use
a Non-resolvable Private Address. By default, in the BLE5-Stack, a Random Static
address does not change after a power cycle and its identification information
is stored in NV.</p>
<p>The device can use the GAP_GetDevAddress() command to easily receive local
address information for the device.</p>
<p><strong>Configuring Local Device Address in BLE5-Stack</strong></p>
<p>This section will explain how to configure the different address modes in the
BLE5-stack.</p>
<ul class="simple">
<li><p><em>ADDRMODE_PUBLIC</em></p></li>
</ul>
<p>Simply change “Address Mode” to “Public Address” in Sysconfig or set
<code class="docutils literal notranslate"><span class="pre">addrMode</span></code> in <a class="reference external" href="../../doxygen/ble/html/group___g_a_p.html#gabd7c5f3cc85470854cf425e7e49b5ca5">GAP_DeviceInit()</a> to ADDRMODE_PUBLIC. Then the public
address that is burned into the device will be used.</p>
<ul class="simple">
<li><p><em>ADDRMODE_RANDOM</em></p></li>
</ul>
<p>A valid random static address must be generated which follow the requirements
in section <strong>Static device address</strong> ([Vol 6], Part B, Section 1.3.2.1) of the
Bluetooth Core Specification Version 5.2. The requirements are:</p>
<ul class="simple">
<li><p>The two most significant bits of the address shall be equal to 1</p></li>
<li><p>At least one bit of the random part of the address shall be 0</p></li>
<li><p>At least one bit of the random part of the address shall be 1</p></li>
</ul>
<img alt="../_images/aafig-bc072df1efd14dafaf4572aa4240a49fa8df4362.png" id="fig-sig-random-static-address" src="../_images/aafig-bc072df1efd14dafaf4572aa4240a49fa8df4362.png" />
<p>You can easily set the address mode with SysConfig by opening the projet
.syscfg file and navigate to BLE -&gt; General Configuration -&gt; Address Mode. Then
change the address mode and set a valid random address. The 2 Most Significant
bits must be 1. On the right side in table <a class="reference internal" href="#rand-address-table"><span class="std std-ref">Configure Random Static Address (ADDRMODE_RANDOM)</span></a> the
equivalent C code is shown, but if sysconfig is used the correct source code
will be automatically generated.</p>
<span id="rand-address-table"></span><table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 11. </span><span class="caption-text">Configure Random Static Address (ADDRMODE_RANDOM)</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SysConfig</p></th>
<th class="head"><p>Application C Code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="align-center figure">
<a class="reference internal image-reference" href="../_images/rand_stat_addr_syscfg.png"><img alt="alternate text" src="../_images/rand_stat_addr_syscfg.png" style="width: 400px; height: 100px;" /></a>
</div>
</td>
<td><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">randomAddr</span><span class="w"> </span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="p">{</span><span class="mh">0xC0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">};</span><span class="w"></span>
<span class="n">GAP_DeviceInit</span><span class="p">(</span><span class="n">GAP_PROFILE_PERIPHERAL</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">selfEntity</span><span class="p">,</span><span class="w"> </span><span class="n">addrMode</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">randomAddr</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><em>ADDRMODE_RP_WITH_RANDOM_ID</em></p></li>
</ul>
<p>To use RPA that can be resolved to a Random Static Identity Address please
follow section <a class="reference internal" href="#sec-privacy-normal-usecase"><span class="std std-ref">Using Privacy in BLE5-Stack</span></a>, except configure the address
as is done for ADDRMODE_RANDOM above. The <code class="docutils literal notranslate"><span class="pre">pRandomAddr</span></code> argument in
<a class="reference external" href="../../doxygen/ble/html/group___g_a_p.html#gabd7c5f3cc85470854cf425e7e49b5ca5">GAP_DeviceInit()</a> must be set to a valid random static address.</p>
<ul class="simple">
<li><p><em>ADDRMODE_RP_WITH_PUBLIC_ID</em></p></li>
</ul>
<p>Use of ADDRMODE_RP_WITH_PUBLIC_ID is described in section
<a class="reference internal" href="#sec-privacy-normal-usecase"><span class="std std-ref">Using Privacy in BLE5-Stack</span></a>.</p>
<p><strong>Interpreting Addresses in</strong> BLE5-Stack <strong>Applications</strong></p>
<p>Addresses can be received in GAP &amp; GAP Bond Manager events. Address
information can also be queried using LinkDB. When receiving Peer Address
information, the values will be different depending on whether or not the peer
device identity information is in the Resolving List or not. The address types
that may be seen for peer devices is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 7%" />
<col style="width: 72%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>symbol</p></td>
<td><p>value</p></td>
<td><p>description</p></td>
</tr>
<tr class="row-even"><td><p>ADDRTYPE_PUBLIC</p></td>
<td><p>0x00</p></td>
<td><p>the corresponding device address is a Public address</p></td>
</tr>
<tr class="row-odd"><td><p>ADDRTYPE_RANDOM</p></td>
<td><p>0x01</p></td>
<td><p>the corresponding device address is a Random address
of any subtype</p></td>
</tr>
<tr class="row-even"><td><p>ADDRTYPE_PUBLIC_ID</p></td>
<td><p>0x02</p></td>
<td><p>the corresponding device address is using an RPA
with a Public identity address. Receiving this type
means the RPA was resolved in the Controller.</p></td>
</tr>
<tr class="row-odd"><td><p>ADDRTYPE_RANDOM_ID</p></td>
<td><p>0x03</p></td>
<td><p>the corresponding device address is using an RPA
with a Random Static identity address. Receiving this
type means the RPA was resolved in the Controller.</p></td>
</tr>
<tr class="row-even"><td><p>ADDRTYPE_RANDOM_NR</p></td>
<td><p>0xFE</p></td>
<td><p>the corresponding device address is a Random
device address that was not resolved to the local address
by the Controller. This type is used when receiving ADV
reports for directed advertisements if the local device is
configured to use an RPA. Since the address of the initiator
was Random and Not Resolved, the intended
target of the directed advertisement was not the local device.</p></td>
</tr>
<tr class="row-odd"><td><p>ADDRTYPE_NONE</p></td>
<td><p>0xFF</p></td>
<td><p>this address type is only used when reconstructing extended
advertisement packets. The application does not receive this type.</p></td>
</tr>
</tbody>
</table>
<p>If a device adds the peer identity information to the resolving list, it will
only receive the identity address in the application, not the RPA the peer is
currently using.</p>
<p>If an RPA is received for a bonded device in an event, this means that the
address is not present in the resolving list. The address can still be resolved
to its identity address at the application’s discretion, but it will always
receive ADDRTYPE_RANDOM when receiving messages from the Controller.</p>
<p><strong>Communicating Address Information to Controller</strong></p>
<p>When specifying the address type of a peer device, the <code class="docutils literal notranslate"><span class="pre">GAP_Peer_Addr_Types_t</span></code>
are used:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 8%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>symbol</p></td>
<td><p>value</p></td>
<td><p>description</p></td>
</tr>
<tr class="row-even"><td><p>PEER_ADDRTYPE_PUBLIC_OR_PUBLIC_ID</p></td>
<td><p>0x00</p></td>
<td><p>the device address type as seen by the
application is either a Public device address
or a Public identity address</p></td>
</tr>
<tr class="row-odd"><td><p>PEER_ADDRTYPE_RANDOM_OR_RANDOM_ID</p></td>
<td><p>0x01</p></td>
<td><p>the device address type as seen by the
application is either a Random device address
or a Random identity address</p></td>
</tr>
</tbody>
</table>
<p>If the application sends address type information to the Controller, it uses the
above types so that the Controller can determine what to send over the air.</p>
</div>
</div>
<div class="section" id="resolving-private-addresses">
<h2>Resolving Private Addresses<a class="headerlink" href="#resolving-private-addresses" title="Permalink to this headline">¶</a></h2>
<p>The addresses we generally use in privacy discussions are RPAs and Identity
Addresses. As mentioned above, a device using an RPA periodically changes the
address it uses over the air. This happens at a specified timeout interval. The
addresses it uses are generated with an Identity Resolving Key (<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-IRK"><span class="xref std std-term">IRK</span></a>).
This key associates the Resolvable Private Address to an Identity Address that
remains constant.</p>
<p>The privacy feature inhibits tracking from untrusted peer devices. However, some
devices may need the ability to recognize, and be recognized by, their peer
devices after their RPA has changed. Since RPAs are associated with an identity
address, they can be resolved to that fixed address, if a peer device has the
right key.</p>
<p>As mentioned above, in the Controller-based privacy variant, the Controller and
the Host each manage different aspects of privacy. Prior to Bluetooth Core
Specification v 4.2, the Host was responsible for all aspects of privacy. The
Link Layer Privacy feature was introduced in Bluetooth Core Specification 4.2.
This feature hands off the repetitive work (generating &amp; resolving addresses) to
the Controller, while the Host is responsible for configuration and
managing identity information.</p>
<p>The division of responsibilities between the Host and the Controller is depicted
in the flowchart below and is covered in detail in the following sections:</p>
<img alt="../_images/ditaa-fbf0bbe02c142a343a40544ae4e903eefbe1cd09.png" id="fig-privacy-workflow" src="../_images/ditaa-fbf0bbe02c142a343a40544ae4e903eefbe1cd09.png" />
<div class="section" id="host-responsibilities">
<h3>Host Responsibilities<a class="headerlink" href="#host-responsibilities" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setting-privacy-related-gap-parameters">
<h4>Setting Privacy-related GAP Parameters<a class="headerlink" href="#setting-privacy-related-gap-parameters" title="Permalink to this headline">¶</a></h4>
<p><strong>Configure Local RPA Usage</strong></p>
<p>The Host is responsible for setting the address mode used by the Controller as
discussed above using the GAP_DeviceInit command. This contains the <code class="docutils literal notranslate"><span class="pre">addrMode</span></code>
the Host wants the Controller to use when setting up its device address. The
<code class="docutils literal notranslate"><span class="pre">addrMode</span></code> cannot be changed unless the device is reset. If the <code class="docutils literal notranslate"><span class="pre">addrMode</span></code>
changes between resets, the BLE5-Stack will erase and regenerate all local
identification information as well as erase bonding information for known peers.</p>
<p>If a BLE5-Stack device is configured to use an RPA, the Host will also share its
local identification information with the Controller upon initialization to use
for local device address generation and to resolve the local device address when
sent by peers.</p>
<p><strong>Resolvable Private Address Timeout</strong></p>
<p>When using an <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-RPA"><span class="xref std std-term">RPA</span></a>, the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> specifies a default timeout interval
of 15 minutes before the device changes its device address. This can be changed
via the <a class="reference external" href="../../doxygen/ble/html/group___g_a_p___params.html#ggad3fe20690fa942f702d9009944fe4d38ab337d8055e0d3d4b34f4d1efa8160aad">GAP_PARAM_PRIVATE_ADDR_INT</a> parameter in
<a class="reference external" href="../../doxygen/ble/html/group___g_a_p.html#gaefeda1d26837a7703c884939c5c8f749">GAP_SetParamValue()</a>.</p>
</div>
<div class="section" id="exchanging-supported-privacy-feature-information">
<span id="exchange-privacy-features"></span><h4>Exchanging Supported Privacy Feature Information<a class="headerlink" href="#exchanging-supported-privacy-feature-information" title="Permalink to this headline">¶</a></h4>
<p>Any device that is operating as a Central or a Peripheral must contain the GAP
Service. The GAP Service contains 2 privacy-related characteristics: the Central
Address Resolution Characteristic and the Resolvable Private Address Only
characteristic.</p>
<p>In order to use Privacy, the GAP Bond Manager requires the stack’s GATT client
to read the peer device’s GAP characteristics. In order to accomplish this, the
stack must be built with <code class="docutils literal notranslate"><span class="pre">GATT_NO_CLIENT</span></code> compiler option disabled so that the
GATT client is included.</p>
<p>See <a class="reference internal" href="compiler_and_linker_options.html#sec-compiler-options"><span class="std std-ref">Compiler Options</span></a> for more information on how to change predefined
project symbols.</p>
<p>Alternatively, if you’re using a single-project example, the <code class="docutils literal notranslate"><span class="pre">StackWrapper.a</span></code>
must be replaced with <code class="docutils literal notranslate"><span class="pre">StackWrapper_GattNoClient.a</span></code> in the Linker file search
paths.</p>
<div class="section" id="central-address-resolution-characteristic-car">
<span id="central-address-resolution"></span><h5><strong>Central Address Resolution Characteristic (CAR)</strong><a class="headerlink" href="#central-address-resolution-characteristic-car" title="Permalink to this headline">¶</a></h5>
<p>Any device operating as a Central that supports the Link Layer Privacy feature
must include a Central Address Resolution (CAR) Characteristic in its GAP
Service. The value of this characteristic signifies whether or not the Central
device can resolve its own address in the Controller. Since the Link Layer
privacy feature is always enabled in the BLE5-Stack, the GAP Service implemented by
the BLE5-Stack projects sets this value automatically.</p>
<p>Per the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>, the peripheral device must read the CAR characteristic
if it wishes to send a Directed Advertisement when it uses an RPA. The BLE5-Stack
reads this characteristic if the local device is a Peripheral that has bonded to
a peer using an RPA. This characteristic is checked by <code class="docutils literal notranslate"><span class="pre">GapAdv_enable()</span></code> when
attempting to send directed advertisements in the BLE5-Stack.</p>
<p><strong>Resolvable Private Address Only (RPAO)</strong></p>
<p>If this characteristic is present in the GAP Service and its value is ‘0’, the
local device will reject any incoming requests from peers if the identity
address of the local device is used over the air. The BLE5-Stack applications
using Privacy will always contain the RPAO characteristic with a value of ‘0’ in
their GATT Table.</p>
<p>The RPAO is read automatically by the GAP Bond Manager if it has bonded to a
peer using a private address. If a <a class="reference external" href="../../doxygen/ble/html/bcomdef_8h.html#a8252484a1c4ed5e71a7cf87bc896c4d5">GATT_MSG_EVENT</a> with an
<a class="reference external" href="../../doxygen/ble/html/group___a_t_t___m_e_t_h_o_d___d_e_f_i_n_e_s.html#ga55601a1c44aa86b73caa649a3bf04e2b">ATT_READ_BY_TYPE_RSP</a> with a value of ‘0’ is generated, then the Host
sets the peer in <strong>Network Privacy mode</strong>.</p>
<p>However, if a <a class="reference external" href="../../doxygen/ble/html/bcomdef_8h.html#a8252484a1c4ed5e71a7cf87bc896c4d5">GATT_MSG_EVENT</a> response with a <a class="reference external" href="../../doxygen/ble/html/group___a_t_t___m_e_t_h_o_d___d_e_f_i_n_e_s.html#ga1d9775a7ea35bc6cd84af55d201a9ef8">ATT_ERROR_RSP</a>
or a <a class="reference external" href="../../doxygen/ble/html/group___a_t_t___m_e_t_h_o_d___d_e_f_i_n_e_s.html#ga55601a1c44aa86b73caa649a3bf04e2b">ATT_READ_BY_TYPE_RSP</a> with a non-zero value is generated, then
the Host will interact with the device in <strong>Device Privacy Mode</strong>.</p>
</div>
</div>
<div class="section" id="managing-identity-information">
<h4>Managing Identity Information<a class="headerlink" href="#managing-identity-information" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, RPAs can be associated with a long-term identity address
using an IRK. During Phase 3 of the pairing process, BLE5-Stack devices using RPAs
exchange their IRKs and their Identity Addresses with their peers, as described
in [Vol3] Part H, Section 3.6 of the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>. From this point on, given that
a peer has shared a valid, non-zero <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-IRK"><span class="xref std std-term">IRK</span></a> and uses a
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a>, the peer device can resolve this <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-RPA"><span class="xref std std-term">RPA</span></a>
into the associated <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Identity-Address"><span class="xref std std-term">Identity Address</span></a>.</p>
<p>If a Peer using an RPA exchanges an IRK containing all zeros, the IRK will not
be considered valid and its RPA will not be resolved. Only devices using Random
Static, Public, or Non-Resolvable Private device addresses should exchange a
zero-IRK.</p>
</div>
<div class="section" id="managing-the-resolving-list">
<h4>Managing the Resolving List<a class="headerlink" href="#managing-the-resolving-list" title="Permalink to this headline">¶</a></h4>
<p>The Host is responsible for sharing the Identity Information it has
collected with the Controller for resolution purposes. It is also responsible
for removing devices from the resolving list when they are no longer needed or
if the Identity Information has changed.</p>
<p>If the Host wishes to use device filtering and still receive requests from
incoming known peers who are using RPAs, it must provide the identification
information to the Controller. Care should be taken in situations in which the
Resolving List and the Filter Accept List are both used. If your application requires
Filter Accept List filtering of devices using RPAs, please reference the
<a class="reference internal" href="#sec-privacy-and-white-list"><span class="std std-ref">Privacy and the Filter Accept List</span></a> section below.</p>
</div>
</div>
<div class="section" id="resolving-list">
<h3>Resolving List<a class="headerlink" href="#resolving-list" title="Permalink to this headline">¶</a></h3>
<p>When the Link Layer Privacy feature was introduced, the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a>
concept was also introduced. A Resolving List contains device identity
information for known devices that can be used by the Link Layer to resolve RPAs
in the Controller before passing events to the Host. The resolving list contents
determine how the Controller and Host communicate about devices using RPAs. A
Resolving List is necessary in order to use device filtering with devices using
RPAs.</p>
<p>A resolving list record entry consists of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>an Identity Address</p></li>
<li><p>the address type of Identity Address (Public or Random Static)</p></li>
<li><p>the IRK used to resolve the Identity Address</p></li>
<li><p>which Privacy mode the device is in (Network or Device)</p></li>
</ul>
</div></blockquote>
<p>After bonding with a peer device, the Host can create a resolving list
record entry for the device using the information shared during Phase 3 of the
pairing process. This entry is added to the Resolving List which the Controller
will use to process incoming RPAs. The <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a> of a
peer device is not used at the Host layer of the local device after bonding if
its identity information is stored in the Resolving List. Instead, the RPA is
resolved in the Controller and the Host is only given the associated peer’s
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Identity-Address"><span class="xref std std-term">Identity Address</span></a> when receiving messages from the controller. In the
BLE5-Stack, the GAP Bond Manager automatically adds devices to the Resolving List
after bonding.</p>
<p>If the peer device identity information is not in the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a>,
then the link layer may pass such link events to the host for further resolution
(if <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> filtering is not used).
For more information about resolving addresses in the Host, see
<a class="reference internal" href="#sec-privacy-host-resolving"><span class="std std-ref">Host Address Resolution in BLE5-Stack</span></a>.</p>
<p>In the rare event the peer IRK is no longer valid, one of the GAPBOND_ERASE
parameters can be used to erase the bond record and remove the entry from the
Resolving List. If the device has been added to the Resolving List, it will be
removed automatically by the GAP Bond Manager. A peer IRK will only become
invalid if the peer device has reset its identity information for some reason.
This does not occur during normal operation but it might happen after a power
cycle, device reset to factory conditions, NV data corruption, etc.</p>
<p>Upon reset, the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a> is empty and it’s up to the host to
add and remove devices from the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a>. This is automatically
handled for the application when using the GAP Bond Manager. Devices are added
to the Resolving List when a bond is added and are removed from the Resolving
List when the bond is removed.</p>
<p>If the local device receives incoming Link Layer events from the peer device
that is using a <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a>, it will attempt to resolve
the address using the known IRKs in its Resolving List to see if it matches an
Identity Address.</p>
<p>If the Resolving List is full, the Host is responsible for determining if any of
the existing Resolving List entries should be replaced if a new bond is formed.
Any request from a peer using an RPA not in the resolving list will be
forwarded to the Host as long as device filtering is disabled.</p>
<div class="section" id="resolving-list-limitations">
<h4>Resolving List Limitations<a class="headerlink" href="#resolving-list-limitations" title="Permalink to this headline">¶</a></h4>
<p>The BLE5-Stack has been tested &amp; verified with a Resolving List that holds 10
entries.</p>
<p>Resolving Lists with sizes higher than 10 have not been extensively
profiled. Potential limiting factors to Resolving List size include available
Heap and resolution timing considerations: There must be enough memory to store
the desired number of Resolving List entries and each entry in the resolving
list increases the worst case time to resolve a private address. If it takes too
long for the local device to respond, the peer may have stopped listening.</p>
</div>
<div class="section" id="privacy-and-the-filter-accept-list">
<span id="sec-privacy-and-white-list"></span><h4>Privacy and the Filter Accept List<a class="headerlink" href="#privacy-and-the-filter-accept-list" title="Permalink to this headline">¶</a></h4>
<p>The Host also has the option to configure a filter policy in a
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> which is also in the Controller’s
link layer. When enabled, policies can be set to filter out Link Layer events
after they were processed by the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolving-List"><span class="xref std std-term">Resolving List</span></a>. This provides a way of
filtering devices if you only want to communicate with certain devices at a time.
The Host can update the devices in the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a>
so that the Controller can automatically process future connection or scan events.</p>
<p>The intent for the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> mechanism is to
reduce power consumption by filtering out undesired devices. The
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> will prevent the Host from
receiving packets about any device not in the
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a>.
By removing undesirable Link Layer events at the Controller, the Host can
remain in low power modes. In order to take advantage of Filter Accept List filtering,
set the appropriate <code class="docutils literal notranslate"><span class="pre">GapAdv</span></code> and <code class="docutils literal notranslate"><span class="pre">GapScan</span></code> filter policies as
described in the BLE5-Stack API Guide.</p>
<p>The GAP Bond Manager can also be configured to have bonded device automatically
added to the Controller’s <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> by
setting the GAPBOND_AUTO_SYNC_WL parameter. This automatically adds the
peer device Identity Address to the Filter Accept List after adding the device to
the Resolving List.</p>
<p>When a local device receives a link layer event from a peer device, it will
first check the resolving list to see if it contains an entry for the peer
device before applying the Filter Accept List filter. If there is not an entry in the
Resolving List, the Controller will be unable to match the RPA it received to
the corresponding Identity Address information. If the Controller is unable to
resolve the address, it cannot match the Random address seen over the air to the
Identity Address in the Filter Accept List. That means Host will not receive information
about a device using an RPA if the Identity Address is in the Filter Accept List but not
the Resolving List. If you are using the GAP Bond Manager, with the
GAPBOND_AUTO_SYNC_WL parameter enabled, the BLE5-Stack will automatically handle
this behavior for you.</p>
</div>
</div>
<div class="section" id="controller-responsibilities">
<h3>Controller Responsibilities<a class="headerlink" href="#controller-responsibilities" title="Permalink to this headline">¶</a></h3>
<p>The Link Layer privacy feature was introduced to enable device filtering when
RPAs are being used. This feature moved the work of generating and resolving
addresses to the Controller. The Controller relies on the contents of the
resolving list to interact with other private devices.</p>
<div class="section" id="generating-device-addresses">
<h4>Generating Device Addresses<a class="headerlink" href="#generating-device-addresses" title="Permalink to this headline">¶</a></h4>
<p>The Controller will generate the local device address. The Controller uses the
local Identity Information in the Resolving List to generate its own address.
The Controller uses the local device IRK and the identity address to generate
the address is uses over-the-air. The RPA is generated using the Private Device
Address Generation procedure detailed in [Vol 6] Part B, Section 1.3.2.2 of the
<a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>.</p>
<p>The Controller regenerates the RPA device address at the time interval specified
by the Host using the value of <a class="reference external" href="../../doxygen/ble/html/group___g_a_p___params.html#ggad3fe20690fa942f702d9009944fe4d38ab337d8055e0d3d4b34f4d1efa8160aad">GAP_PARAM_PRIVATE_ADDR_INT</a>. The
default value recommended by the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> is 15 minutes.</p>
</div>
<div class="section" id="resolving-device-addresses">
<h4>Resolving Device Addresses<a class="headerlink" href="#resolving-device-addresses" title="Permalink to this headline">¶</a></h4>
<p>Device addresses are used over the air in advertising channel PDUs. The address
type a device is using can be read in the TxAdd and RxAdd fields. If the value
is ‘0’ the device address used is understood to be a Public device address. If
the value used is ‘1’ the device is understood to be using a Random address (of
any subtype).</p>
<p>The Controller can attempt to resolve the addresses it sees Over the Air using
the Private Device Address Resolution procedure detailed in [Vol 6] Part B,
Section 1.3.2.3 of the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a>.</p>
<p>Devices are resolved by using the contents of the Resolving List. When the
controller receives a peer RPA, it will check the RPA against the identity
information of all the peer devices that have been added to the resolving list.
If it finds a match, it will check the device the device is present in the
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Filter-Accept-List"><span class="xref std std-term">Filter Accept List</span></a> (if one is being used), before sending the identity
address with the correct identity address type (PUBLIC ID or RANDOM ID) to the
Host.</p>
<p>If it doesn’t find a match in the resolving list, the Controller will check to
see if a Filter Accept List is being used. If there is no Filter Accept List, or
the Filter Accept List contains the peer device’s current RPA (because this
may change over time, proper Filter Accept List management must be used),
the Controller will use the RPA and the RANDOM address type to send the request
to the Host for further processing.</p>
<p>If a BLE5-Stack device is using an RPA and it receives a request from a peer, it
must resolve its own address before it is sure the request is for the local
device. If the local device using an RPA receives a peer request that is
directed to the local device’s identity address, the local device will not
respond and the Controller will not send an event to the Host.</p>
</div>
<div class="section" id="respecting-peer-privacy">
<h4>Respecting Peer Privacy<a class="headerlink" href="#respecting-peer-privacy" title="Permalink to this headline">¶</a></h4>
<p>The Controller is responsible for maintaining the privacy of its peers who have
shared their keys. This means that if a peer device has indicated it is in
Network Privacy Mode (peer device GAP Service contains an RPAO characteristic
with a value of ‘0’), the Controller will only send requests to the peer device
using its RPA. The Controller will also not accept requests from a bonded peer
that has an RPAO characteristic with a value of ‘0’ if it uses its identity
address over the air.</p>
</div>
</div>
<div class="section" id="network-privacy-mode-vs-device-privacy-mode">
<h3>Network Privacy Mode vs. Device Privacy Mode<a class="headerlink" href="#network-privacy-mode-vs-device-privacy-mode" title="Permalink to this headline">¶</a></h3>
<p>The privacy mode a device uses is set by the Host and is part of the information
stored in a resolving list entry for the device. The Host sets this mode based
on the presence of the RPAO characteristic.</p>
<p>If the GAP Service of the peer device contains an RPAO, the Host will set the
device into Network Privacy Mode and only peer requests using their RPAs will be
accepted.</p>
<p>The BLE5-Stack will consider the other device to be in ‘device privacy mode’ if the
peer device does not have an RPAO characteristic in its GAP Service or its RPAO
characteristic has a non-zero value. It will accept either an Identity
Address or a RPA as the peer device address.</p>
<p>A device can interact with a peer device exclusively in <strong>Network Privacy Mode</strong>
or exclusively <strong>Device Privacy Mode</strong>, not both.</p>
</div>
<div class="section" id="bluetooth-5-1-privacy-additions">
<h3>Bluetooth 5.1 Privacy Additions<a class="headerlink" href="#bluetooth-5-1-privacy-additions" title="Permalink to this headline">¶</a></h3>
<p>Added to the <a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> is a new change that affects privacy when using directed
advertisements or forming connections using the auxiliary advertising channels
while using Resolvable Private Addresses.</p>
<p>To summarize, whenever an AUX_CONNECT_REQ received from a device using a
Resolvable Private Address and an AUX_CONNECT_RSP is generated, the Link Layer
of the responding device should not set the TargetA of the AUX_CONNECT_RSP to
the same value of the InitA field in the received PDU.</p>
<p>For more information on the specifics of this change, please refer to the
<a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> Vol 6, Part B. Section 6.3
<a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> Vol 6, Part B. Section 6.2.4
<a class="reference external" href="https://www.bluetooth.com/specifications/adopted-specifications">Bluetooth Core Specifications Version 5.3</a> Vol 6, Part B. Section 6.2.2</p>
<p>Because of this change, there is the following potential impact:</p>
<p><strong>1. Directed Advertising with Advertising Extensions</strong></p>
<blockquote>
<div><p>There is a potential compatibility issue when using privacy while forming
connections over the auxilary advertising channels when using directed
advertising (i.e. forming connections through the Coded PHY or the 2M PHY).
This compatibility issue should not lead to a disconnection.</p>
</div></blockquote>
<p>In order to avoid potential backwards compatibility problems with other devices
that do not support the change, it is possible to define the
<code class="docutils literal notranslate"><span class="pre">DONT_TRANSMIT_NEW_RPA</span></code> in the application of the BLE5-Stack project you are
using.</p>
</div>
</div>
<div class="section" id="using-privacy-in-stack">
<span id="sec-privacy-normal-usecase"></span><h2>Using Privacy in BLE5-Stack<a class="headerlink" href="#using-privacy-in-stack" title="Permalink to this headline">¶</a></h2>
<p>The typical privacy use case can be demonstrated using the Simple Peripheral
Simple Central sample applications.</p>
<div class="section" id="simple-peripheral-setup">
<h3>Simple Peripheral Setup<a class="headerlink" href="#simple-peripheral-setup" title="Permalink to this headline">¶</a></h3>
<p><strong>1. Enable the GATT client.</strong></p>
<blockquote>
<div><p>The application must have GATT client functionality to read the
<a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address-Only"><span class="xref std std-term">Resolvable Private Address Only</span></a> characteristic and the
<code class="docutils literal notranslate"><span class="pre">Central</span> <span class="pre">Address</span> <span class="pre">Resolution</span></code> characteristic. If <code class="docutils literal notranslate"><span class="pre">GATT_NO_CLIENT</span></code>
is defined in the project’s predefined symbols, remove it.</p>
<p>See <a class="reference internal" href="compiler_and_linker_options.html#sec-compiler-options"><span class="std std-ref">Compiler Options</span></a> for more information on how to change
predefined project symbols.</p>
</div></blockquote>
<p><strong>2. Configure Simple Peripheral device to use Resolvable Private Addresses.</strong></p>
<blockquote>
<div><p>Modify <a class="reference external" href="../../doxygen/ble/html/group___g_a_p.html#gabd7c5f3cc85470854cf425e7e49b5ca5">GAP_DeviceInit()</a> as highlighted in
<a class="reference internal" href="#gapbondmgr-enable-rpa"><span class="std std-numref">Listing 125.</span></a> to use a <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<span id="gapbondmgr-enable-rpa"></span><div class="code-block-caption"><span class="caption-number">Listing 125. </span><span class="caption-text">Enabling Simple Peripheral to use Resolvable Private Addresses</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SimplePeripheral_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">...</span><span class="w"></span>

<span class="c1">//Initialize GAP layer for Peripheral role and register to receive GAP events</span>
<span class="n">GAP_DeviceInit</span><span class="p">(</span><span class="n">GAP_PROFILE_PERIPHERAL</span><span class="p">,</span><span class="w"> </span><span class="n">selfEntity</span><span class="p">,</span><span class="w"> </span><span class="n">ADDRMODE_RP_WITH_PUBLIC_ID</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div>
<p><em>Optionally</em>, add the code snippet highlighted in
<a class="reference internal" href="#gapbondmgr-private-address-timeout"><span class="std std-numref">Listing 126.</span></a> to change the timeout interval
in which the controller changes its <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-Resolvable-Private-Address"><span class="xref std std-term">Resolvable Private Address</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<span id="gapbondmgr-private-address-timeout"></span><div class="code-block-caption"><span class="caption-number">Listing 126. </span><span class="caption-text">Changing the time interval between <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-RPA"><span class="xref std std-term">RPA</span></a> changes</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SimplePeripheral_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="p">...</span><span class="w"></span>

<span class="c1">// Configure GAP</span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">paramUpdateDecision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PARAM_UPDATE_REQ_DECISION</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">rpaTimeoutInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Pass all parameter update requests to the app for it to decide</span>
<span class="w">  </span><span class="n">GAP_SetParamValue</span><span class="p">(</span><span class="n">GAP_PARAM_LINK_UPDATE_DECISION</span><span class="p">,</span><span class="w"> </span><span class="n">paramUpdateDecision</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">GAP_SetParamValue</span><span class="p">(</span><span class="n">GAP_PARAM_PRIVATE_ADDR_INT</span><span class="p">,</span><span class="w"> </span><span class="n">rpaTimeoutInterval</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>3. Enable GAP Bond Manager from the stack project.</strong></p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-number">Listing 127. </span><span class="caption-text">stack project build_config.opt</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Include GAP Bond Manager */</span><span class="w"></span>
<span class="o">-</span><span class="n">DGAP_BOND_MGR</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>4. Enable bonding to share your identity with trusted peer devices.</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">GAPBOND_BONDING_ENABLED</span></code> is a GAP Bond Manager Parameter that allows you
to bond with a peer device during the pairing process. During this process,
the devices share their IRKs so they can be known in the future when their
RPAs change.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-number">Listing 128. </span><span class="caption-text">Enable bonding from SimplePeripheral_init()</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Request bonding (storing long-term keys for re-encryption upon subsequent</span>
<span class="c1">// connections without repairing)</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="n">bonding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span><span class="w"></span>

<span class="n">GAPBondMgr_SetParameter</span><span class="p">(</span><span class="n">GAPBOND_BONDING_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bonding</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>5. Build the Stack Library and Application projects and flash the device.</strong></p>
<blockquote>
<div><p>After flashing the device, you can open a terminal using the standard COM
settings: 115200, 8N1 (see Simple Peripheral
README.html for more information).</p>
<p>The Identity Address (ID Addr) and the Resolvable Private Address currently
being used (RP Addr) should display in the bottom of the Simple Peripheral
terminal window.</p>
</div></blockquote>
</div>
<div class="section" id="simple-central-setup">
<h3>Simple Central Setup<a class="headerlink" href="#simple-central-setup" title="Permalink to this headline">¶</a></h3>
<p><strong>1. Enable GAP Bond Manager from the stack project.</strong></p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-number">Listing 129. </span><span class="caption-text">stack project build_config.opt</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Include GAP Bond Manager */</span><span class="w"></span>
<span class="o">-</span><span class="n">DGAP_BOND_MGR</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>2. Enable bonding to share your identity with trusted peer devices.</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">GAPBOND_BONDING_ENABLED</span></code> is a GAP Bond Manager Parameter that allows you
to bond with a peer device during the pairing process. During this process,
the devices share their IRKs so they can be known in the future when their
RPAs change.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-number">Listing 130. </span><span class="caption-text">Enable bonding from SimpleCentral_init()</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pairMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GAPBOND_PAIRING_MODE_INITIATE</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Create a bond during the pairing process</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="n">bonding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span><span class="w"></span>

<span class="n">GAPBondMgr_SetParameter</span><span class="p">(</span><span class="n">GAPBOND_PAIRING_MODE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pairMode</span><span class="p">);</span><span class="w"></span>
<span class="n">GAPBondMgr_SetParameter</span><span class="p">(</span><span class="n">GAPBOND_BONDING_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bonding</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>3. Build the Stack Library and Application projects and flash the device.</strong></p>
<blockquote>
<div><p>After flashing the device, you can open a terminal using the standard COM
settings: 115200, 8N1 (see Simple Central
README.html for more information).</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The out of box simple_central examples already implements logging
peer’s address when the link established and when it’s bonded.</p>
</div>
</div>
<div class="section" id="demonstrating-privacy">
<h3>Demonstrating Privacy<a class="headerlink" href="#demonstrating-privacy" title="Permalink to this headline">¶</a></h3>
<p><strong>1. Simple Central Scan for Simple Peripheral Device.</strong></p>
<blockquote>
<div><p>Use Simple Central to scan for Simple Peripheral using the two button menu.
Simple Peripheral will be advertising using the RPA
displayed in its terminal window. In the terminal from Simple Central,
you can see the RPA from the Simple Peripheral.</p>
</div></blockquote>
<p><strong>2. Simple Central Connect to Simple Peripheral Device.</strong></p>
<blockquote>
<div><p>Once you find Simple Peripheral’s RPA, then connect to it.
When the link established, the terminal will print out the RPA of
Simple Peripheral and after the bond is saved in the SNV, the terminal
will print out Simple Peripheral’s ID address.</p>
</div></blockquote>
<p><strong>3. Disconnect and Scan and reconnect again</strong></p>
<blockquote>
<div><p>Disconnect from Simple Peripheral. Use
the two button menu to rediscover peer devices. Now you will see Simple Peripheral’s
ID Address in the dicovered device list instead of its RPA. That means
Simple Central already resolve the address when it scans.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="host-address-resolution-in-stack">
<span id="sec-privacy-host-resolving"></span><h2>Host Address Resolution in BLE5-Stack<a class="headerlink" href="#host-address-resolution-in-stack" title="Permalink to this headline">¶</a></h2>
<p>Address Resolution in the Controller using the Resolving List is the recommended
usage of the Privacy feature in the BLE5-Stack. However, in some cases, due to
Resolving List size limitations or other application specific reasons, an RPA
may need to be resolved in the Host. An RPA can be resolved to its Identity
Address in the Host (if a valid IRK exists in the bond record) by using the
<a class="reference external" href="../../doxygen/ble/html/group___g_a_p_bond_mgr.html#gac3dd9a10f8873d7f6b7685d69f80ae73">GAPBondMgr_FindAddr()</a>. This API takes an address and searches the bond
records for the associated identity address.</p>
<p>If a peer device is using an RPA that has not been added to the Resolving List,
the Host should refer only to connection handles and the RPA used by the peer
device when communicating with the Controller.</p>
<p>The number of addresses that can be resolved by the Host is limited to the
number of bond records you can store. However, the time it takes to resolve an
address will increase as more bond records are stored. This may mean that the
address isn’t resolved immediately upon connection. Another disadvantage to
Host-based resolving is that you cannot take advantage of device filtering in
the Controller using the Filter Accept List because every unknown device using an RPA
needs to be forwarded to the Host.</p>
<p><strong>1. Test Normal Privacy Use Case using steps listed in</strong> <a class="reference internal" href="#sec-privacy-normal-usecase"><span class="std std-ref">Using Privacy in BLE5-Stack</span></a></p>
<blockquote>
<div><p>Follow the steps above to properly configure Simple Central and Simple Peripheral
for privacy and bonding.</p>
</div></blockquote>
<p><strong>2. Resolve Private Address to Identity Address using GAP Bond Manager</strong></p>
<blockquote>
<div><p>An unresolved RPA could mean that the bond record has been removed or that
the peer device is using a new IRK that has not been exchanged. In order to
determine whether the bond record is still accurate, we can try to resolve
the address from the bond records we have stored. This is done by sending
the <a class="reference external" href="../../doxygen/ble/html/group___g_a_p_bond_mgr.html#gac3dd9a10f8873d7f6b7685d69f80ae73">GAPBondMgr_FindAddr()</a> command with the peerAddressType set to
<code class="docutils literal notranslate"><span class="pre">PEER_ADDRTYPE_RANDOM_OR_RANDOM_ID</span></code> and the address from the Slave BDA in
the Connection Info (Hint: To save from manual input errors, this address
can be copied &amp; pasted directly by right-clicking on the Slave BDA field and
selecting “Copy Address” then pasting into the address field of the
<a class="reference external" href="../../doxygen/ble/html/group___g_a_p_bond_mgr.html#gac3dd9a10f8873d7f6b7685d69f80ae73">GAPBondMgr_FindAddr()</a> command).</p>
<p>If a valid IRK exists in the Bond Record, the results of the
<a class="reference external" href="../../doxygen/ble/html/group___g_a_p_bond_mgr.html#gac3dd9a10f8873d7f6b7685d69f80ae73">GAPBondMgr_FindAddr()</a> command will be returned in an event showing
the Identity Address and the Identity Address type of the resolved peer
device. It is then up to the user to manage the resolved addresses for use
in their application.</p>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gapbondmngr-cc13xx_cc26xx.html" class="btn btn-neutral float-left" title="GAP Bond Manager and LE Secure Connections" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../ble-stack-common/l2cap.html" class="btn btn-neutral float-right" title="Logical Link Control and Adaptation Layer Protocol (L2CAP)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>