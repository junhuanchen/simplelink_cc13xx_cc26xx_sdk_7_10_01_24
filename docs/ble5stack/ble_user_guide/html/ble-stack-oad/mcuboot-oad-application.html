<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OAD Application &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User&#39;s Guide
 2.02.08.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BLE-Stack OAD Profile" href="mcuboot-oad-profile.html" />
    <link rel="prev" title="Post-Build Script imgtool" href="../oad-mcuboot/imgtool.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-oad mcuboot-oad-application";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide

          </a>
              <div class="version">
                2.02.08.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/ble5-quick-start.html">TI BLE5-Stack Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/platform-cc13xx_cc26xx.html">The CC13xx or CC26xx SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/freertos-index.html">FreeRTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble-stack-5-index-cc13xx_cc26xx.html">BLE5-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/developing-with-sdk-index-cc13xx_cc26xx.html">Developing a Bluetooth LE Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence.html">Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/localization-index-cc13xx_cc26xx.html">RTLS Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-mesh/index.html">Bluetooth Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/memory-index.html">Memory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-cc13xx_cc26xx.html">TI Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/oad-types.html">OAD Storage &amp; Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/mcuboot.html">MCUboot Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/on-chip-stack-library.html">MCUBoot for On-Chip OAD (Stack Library)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/image-header.html">MCUBoot OAD Image Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/flash-layout-on-chip-stack-library.html">Flash Layout for On-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/flash-layout-off-chip.html">Flash Layout for Off-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/imgtool.html">Post-Build Script imgtool</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OAD Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#oad-software-architecture">OAD Software Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oad-state-machine">OAD State Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#image-validation">Image Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-block-transfers">Image Block Transfers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#completion-of-the-oad-process">Completion of the OAD Process</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mcuboot-oad-profile.html">BLE-Stack OAD Profile</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/sysconfig-index-cc13xx_cc26xx.html">System Configuration Tool (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/migration-cc13xx_cc26xx.html">Porting Guide and Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/api-reference-cc13xx_cc26xx.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a> &raquo;</li>
      <li>OAD Application</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="oad-application">
<span id="sec-mcuboot-oad-process"></span><h1>OAD Application<a class="headerlink" href="#oad-application" title="Permalink to this headline">¶</a></h1>
<p>The application layer is responsible for plugging the OAD service. The OAD
profile and communication with the BLE-Stack is encapsulated inside the OAD
module. An application developer wishing to implement use the TI OAD solution
will not need to worry about implementing the OAD state machine. The details
of the OAD application layer are documented here for completeness
and to aide in debugging.</p>
<div class="section" id="oad-software-architecture">
<h2>OAD Software Architecture<a class="headerlink" href="#oad-software-architecture" title="Permalink to this headline">¶</a></h2>
<p>The building blocks of the OAD software architecture are detailed below.
In the figure below the following terms have been abbreviated for compactness in
the image.</p>
<blockquote>
<div><ul class="simple">
<li><p>CB : Callback</p></li>
<li><p>SVC: BLE Service</p></li>
<li><p>Func: Function</p></li>
</ul>
</div></blockquote>
<img alt="../_images/ditaa-9797b8cc3c498e4805881d9a2ea6dcc4eca28904.png" src="../_images/ditaa-9797b8cc3c498e4805881d9a2ea6dcc4eca28904.png" />
<p>Internally the OAD service is responsible for the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>Implementing the OAD profile</p></li>
<li><p>Plugging the GATT read and write callback from the BLE5-Stack</p></li>
<li><p>Serializing and de-serializing structures from over the messages</p></li>
<li><p>Sending OAD related requests and responses to the BLE5-Stack to be sent over
the air</p></li>
<li><p>Queuing up messages from stack callbacks to be processed later by the
application</p></li>
<li><p>Implementing the OAD state machine, and ensuring proper state transitions</p></li>
<li><p>Implementing the OAD inactivity timers</p></li>
<li><p>Implementing getter/setter functions for the application to use and
configure the OAD service</p></li>
</ul>
</div></blockquote>
<p>External to the OAD service the application task is responsible for the
following. For more information, see the OAD Advanced lab of the SimpleLink
Academy.</p>
<blockquote>
<div><ul class="simple">
<li><p>Plugging an OAD event handler</p></li>
<li><p>Calling the OAD event processing function in a task context when events
are posted.</p></li>
<li><p>Resetting the device when the <code class="docutils literal notranslate"><span class="pre">OAD_DL_COMPLETE</span></code> event is received.</p></li>
</ul>
</div></blockquote>
<p>A message sequence chart is included below to show a sample of an application’s
interaction with the OAD service.</p>
<blockquote>
<div><div class="figure align-center" id="id2">
<span id="fig-mcuboot-oad-call-graph"></span><p class="plantuml">
<img src="../_images/plantuml-d1fe9648891470f896adcdb6b9269d111aecd96f.png" alt="&#64;startuml
hide footbox

participant app_task.c as app
participant oad.c as oad
participant &quot;BLE Stack&quot; as BLE
participant &quot;OAD Queue&quot; as OADQ

box &quot;BLE-Stack Context&quot;
    participant &quot;GATT R/W Callback&quot; as GATT
end box

activate app

group Initialize OAD service
    app -&gt; oad : OAD_open()

    activate oad
    oad -&gt; BLE : GATTServApp_InitCharCfg() (repeat for each char CCCD)
    oad -&gt; BLE : GATTServApp_RegisterService()

    oad -&gt; OADQ : Queue_construct()
    deactivate oad

    app -&gt; oad : OAD_register()
end

BLE -&gt; app : ATT_MTU_UPDATED_EVENT
app -&gt; oad : OAD_setBlockSize()


group Processing OAD Service Messages
    note over oad, BLE
        Peer device sends OTA command/write
    end note

    activate GATT
    GATT -&gt; oad : oadWriteAttrCB()

    activate oad
    oad -&gt; OADQ : oadEnqueueMsg()
    oad -&gt; app : Execute (*oadWriteCB_t)
    deactivate OAD
    deactivate GATT

    app -&gt; oad : OAD_processQueue()
    oad -&gt; OADQ : Queue_get()

    note over oad
        Process event
    end note
end

group
&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 229. </span><span class="caption-text">OAD service/ Application interaction</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
</div>
<div class="section" id="oad-state-machine">
<h2>OAD State Machine<a class="headerlink" href="#oad-state-machine" title="Permalink to this headline">¶</a></h2>
<p>The OAD service implements an ‘OAD State Machine’ for performing the OAD. The
following state machine depicts the OAD service state transitions and its
interactions with the OAD communication profile messages for both on-chip and
off-chip OAD.</p>
<div class="figure align-center" id="id3">
<span id="fig-mcuboot-oad-state-machine"></span><img alt="../_images/oad_state_machine.png" src="../_images/oad_state_machine.png" />
<p class="caption"><span class="caption-number">Figure 230. </span><span class="caption-text">OAD Types Overview</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The states and state transitions are encapsulated inside the OAD service, but
some of the critical states are described below to aide in understanding.</p>
<p>Note these sections refer to internal state handling and transitions local to
the target device. For a summary of the over the air sequence see
<a class="reference internal" href="mcuboot-oad-profile.html#fig-mcuboot-oad-sequence-diagram"><span class="std std-ref">Sequence diagram for OAD process</span></a> and for a breakdown of the different types of
profile messages and how to interpret them over the air please see
<a class="reference internal" href="mcuboot-oad-profile.html#sect-mcuboot-oad-profile"><span class="std std-ref">BLE-Stack OAD Profile</span></a>.</p>
<div class="section" id="image-validation">
<h3>Image Validation<a class="headerlink" href="#image-validation" title="Permalink to this headline">¶</a></h3>
<p>After establishing a new connection, updating the connection interval
for a faster OAD and enabling notifications of OAD Image Identify and
OAD Image Block characteristics on the OAD target, the
OAD distributor shall write to the Image Identify characteristic of the
OAD target. The message data will be the header retrieved from the OAD
Image available for OAD.</p>
<p>On receiving the <cite>Image Identify</cite> message, the OAD target will get ready
for OAD process. The image validation is done by secure bootloader.
That means, there is no image validation in the OAD application.</p>
</div>
<div class="section" id="image-block-transfers">
<h3>Image Block Transfers<a class="headerlink" href="#image-block-transfers" title="Permalink to this headline">¶</a></h3>
<p>Once the OAD target is ready for receiving image, it will switch to
the configuration state. There it will get the block size and set image count.
When the OAD distributor sends the Start OAD Command to the Control
Characteristic (for more details see
<a class="reference internal" href="mcuboot-oad-profile.html#tbl-mcuboot-oad-control-supported-commands"><span class="std std-ref">OAD Control Characteristic Supported Commands.</span></a>), the OAD target will respond
with a Control characteristic notification requesting the first block. The OAD
distributor will then send the first block to the OAD target.</p>
<p>This process continues with the OAD target notifying the OAD distributor
of the next block it needs and the OAD distributor sending the requested
image block until all blocks have been transferred.</p>
</div>
<div class="section" id="completion-of-the-oad-process">
<h3>Completion of the OAD Process<a class="headerlink" href="#completion-of-the-oad-process" title="Permalink to this headline">¶</a></h3>
<p>After receiving the complete image, OAD application will transit to
<em>OAD_COMPLETE</em> state and then trigger a reset. After reset the secure
bootloader will start the new image validation.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../oad-mcuboot/imgtool.html" class="btn btn-neutral float-left" title="Post-Build Script imgtool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mcuboot-oad-profile.html" class="btn btn-neutral float-right" title="BLE-Stack OAD Profile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>