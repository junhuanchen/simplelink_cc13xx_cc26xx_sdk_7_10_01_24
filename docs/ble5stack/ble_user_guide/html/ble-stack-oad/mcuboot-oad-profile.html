<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BLE-Stack OAD Profile &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User&#39;s Guide
 2.02.08.01 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security Features of CC13x4 and CC26x4 Devices" href="../security-tfm/index.html" />
    <link rel="prev" title="OAD Application" href="mcuboot-oad-application.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-oad mcuboot-oad-profile";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide

          </a>
              <div class="version">
                2.02.08.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/quickstart-intro-cc13xx_cc26xx.html">Introduction to the SimpleLink CC13xx/CC26xx SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/ble5-quick-start.html">TI BLE5-Stack Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/platform-cc13xx_cc26xx.html">The CC13xx or CC26xx SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/tirtos-index-cc13xx_cc26xx.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/freertos-index.html">FreeRTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble-stack-5-index-cc13xx_cc26xx.html">BLE5-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/developing-with-sdk-index-cc13xx_cc26xx.html">Developing a Bluetooth LE Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coexistence/coexistence.html">Coexistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/localization-index-cc13xx_cc26xx.html">RTLS Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-mesh/index.html">Bluetooth Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/u-stack-index-cc13xx_cc26xx.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/memory-index.html">Memory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-cc13xx_cc26xx.html">TI Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/oad-types.html">OAD Storage &amp; Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/mcuboot.html">MCUboot Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/on-chip-stack-library.html">MCUBoot for On-Chip OAD (Stack Library)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/image-header.html">MCUBoot OAD Image Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/flash-layout-on-chip-stack-library.html">Flash Layout for On-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/flash-layout-off-chip.html">Flash Layout for Off-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oad-mcuboot/imgtool.html">Post-Build Script imgtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcuboot-oad-application.html">OAD Application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BLE-Stack OAD Profile</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#over-the-air-message-sequence">Over the Air Message Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oad-service-0xffc0">OAD Service (0xFFC0)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oad-image-identify-0xffc1">OAD Image Identify (0xFFC1)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oad-image-block-characteristic-0xffc2">OAD Image Block Characteristic (0xFFC2)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oad-control-point-characteristic-0xffc5">OAD Control Point Characteristic (0xFFC5)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#oad-reset-service-0xffd0">OAD Reset Service (0xFFD0)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oad-start-reset-characteristic-0xffd1">OAD Start/Reset Characteristic (0xFFD1)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#oad-return-values">OAD Return Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oad-block-size-rules">OAD Block Size Rules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security-tfm/index.html">Security Features of CC13x4 and CC26x4 Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/sysconfig-index-cc13xx_cc26xx.html">System Configuration Tool (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/migration-cc13xx_cc26xx.html">Porting Guide and Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/api-reference-cc13xx_cc26xx.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html">
SimpleLink™ CC13XX/CC26XX SDK
BLE5-Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ble-stack-5.x-guide/index-cc13xx_cc26xx.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ble-stack-5.x-guide/ble5-oad-index-mcuboot.html">MCUBoot Over-the-Air Download (OAD)</a> &raquo;</li>
      <li>BLE-Stack OAD Profile</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="ble-stack-oad-profile">
<span id="sect-mcuboot-oad-profile"></span><h1>BLE-Stack OAD Profile<a class="headerlink" href="#ble-stack-oad-profile" title="Permalink to this headline">¶</a></h1>
<p>The TI OAD Profile has been designed to provide a simple and customizable.
In its most basic form, for both on-chip and off-chip OAD, this profile is
responsible for accepting an OAD interaction based on image header criteria,
storing the image onto the flash, and causing a device reset if the download is
successful so that the downloaded application image is run by the secure
bootloader. The OAD distributor and OAD target perform the GATT client role
and server role respectively. The TI OAD Profile consists of two services:</p>
<blockquote>
<div><ul class="simple">
<li><p>OAD Service</p></li>
<li><p>OAD Reset Service. (used for on-chip OAD only)</p></li>
</ul>
</div></blockquote>
<div class="section" id="over-the-air-message-sequence">
<h2>Over the Air Message Sequence<a class="headerlink" href="#over-the-air-message-sequence" title="Permalink to this headline">¶</a></h2>
<p>The following section details the over the interaction between the target and
distributor. See the following sections for description of the individual
messages and how to decode them.</p>
<p>The following diagram</p>
<blockquote>
<div><div class="figure align-center" id="id2">
<span id="fig-mcuboot-oad-sequence-diagram"></span><p class="plantuml">
<img src="../_images/plantuml-941a8784203b5545bfc14f0ea60a45b3dc3dcdb6.png" alt="&#64;startuml
Distributor &lt;- Target: Advertisements
Distributor -&gt; Target: Connect Req
Distributor &lt;-&gt; Target: OAD Service Discovery

Distributor -&gt; Target: Enable Notifications on OAD Img Identify Char
Distributor -&gt; Target: Enable Notifications on Ext Control Char

Distributor -&gt; Target: ATT_ExchangeMTUReq
Distributor &lt;- Target: ATT_ExchangeMTURsp

note right of Target
Target uses negotiated MTU to select OAD block size in the range of
[20, 244]
end note

Distributor -&gt; Target: Get OAD Block Size Ext Ctrl Command
Distributor &lt;- Target: OAD Block Size Response

group Optional Throughput Enhancements
    Distributor -&gt; Target: LE Set Data Length (4.2 Data length extension)
    Distributor &lt;- Target: LE Set Data Length Response
end group

Distributor -&gt; Target: Write to Image Identify Char
Distributor &lt;- Target: notification on Image ID Char with OAD_SUCCESS

note left of Distributor
Read requested block
from image file
end note

Distributor -&gt; Target: Write 1st block with block num to Image Block Char

group Repeat For Each Block In the Image

Distributor &lt;- Target: Notification on Image Block Char requesting next block
note left of Distributor
Read requested block
from image file
end note

Distributor -&gt; Target: Write requested block with block num to Image Block Char

note right of Target
Write block to flash
end note
end

...Repeat above until all blocks are sent...

Distributor &lt;- Target: Notification on Ext Ctrl Char: OAD_SUCCESS
Distributor -&gt; Target: Enable Image Ext Ctrl Command
Distributor &lt;- Target: Enable Image Ext Ctrl Command Rsp

note right of Target
Reboot device (jump to secure bootloader)
Then secure bootloader validate the image
end note

note over Distributor, Target
  Supervision Timeout
end note

alt Image is valid
note over Distributor, Target
  Secure bootloader will jump to user application
end note

else Image is invalid
note over Distributor, Target
  Secure bootloader will jump to persistent application
end note
end

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-number">Figure 231. </span><span class="caption-text">Sequence diagram for OAD process</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
</div>
<div class="section" id="oad-service-0xffc0">
<span id="sect-mcuboot-oad-service-desc"></span><h2>OAD Service (0xFFC0)<a class="headerlink" href="#oad-service-0xffc0" title="Permalink to this headline">¶</a></h2>
<p>The OAD service is responsible for receiving/storing an OAD image
in its appropriate location, and causing a device jump to the secure
bootloader to validate the downloaded user application.</p>
<p>A screenshot of BTool displaying the OAD service is shown below:</p>
<div class="figure align-center" id="id3">
<span id="fig-mcuboot-oad-service-overview"></span><img alt="../_images/image3.png" src="../_images/image3.png" />
<p class="caption"><span class="caption-number">Figure 232. </span><span class="caption-text">OAD Service Overview</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The OAD service is a primary service with three characteristics. The
characteristics of the OAD service, their UUIDs, and descriptions are
listed in <a class="reference internal" href="#fig-mcuboot-oad-service-overview"><span class="std std-numref">Figure 232.</span></a></p>
<span id="tbl-mcuboot-oad-service-description"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 46. </span><span class="caption-text">OAD Service Description.</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 25%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>UUID</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0xFFC0</p></td>
<td><p>OAD Service</p></td>
<td><p>OAD service declaration</p></td>
</tr>
<tr class="row-odd"><td><p>0xFFC1</p></td>
<td><p>Image Identify</p></td>
<td><p>Used to send image image header over the air</p></td>
</tr>
<tr class="row-even"><td><p>0xFFC2</p></td>
<td><p>Image Block</p></td>
<td><p>Actual block of image data along with
offset into the image.</p></td>
</tr>
<tr class="row-odd"><td><p>0xFFC5</p></td>
<td><p>OAD Control</p></td>
<td><p>Controls various aspects of OAD process</p></td>
</tr>
</tbody>
</table>
<p>The primary method for sending data from the OAD distributor to the OAD
target is the GATT writes with no response message with the exception of the
image identify message. This reduces code size and increases data throughput as
much as possible. Using GATT Notifications would require adding the
GATT_ClientInit() call. However, in a noisy or otherwise poor
RF-environment, the “write with no response” GATT message may not be sufficient
to successfully transmit an entire image and software driven timeouts and
retries may need to be added.</p>
<p>The primary method for sending data from the OAD target to the
OAD distributor is GATT notifications since the GATT_Client will have
already been initialized.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both GATT notifications and GATT write without response are
non-acknowledged message types. To ensure reliability, it is recommended to
limit OAD payload transfers to one procedure per connection event.</p>
</div>
<p>You can refer to the <a class="reference internal" href="mcuboot-oad-application.html#fig-mcuboot-oad-state-machine"><span class="std std-ref">OAD Types Overview</span></a> for an overview of the OAD
verification and image download process.</p>
<div class="section" id="oad-image-identify-0xffc1">
<span id="sect-mcuboot-oad-img-identify"></span><h3>OAD Image Identify (0xFFC1)<a class="headerlink" href="#oad-image-identify-0xffc1" title="Permalink to this headline">¶</a></h3>
<p>The Image Identify characteristic is used to exchange image header information
between OAD distributor and target. The OAD process begins when the
OAD distributor sends the image header information of the proposed OAD
image to the target. Note that a GATT long write was selected for this
procedure because the entire image ID message will not fit in a single
write no response packet for MTU &lt; 25.</p>
<p>For more information about the Image Header, please refer to
<a class="reference external" href="https://docs.mcuboot.com/design.html#image-format">MCUBoot Image format</a></p>
<p>See <a class="reference internal" href="../oad-mcuboot/image-header.html#sec-mcuboot-oad-image-header"><span class="std std-ref">MCUBoot OAD Image Header</span></a> for more information about each field.</p>
<p>“01:00” shall be written to the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-CCCD"><span class="xref std std-term">CCCD</span></a> of this characteristic
so that notification for image header rejection is enabled.</p>
<p>Once the target receives the image header information, it will continue
the OAD process as seen in <a class="reference internal" href="mcuboot-oad-application.html#sec-mcuboot-oad-process"><span class="std std-ref">OAD Application</span></a>. The “01:00” shall
be written to the CCCD of this characteristic to enable the notification. The
error codes are listed in <a class="reference internal" href="#sec-mcuboot-oad-error-codes"><span class="std std-ref">OAD Return Values</span></a>.</p>
</div>
<div class="section" id="oad-image-block-characteristic-0xffc2">
<h3>OAD Image Block Characteristic (0xFFC2)<a class="headerlink" href="#oad-image-block-characteristic-0xffc2" title="Permalink to this headline">¶</a></h3>
<p>The OAD Image Block characteristic is used to request and transfer a block of
data of an OAD Image. “01:00” shall be written to the <a class="reference internal" href="../ble-stack-5.x-guide/reference-cc13xx_cc26xx.html#term-CCCD"><span class="xref std std-term">CCCD</span></a> of this
characteristic to enable the notification for block write. The target requests
the next block of the image by sending a GATT notification to the OAD
distributor with the requested block number from the OAD Control Point
characteristic.  The OAD distributor will respond (GATT write, no response)
with the block number and the OAD image block. The image block contains the
actual binary data from the OAD image offset by the block number multiplied by
the size of a block. The OAD distributor shall get the block size from target
device by issuing the ‘Get OAD Block Size command’ to the OAD Control Point
characteristic described in <a class="reference internal" href="#sec-mcuboot-oad-control-point-characteristic"><span class="std std-ref">OAD Control Point Characteristic (0xFFC5)</span></a>.</p>
<p><a class="reference internal" href="#fig-mcuboot-block-request-response-sniffer-capture"><span class="std std-numref">Figure 233.</span></a> shows a
block request/response sniffer capture.</p>
<div class="figure align-center" id="id5">
<span id="fig-mcuboot-block-request-response-sniffer-capture"></span><img alt="../_images/image6.png" src="../_images/image6.png" />
<p class="caption"><span class="caption-number">Figure 233. </span><span class="caption-text">Block Request/Response Sniffer Capture</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>In <a class="reference internal" href="#fig-mcuboot-block-request-response-sniffer-capture"><span class="std std-numref">Figure 233.</span></a> above, the Image
Block Write Char Response is shown in gray (0x12), status of last block is shown
in teal (0x00 = “SUCCESS”), block number field is 4 bytes (little endian) and
highlighted in red. The OAD image block highlighted in purple.</p>
</div>
<div class="section" id="oad-control-point-characteristic-0xffc5">
<span id="sec-mcuboot-oad-control-point-characteristic"></span><h3>OAD Control Point Characteristic (0xFFC5)<a class="headerlink" href="#oad-control-point-characteristic-0xffc5" title="Permalink to this headline">¶</a></h3>
<p>The OAD control characteristic is written with the intent of extending the TI
OAD Profile by adding a characteristic that can handle multiple commands.
Commands are sent unidirectionally from the OAD Distributor application to the
target using GATT Write No Response. The target will send command status and
return values back to the OAD distributor using GATT Notifications. If the
target doesn’t support a command it shall respond with OAD_EXT_NOT_SUPPORTED,
sent as a single byte notification on the OAD Control Char with value 0xFF.
0xFF is defined as a reserved command ID. If target receives any of the control
commands without receiving ‘Image Identify’ it will return ‘OAD_AUTH_FAIL’.</p>
<p>Below is the list of commands that are supported by the OAD Control Point
Characteristic:</p>
<span id="tbl-mcuboot-oad-control-supported-commands"></span><table class="docutils align-default" id="id6">
<caption><span class="caption-number">Table 47. </span><span class="caption-text">OAD Control Characteristic Supported Commands.</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 34%" />
<col style="width: 7%" />
<col style="width: 4%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>CMD_ID</p></th>
<th class="head"><p>LEN</p></th>
<th class="head"><p>Payload</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Get OAD Block Size Command</p></td>
<td><p>0x01</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Get OAD Block Size Response</p></td>
<td><p>0x01</p></td>
<td><p>3</p></td>
<td><p>OAD_BLOCK_SIZE</p></td>
</tr>
<tr class="row-even"><td><p>Set Image Count Command</p></td>
<td><p>0x02</p></td>
<td><p>1</p></td>
<td><p>Number of images to be downloaded</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Set Image Count Response</p></td>
<td rowspan="2"><p>0x02</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x02)</p>
<p>Byte 1: Return Status</p>
</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td><p>Start OAD Process Command</p></td>
<td><p>0x03</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Start OAD Process Response</p></td>
<td rowspan="2"><p>0x03</p></td>
<td rowspan="2"><p>5</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x03)</p>
<p>Byte 1-3: Block Number</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2"><p>Enable OAD Image Command</p></td>
<td rowspan="2"><p>0x04</p></td>
<td rowspan="2"><p>0/4</p></td>
<td rowspan="2"><p>LEN = 0: none</p>
<p>LEN = 4: Image type and image number of image to be downloaded</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2"><p>Enable OAD Image Response</p></td>
<td rowspan="2"><p>0x04</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x04)</p>
<p>Byte 1: Return Status</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td><p>Cancel OAD Command</p></td>
<td><p>0x05</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Cancel OAD Response</p></td>
<td rowspan="2"><p>0x05</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x05)</p>
<p>Byte 1: Return Status</p>
</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td><p>Disable OAD Image Block Write Command</p></td>
<td><p>0x06</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Disable OAD Image Block Write Response</p></td>
<td rowspan="2"><p>0x06</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x06)</p>
<p>Byte 1: Return Status</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td><p>Get Software Version Command</p></td>
<td><p>0x07</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Get Software Version Response</p></td>
<td rowspan="2"><p>0x07</p></td>
<td rowspan="2"><p>5</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x07)</p>
<p>Byte 1-4: Software Version of currently running image</p>
</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td><p>Get OAD Image Status Command</p></td>
<td><p>0x08</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Get OAD Image Status Response</p></td>
<td rowspan="2"><p>0x08</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x08)</p>
<p>Byte 1: Return Status</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td><p>Get Profile Version Command</p></td>
<td><p>0x09</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Get Profile Version Response</p></td>
<td rowspan="2"><p>0x09</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x09)</p>
<p>Byte 1: Version of OAD profile supported by target</p>
</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td><p>Get Device Type Command</p></td>
<td><p>0x10</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Get Device Type Response</p></td>
<td rowspan="2"><p>0x10</p></td>
<td rowspan="2"><p>5</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x10)</p>
<p>Byte 1-4: Value of Device ID register</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="3"><p>Image Block Write Char Response</p></td>
<td rowspan="3"><p>0x12</p></td>
<td rowspan="3"><p>6</p></td>
<td rowspan="3"><p>Byte 0: Command ID (0x12)</p>
<p>Byte 1: Status of the previous block received</p>
<p>Byte 2-5: Block number</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td><p>Erase All Bonds Request</p></td>
<td><p>0x13</p></td>
<td><p>0</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Erase All Bonds Response</p></td>
<td rowspan="2"><p>0x13</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>Byte 0: Command ID (0x13)</p>
<p>Byte 1: Return status</p>
</td>
</tr>
<tr class="row-odd"></tr>
</tbody>
</table>
<div class="section" id="get-oad-block-size-cmd-rsp">
<h4>Get OAD Block Size CMD/RSP<a class="headerlink" href="#get-oad-block-size-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>The Get OAD block size command is used to return the active OAD block size. The
OAD block size is always set by the target (CC26xx) device based on the
negotiated MTU size. For optimal throughput, the distributor shall perform an
MTU exchange and wait for the exchange to complete before issuing this command.</p>
<p>The block size is returned in the Get OAD Block Size RSP as a 16-bit value.</p>
<p>See <a class="reference internal" href="#sec-mcuboot-blk-size-rules"><span class="std std-ref">OAD Block Size Rules</span></a> for restrictions on block size.</p>
</div>
<div class="section" id="set-image-count-cmd-rsp">
<h4>Set Image Count CMD/RSP<a class="headerlink" href="#set-image-count-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>The off-chip OAD solution can be used to download more than one image in one OAD
session. The ‘OAD Image Count’ control command will be used to set the number of
OAD images to be downloaded. In the earlier version of the OAD profile, ‘OAD
Image Count’ characteristic; was used to serve this purpose. This command is not
valid for on-chip OAD and will be ignored if received. Because of flash size
limitation, on-chip OAD only supports one image download per session.
The default value of the image count is ‘1’.</p>
</div>
<div class="section" id="start-oad-cmd-rsp">
<h4>Start OAD CMD/RSP<a class="headerlink" href="#start-oad-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>After receiving the successful  ‘Image Identify’ response from the target
device, the OAD Distributor can start the OAD by issuing the ‘Start OAD’ command.</p>
</div>
<div class="section" id="enable-oad-image-cmd-rsp">
<h4>Enable OAD Image CMD/RSP<a class="headerlink" href="#enable-oad-image-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>As mentioned earlier, off-chip upgrade can download multiple images. The
distributor can select the image to that needs to be enabled using this control
command. After successfully downloading the new image, the OAD Distributor can
select one of the downloaded images to be enabled by issuing the ‘Enable OAD
Image’ command at OAD control point. The command either have payload bytes,
indicating the image ID,( and optionally image number and wireless tech type,
if supported) it wants to enable or no payload at all. The format of the payload
is shown in table 11. By default, the command will have no payload, and the
target device will enable the last downloaded image. The control point will send
the two-byte(command ID + return status) response notification indicating
success or fail reason.</p>
</div>
<div class="section" id="cancel-oad-cmd-rsp">
<h4>Cancel OAD CMD/RSP<a class="headerlink" href="#cancel-oad-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>The OAD Distributor can cancel the image download any point during the download
process by issuing the ‘Cancel OAD’ command. The control point will send the
two-byte(command ID + return status) response notification indicating success or
reason of the failure.</p>
</div>
<div class="section" id="disable-oad-image-block-write-cmd-rsp">
<h4>Disable OAD Image Block Write CMD/RSP<a class="headerlink" href="#disable-oad-image-block-write-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>By the default, OAD target application sends notifications for each ‘Block
write’ message by sending notification via ‘OAD control point’ characteristic.
This can be overhead for the OAD process overall and can impact the battery
life. The distributor application can disable the notifications via this
command.</p>
</div>
<div class="section" id="get-software-version-cmd-rsp">
<h4>Get Software Version CMD/RSP<a class="headerlink" href="#get-software-version-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>Used to return the command ID +  4-byte long software version of the active
image.</p>
</div>
<div class="section" id="get-oad-image-status-cmd-rsp">
<h4>Get OAD Image Status CMD/RSP<a class="headerlink" href="#get-oad-image-status-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>Reports various failures that may occur during the OAD process in one byte long
response. Error codes can be see in <a class="reference internal" href="#sec-mcuboot-oad-error-codes"><span class="std std-ref">OAD Return Values</span></a></p>
</div>
<div class="section" id="get-profile-version-cmd-rsp">
<h4>Get Profile Version CMD/RSP<a class="headerlink" href="#get-profile-version-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>The command will return two-byte(command ID + profile) long OAD profile version
supported by the application.</p>
</div>
<div class="section" id="get-device-type-cmd-rsp">
<h4>Get Device Type CMD/RSP<a class="headerlink" href="#get-device-type-cmd-rsp" title="Permalink to this headline">¶</a></h4>
<p>The command will return the command ID + 4-byte device ID register.</p>
</div>
<div class="section" id="image-block-write-char-rsp">
<h4>Image Block Write Char RSP<a class="headerlink" href="#image-block-write-char-rsp" title="Permalink to this headline">¶</a></h4>
<p>The OAD target will respond with notification with status and block number of
the next requested payload block from the Control Point characteristic.
The return status codes are listed in <a class="reference internal" href="#sec-mcuboot-oad-error-codes"><span class="std std-ref">OAD Return Values</span></a>. If the
download of the entire image is complete, the OAD target device will respond
with status code OAD_DL_COMPLETE and Block number set to 0xFFFFFFFF to indicate
the download completion.</p>
<hr class="docutils" />
<p>Target device will erase all bond records from non-volatile memory.</p>
</div>
</div>
</div>
<div class="section" id="oad-reset-service-0xffd0">
<span id="mcuboot-oad-reset-service"></span><h2>OAD Reset Service (0xFFD0)<a class="headerlink" href="#oad-reset-service-0xffd0" title="Permalink to this headline">¶</a></h2>
<p>The OAD reset service is only used by on-chip OAD solutions. It
implements a method for switching/invalidating the currently running image and
resetting the device. This must occur because in on-chip solutions the currently
running image cannot update itself. More information about the
on-chip OAD process will be covered in the on-chip OAD chapter.
<a class="reference internal" href="#fig-mcuboot-oad-reset-service"><span class="std std-numref">Figure 234.</span></a> shows an overview of the OAD reset
service and its characteristics. Like the OAD service, the reset service uses
the 128 bit TI base UUID with a 16 bit short UUID of 0xFFD0.</p>
<div class="figure align-center" id="id7">
<span id="fig-mcuboot-oad-reset-service"></span><img alt="../_images/btool_oad_reset_service.png" src="../_images/btool_oad_reset_service.png" />
<p class="caption"><span class="caption-number">Figure 234. </span><span class="caption-text">OAD Reset Service</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="oad-start-reset-characteristic-0xffd1">
<h3>OAD Start/Reset Characteristic (0xFFD1)<a class="headerlink" href="#oad-start-reset-characteristic-0xffd1" title="Permalink to this headline">¶</a></h3>
<p>The OAD Start/Reset Characteristic is responsible for starting the OAD process
or resetting the target device. The size of the characteristic payload can vary
between 1 byte and many depending on if security is enabled.</p>
<p>The reset command contains at minimum a 1 byte command as described below:</p>
<blockquote>
<div><ul class="simple">
<li><p>0x01: Start OAD process, reset device, and boot into persistent app</p></li>
<li><p>0x00: Reset device, and boot into user application</p></li>
</ul>
</div></blockquote>
<p>The command is followed by a security payload as described below in secure
configurations. In non secure configurations, the security payload is absent.</p>
<p>The security payload is identical to the payload that is described in
<a class="reference internal" href="#sect-mcuboot-oad-img-identify"><span class="std std-ref">OAD Image Identify (0xFFC1)</span></a>. If the security payload is present the device
will only reset if the command is from a known peer. Secure versions of
the application/BIM require that the security is present.</p>
</div>
</div>
<div class="section" id="oad-return-values">
<span id="sec-mcuboot-oad-error-codes"></span><h2>OAD Return Values<a class="headerlink" href="#oad-return-values" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 5%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>OAD Status Code</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OAD_SUCCESS</p></td>
<td><p>0</p></td>
<td><p>OAD succeeded</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_CRC_ERR</p></td>
<td><p>1</p></td>
<td><p>The downloaded image’s CRC doesn’t match the one expected from the image header</p></td>
</tr>
<tr class="row-even"><td><p>OAD_FLASH_ERR</p></td>
<td><p>2</p></td>
<td><p>Flash function failure such as flashOpen/flashRead/flash write/flash erase</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_BUFFER_OFL</p></td>
<td><p>3</p></td>
<td><p>The block number of the received packet doesn’t match the one requested, an overflow has occurred.</p></td>
</tr>
<tr class="row-even"><td><p>OAD_ALREADY_STARTED</p></td>
<td><p>4</p></td>
<td><p>OAD start command received, while OAD is already is progress</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_NOT_STARTED</p></td>
<td><p>5</p></td>
<td><p>OAD data block received with OAD start process</p></td>
</tr>
<tr class="row-even"><td><p>OAD_DL_NOT_COMPLETE</p></td>
<td><p>6</p></td>
<td><p>OAD enable command received without complete OAD image download</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_NO_RESOURCES</p></td>
<td><p>7</p></td>
<td><p>Memory allocation fails/ used only for backward compatibility</p></td>
</tr>
<tr class="row-even"><td><p>OAD_IMAGE_TOO_BIG</p></td>
<td><p>8</p></td>
<td><p>Image is too big</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_INCOMPATIBLE_IMAGE</p></td>
<td><p>9</p></td>
<td><p>Stack and flash boundary mismatch, program entry mismatch</p></td>
</tr>
<tr class="row-even"><td><p>OAD_INVALID_FILE</p></td>
<td><p>10</p></td>
<td><p>Invalid image ID received</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_INCOMPATIBLE_FILE</p></td>
<td><p>11</p></td>
<td><p>BIM/image header/firmware version mismatch</p></td>
</tr>
<tr class="row-even"><td><p>OAD_AUTH_FAIL</p></td>
<td><p>12</p></td>
<td><p>Start OAD process / Image Identify message/image payload authentication/validation fail</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_EXT_NOT_SUPPORTED</p></td>
<td><p>13</p></td>
<td><p>Data length extension or OAD control point characteristic not supported</p></td>
</tr>
<tr class="row-even"><td><p>OAD_DL_COMPLETE</p></td>
<td><p>14</p></td>
<td><p>OAD image payload download complete</p></td>
</tr>
<tr class="row-odd"><td><p>OAD_CCCD_NOT_ENABLED</p></td>
<td><p>15</p></td>
<td><p>Internal (target side) error code used to halt the process if a CCCD has not been enabled</p></td>
</tr>
<tr class="row-even"><td><p>OAD_IMG_ID_TIMEOUT</p></td>
<td><p>16</p></td>
<td><p>OAD Image ID has been tried too many times and has timed out. Device will disconnect.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="oad-block-size-rules">
<span id="sec-mcuboot-blk-size-rules"></span><h2>OAD Block Size Rules<a class="headerlink" href="#oad-block-size-rules" title="Permalink to this headline">¶</a></h2>
<p>The distributor device must use the block size returned by ‘Get OAD Block Size
RSP’ throughout the OAD process. Once the OAD process starts, the block size
must not change. The OAD target device will select the block size as the largest
multiple of 4B that fits into the negotiated MTU size. The acceptable range of
OAD block sizes is [20, 244].</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mcuboot-oad-application.html" class="btn btn-neutral float-left" title="OAD Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../security-tfm/index.html" class="btn btn-neutral float-right" title="Security Features of CC13x4 and CC26x4 Devices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>