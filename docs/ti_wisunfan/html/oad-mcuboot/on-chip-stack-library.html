<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MCUBoot for On-Chip OAD (Stack Library) &mdash; 
SimpleLink™ CC13XX/CC26XX SDK
TI Wi-SUN FAN 1.0 Stack User&#39;s Guide
 2.10.00.00 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug oad-mcuboot on-chip-stack-library";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../wisun-guide/index.html" class="icon icon-home"> 
SimpleLink™ CC13XX/CC26XX SDK
TI Wi-SUN FAN 1.0 Stack User's Guide

          </a>
              <div class="version">
                2.10.00.00
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/wisun-quick-start.html">Wi-SUN Stack Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/index-platform.html">SimpleLink Wireless MCU CC13xx and CC26xx Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/tirtos-index.html">TI-RTOS7 (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/freertos-index.html">FreeRTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/wisun-index.html">TI Wi-SUN FAN Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/NWP_interface.html">TI Wi-SUN FAN NWP Interface Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/example-applications.html">Example Application Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc13xx_cc26xx/custom-hardware-cc13xx_cc26xx.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/memory-index.html">Memory overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/wisun-oad-index.html">MCUBoot Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/sysconfig-index.html">System Configuration (SysConfig)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/migration-guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wisun-guide/references.html#terms-and-acronyms">Terms and Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../wisun-guide/index.html">
SimpleLink™ CC13XX/CC26XX SDK
TI Wi-SUN FAN 1.0 Stack User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../wisun-guide/index.html" class="icon icon-home"></a> &raquo;</li>
      <li>MCUBoot for On-Chip OAD (Stack Library)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="mcuboot-for-on-chip-oad-stack-library">
<span id="sec-oad-mcuboot-on-chip-stack-library"></span><h1>MCUBoot for On-Chip OAD (Stack Library)<a class="headerlink" href="#mcuboot-for-on-chip-oad-stack-library" title="Permalink to this headline">¶</a></h1>
<p>This section describes the behavior of the MCUBoot for on-chip OAD
where the combined image approach is used. This approach requires
two full application and stack library pairs on the target device.
In an on-chip OAD system, there are only two image types that can
be executed safely:</p>
<blockquote>
<div><ul class="simple">
<li><p>Persistent application (version 1.0.0): Permanently resident application that
implements OAD profile</p></li>
<li><p>User application (version higher than): OAD upgradeable application that implements OAD
reset service and user functionality</p></li>
</ul>
</div></blockquote>
<p>For more information about OAD image header, refer to the
<a class="reference internal" href="image-header.html#sec-mcuboot-oad-image-header"><span class="std std-ref">MCUBoot OAD Image Header</span></a> section of this chapter. The roles and
responsibilities of each application in an on-chip system is defined in the
<span class="xref std std-ref">sec-mcuboot-oad-process</span> section.</p>
<p>In summary, the user application is responsible for updating the image version
number flash field in the OAD image header, and resetting the device when
appropriate; while the persistent application will be resposible of storing the
new image.</p>
<p>Based on the image version number field in the image header, MCUBoot will decide
which image is most fit to run. <code class="xref std std-numref docutils literal notranslate"><span class="pre">mcuboot_oad_diagram</span></code> describes TI’s
software solution using MCUBoot process.</p>
<div class="figure align-center" id="id3">
<span id="mcuboot-oad-diagram"></span><p class="plantuml">
<img src="../_images/plantuml-7ed0910cd746c94f40d23cc58a56a85f1e757513.png" alt="&#64;startuml

  participant oaddist as &quot;OAD Distributor&quot;
  participant pers as &quot;Persistent Application&quot;
  participant user as &quot;User Application&quot;
  participant mcubl as &quot;MCUBoot Secure Booloader&quot;

  user --&gt; oaddist : Advertising
  oaddist --&gt; user : Connection Indication
  oaddist &lt;--&gt; user : Service Discovery

  rnote over oaddist
    Discover Reset Service
    and Characteristics
  end note

  oaddist --&gt; user : Request OAD transfer\ntrigger reset

  user -&gt; user : Change the image version number\nto 0 in flash
  user -&gt; user : Reset
  user -&gt; mcubl : After reset, OAD target goes\ninto MCUBoot Secure Bootloader

  mcubl -&gt; mcubl : Detect the version number in\nPersistent Application is\nhigher than User Application

  rnote over mcubl
    MCUBoot Secure Bootloader
    validates the image
  end note

  mcubl -&gt; pers : Boot into Persistent Application

  pers --&gt; oaddist : Advertising
  oaddist --&gt; pers : Connection Indication
  oaddist &lt;--&gt; pers : Service Discovery

  rnote over oaddist
    Discover OAD Service
    and Characteristics
  end note

  oaddist --&gt; pers : Get OAD block size
  pers --&gt; oaddist : OAD block size rsp
  oaddist --&gt; pers : Send Image Identity
  pers --&gt; oaddist : Image Identity Success

  rnote over pers
    The Persistent Application
    does not check the image identity
    as this will is checked by
    the MCUBoot Secure Bootloader
  end note

  group Start Transfering New Image
    oaddist --&gt; pers : OAD start
    pers --&gt; oaddist : Notify on OAD_IMG_BLOCK \ncharacteristic
    ...
    ... Repeat until finishing transfering new image ...
    ...
  end

  oaddist --&gt; pers : OAD Enable
  pers -&gt; pers : Reset

  pers -&gt; mcubl : After reset, OAD target goes\ninto MCUBoot Secure Bootloader
  mcubl -&gt; mcubl : Detect the version number in\nUser Application is\nhigher than Persistent Application

  rnote over mcubl
    MCUBoot Secure Bootloader
    validates the new image
  end note

  mcubl -&gt; user : Jump to new User Application image

&#64;enduml"/>
</p>
<p class="caption"><span class="caption-text">MCUBoot OAD sequence diagram.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>In order to determine which image is best to run, MCUBoot takes the following
measures:</p>
<ol class="arabic">
<li><p>At startup, MCUBoot checks to identify image header on Primary slot</p>
<blockquote>
<div><ul class="simple">
<li><p>check magic number (ih_magic) 0x96F3B83D.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Then MCUBoot further checks to identify image header on Secondary slot</p>
<blockquote>
<div><ul class="simple">
<li><p>check magic number (ih_magic) 0x96F3B83D.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Compare versions (ih_ver) and select Primary if Primary version &gt;= Secondary
version</p></li>
<li><p>MCUboot will now go to certain flash addresses based on the flash layout specified
in the <code class="docutils literal notranslate"><span class="pre">flash_map_backend.h</span></code> file in search for a valid Image Identification value.
This is done in the following way:</p>
<blockquote>
<div><ul class="simple">
<li><p>Read the version number in the image header, then check for its validity
(integrity check, signature verification etc.)</p></li>
<li><p>If the image is invalid MCUboot erases its memory slot and starts to
validate the other image. After a successful validation of the selected
image the bootloader chain-loads it.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TI Wi-SUN FAN Stack currently only supports <a class="reference external" href="https://docs.mcuboot.com/design.html#direct-xip">Direct XIP</a> method.</p>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>